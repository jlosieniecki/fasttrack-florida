<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida FAST Math Simulator (Ultimate Edition 2.0)</title>
    <style>
        /* --- 1. CAMBIUM / FAST THEME --- */
        :root {
            --fast-blue: #005ea2;
            --fast-hover: #e1f3f8;
            --fast-grey-row: #f0f0f0;
            --fast-border: #000;
        }

        body { font-family: 'Segoe UI', Verdana, sans-serif; margin: 0; background-color: #f4f7f6; color: #333; }
        
        /* DASHBOARD */
        #dashboard { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { color: var(--fast-blue); font-size: 36px; margin-bottom: 5px; }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; border-top: 6px solid #ccc; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        
        .card.mock { border-top-color: #d9534f; }
        .card.nso { border-top-color: #005ea2; }
        .card.fr { border-top-color: #5cb85c; }
        .card.ar { border-top-color: #f0ad4e; }
        .card.gr { border-top-color: #6f42c1; }

        /* SIMULATOR */
        #simulator-view { display: none; min-height: 100vh; background-color: #f2f2f2; }
        #question-card {
            max-width: 950px; margin: 0 auto; padding: 50px; background: white;
            border-left: 1px solid #ccc; border-right: 1px solid #ccc; min-height: 600px;
            padding-bottom: 120px; /* Space for footer */
        }

        .question-stem { font-size: 22px; margin-bottom: 25px; line-height: 1.6; }
        
        /* --- TECH ENHANCED ITEMS CSS --- */
        
        /* 1. Hot Text */
        .hot-text-container { font-size: 24px; line-height: 2.5; padding: 20px; border: 1px solid #ddd; display: flex; flex-wrap: wrap; gap: 10px; }
        .hot-spot { padding: 8px 16px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: 0.2s; background: #f9f9f9; border: 1px solid #ccc; }
        .hot-spot:hover { background-color: var(--fast-hover); border-color: #bcd6ed; }
        .hot-spot.selected { background-color: var(--fast-blue); color: white; border-color: var(--fast-blue); }

        /* 2. Table Match */
        .fast-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 18px; }
        .fast-table th { border-bottom: 2px solid #000; padding: 15px; background: #fff; }
        .fast-table td { padding: 15px; border-bottom: 1px solid #ccc; text-align: center; }
        .fast-table tr:nth-child(even) { background-color: var(--fast-grey-row); }
        .fast-radio { width: 24px; height: 24px; accent-color: var(--fast-blue); cursor: pointer; }

        /* 3. Graphic Response (Selectable Images) */
        .graphic-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px; }
        .graphic-option { border: 2px solid #ccc; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; }
        .graphic-option:hover { background-color: var(--fast-hover); border-color: var(--fast-blue); }
        .graphic-option.selected { background-color: var(--fast-hover); border-color: var(--fast-blue); box-shadow: 0 0 0 2px var(--fast-blue); }

        /* 4. Equation Editor */
        .eq-display { width: 100%; max-width: 300px; height: 50px; border: 2px solid #333; font-size: 28px; padding: 5px 10px; margin-bottom: 15px; display: flex; align-items: center; }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 250px; }
        .key-btn { padding: 12px; font-size: 18px; border: 1px solid #ccc; background: #f8f9fa; cursor: pointer; border-radius: 4px; }
        .key-btn:active { background: #e2e6ea; }

        /* 5. Multi-Select / Multiple Choice */
        .option-row { padding: 15px; border: 1px solid #ccc; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; border-radius: 4px; font-size: 18px; transition: 0.2s; }
        .option-row:hover { background-color: var(--fast-hover); border-color: var(--fast-blue); }

        /* VISUALS */
        .visual-container { text-align: center; margin: 20px 0; }
        
        /* FOOTER */
        .fast-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
            background-color: #e6e6e6; border-top: 1px solid #b3b3b3;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; box-sizing: border-box; z-index: 1000;
        }
        .nav-btn { font-size: 18px; padding: 12px 24px; border-radius: 4px; cursor: pointer; border: 1px solid #aaa; background: white; }
        .btn-next { background-color: var(--fast-blue); color: white; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <div id="dashboard">
        <div class="header">
            <h1>Florida FAST Math Simulator</h1>
            <p><strong>Ultimate Edition 2.0:</strong> Complete B.E.S.T. Standards Coverage</p>
        </div>

        <div class="grid-container">
            <div class="card mock" onclick="startTest('mock')">
                <h3>üèÜ Full Mock Assessment</h3>
                <p><strong>30 Questions</strong> ‚Ä¢ Mixed Standards</p>
                <p>Simulates the full end-of-year test experience.</p>
            </div>

            <div class="card nso" onclick="startTest('NSO')">
                <h3>Number Sense (NSO)</h3>
                <p><strong>25 Questions</strong> ‚Ä¢ Master Quiz</p>
                <p>Place Value, Rounding, Addition, Subtraction.</p>
            </div>
            <div class="card fr" onclick="startTest('FR')">
                <h3>Fractions (FR)</h3>
                <p><strong>25 Questions</strong> ‚Ä¢ Master Quiz</p>
                <p>Unit Fractions, >1, Equivalence, Number Lines.</p>
            </div>
            <div class="card ar" onclick="startTest('AR')">
                <h3>Algebraic Reasoning (AR)</h3>
                <p><strong>25 Questions</strong> ‚Ä¢ Master Quiz</p>
                <p>Distributive Prop, Patterns, Missing Factors.</p>
            </div>
            <div class="card gr" onclick="startTest('GR')">
                <h3>Geometry & Data (GR)</h3>
                <p><strong>25 Questions</strong> ‚Ä¢ Master Quiz</p>
                <p>Area, Measurement (Liquid/Length), Lines, Time.</p>
            </div>
        </div>
    </div>

    <div id="simulator-view">
        <div id="question-card"></div>

        <div class="fast-footer" id="nav-controls">
            <button class="nav-btn" onclick="exitTest()">Exit</button>
            <div style="font-weight: bold; font-size: 18px;">Item <span id="q-num">1</span> of <span id="q-total">25</span></div>
            <button class="nav-btn btn-next" onclick="nextQuestion()">Next</button>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentQuestions = [];
        let currentIndex = 0;

        // --- 1. SVG GENERATORS (DYNAMIC VISUALS) ---
        
        function svgClock(h, m) {
            const hDeg = (h * 30) + (m * 0.5);
            const mDeg = m * 6;
            return `<svg width="180" height="180" viewBox="0 0 200 200"><circle cx="100" cy="100" r="90" fill="white" stroke="black" stroke-width="4"/><circle cx="100" cy="100" r="4" fill="black"/>${[12,1,2,3,4,5,6,7,8,9,10,11].map(n=>`<text x="${100+75*Math.cos((n*30-90)*(Math.PI/180))}" y="${100+75*Math.sin((n*30-90)*(Math.PI/180))}" text-anchor="middle" dominant-baseline="middle" font-size="16" font-family="Arial">${n}</text>`).join('')}<line x1="100" y1="100" x2="100" y2="55" stroke="black" stroke-width="6" transform="rotate(${hDeg} 100 100)" stroke-linecap="round"/><line x1="100" y1="100" x2="100" y2="30" stroke="black" stroke-width="4" transform="rotate(${mDeg} 100 100)" stroke-linecap="round"/></svg>`;
        }

        function svgBeaker(level) {
            // Level 0-4 (0=empty, 4=full)
            const h = level * 30; 
            return `<svg width="100" height="150" viewBox="0 0 100 150"><rect x="20" y="20" width="60" height="120" fill="none" stroke="black" stroke-width="3"/><rect x="20" y="${140-h}" width="60" height="${h}" fill="#a2d9f7" opacity="0.8"/><line x1="20" y1="50" x2="40" y2="50" stroke="black"/><line x1="20" y1="80" x2="40" y2="80" stroke="black"/><line x1="20" y1="110" x2="40" y2="110" stroke="black"/><text x="85" y="55" font-size="12">1 Cup</text><text x="85" y="85" font-size="12">1/2</text></svg>`;
        }

        function svgRuler(len) {
            // Draws a ruler measuring a bar of 'len' inches (scaled)
            const pixels = len * 40; 
            return `<svg width="300" height="100" viewBox="0 0 300 100"><rect x="10" y="40" width="${pixels}" height="20" fill="#f0ad4e" stroke="black"/><rect x="10" y="65" width="260" height="30" fill="#fff" stroke="black"/><line x1="10" y1="65" x2="10" y2="80" stroke="black"/><text x="10" y="90" font-size="10">0</text><line x1="50" y1="65" x2="50" y2="80" stroke="black"/><text x="50" y="90" font-size="10">1</text><line x1="90" y1="65" x2="90" y2="80" stroke="black"/><text x="90" y="90" font-size="10">2</text><line x1="130" y1="65" x2="130" y2="80" stroke="black"/><text x="130" y="90" font-size="10">3</text><line x1="170" y1="65" x2="170" y2="80" stroke="black"/><text x="170" y="90" font-size="10">4</text><line x1="210" y1="65" x2="210" y2="80" stroke="black"/><text x="210" y="90" font-size="10">5</text><line x1="250" y1="65" x2="250" y2="80" stroke="black"/><text x="250" y="90" font-size="10">6</text></svg>`;
        }

        function svgGridShape(w, h) {
            // Draws a grid of squares
            return `<svg width="${w*30}" height="${h*30}" viewBox="0 0 ${w*30} ${h*30}"><defs><pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse"><rect width="30" height="30" fill="white" stroke="#ccc" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" stroke="black" stroke-width="2"/></svg>`;
        }

        function svgShape(type) {
            if(type==='Trapezoid') return `<svg width="100" height="80" viewBox="0 0 100 80"><polygon points="20,70 80,70 65,10 35,10" fill="none" stroke="black" stroke-width="2"/></svg>`;
            if(type==='Rectangle') return `<svg width="100" height="80" viewBox="0 0 100 80"><rect x="10" y="20" width="80" height="40" fill="none" stroke="black" stroke-width="2"/></svg>`;
            if(type==='Triangle') return `<svg width="100" height="80" viewBox="0 0 100 80"><polygon points="10,70 90,70 30,10" fill="none" stroke="black" stroke-width="2"/></svg>`;
            if(type==='Circle') return `<svg width="100" height="80" viewBox="0 0 100 80"><circle cx="50" cy="40" r="35" fill="none" stroke="black" stroke-width="2"/></svg>`;
            if(type==='Ray') return `<svg width="100" height="50"><circle cx="10" cy="25" r="3"/><line x1="10" y1="25" x2="90" y2="25" stroke="black" stroke-width="2"/><polygon points="90,20 90,30 100,25" fill="black"/></svg>`;
            if(type==='Line') return `<svg width="100" height="50"><polygon points="10,20 10,30 0,25" fill="black"/><line x1="0" y1="25" x2="100" y2="25" stroke="black" stroke-width="2"/><polygon points="90,20 90,30 100,25" fill="black"/></svg>`;
            if(type==='Segment') return `<svg width="100" height="50"><circle cx="10" cy="25" r="3"/><line x1="10" y1="25" x2="90" y2="25" stroke="black" stroke-width="2"/><circle cx="90" cy="25" r="3"/></svg>`;
            return '';
        }

        // --- 2. QUESTION GENERATORS ---
        
        // HELPER: Shuffle
        function shuffle(array) { return array.sort(() => Math.random() - 0.5); }
        // HELPER: Num to Words
        function toWords(n) { const w=["zero","one","two","three","four","five","six","seven","eight","nine"]; return w[n]||n; }

        // --- NSO DOMAIN (Number Sense & Ops) ---
        const NSO_GENS = [
            // 1. Expanded/Word Form (Level 3/4)
            () => { 
                const n = Math.floor(Math.random()*9000)+1000;
                return { type: 'mc', text: `Select the **Word Form** for ${n}.`, options: [`${toWords(Math.floor(n/1000))} thousand...`, `Ten thousand...`, `${n} ones`] }; 
            },
            // 2. Flexible Decomposition (Level 4/5)
            () => { 
                const h = Math.floor(Math.random()*8)+1;
                return { type: 'multi_select', text: `Select **all** ways to make ${h}00.`, options: [`${h} hundreds`, `${h}0 tens`, `${h}00 ones`, `${h+1} hundreds`] }; 
            },
            // 3. Comparing (Level 3)
            () => { return { type: 'mc', text: `Compare: 4,050 ? 4,005`, options: ['>', '<', '='] }; },
            // 4. Rounding (Level 3/4)
            () => { return { type: 'hot_text', text: `Select numbers that round to **400** (nearest 100).`, content: ['390', '404', '340', '460'] }; },
            // 5. Addition Algorithm (Level 4)
            () => { const a=Math.floor(Math.random()*400)+100; const b=Math.floor(Math.random()*400)+100; return { type: 'equation', text: `Solve: ${a} + ${b} = ?`, num: a+b }; },
            // 6. Subtraction Algorithm (Level 4)
            () => { const a=Math.floor(Math.random()*400)+500; const b=Math.floor(Math.random()*400)+100; return { type: 'equation', text: `Solve: ${a} - ${b} = ?`, num: a-b }; },
            // 7. Multiply Multiples of 10 (Level 3)
            () => { const a=Math.floor(Math.random()*8)+1; return { type: 'mc', text: `Solve: ${a} x 60`, options: [`${a*60}`, `${a*6}00`, `${a*6}`] }; },
            // 8. Error Analysis (Level 5)
            () => { return { type: 'mc', text: `Jon subtracted 500 - 248 and got 348. What is his error?`, options: ['He did not regroup correctly.', 'He added instead.', 'He is correct.'] }; }
        ];

        // --- FR DOMAIN (Fractions) ---
        const FR_GENS = [
            // 1. Unit Fractions
            () => { return { type: 'mc', text: `What fraction is 1 part of 8?`, options: ['1/8', '8/1', '1/1'] }; },
            // 2. Fractions > 1 (Level 4)
            () => { return { type: 'mc', text: `Which represents 5 copies of 1/3?`, options: ['5/3', '1/3', '5/1'] }; },
            // 3. Equivalence (Level 3)
            () => { return { type: 'table_match', text: `Match equivalent fractions.`, rows: [{label:'1/2', id:'r1'},{label:'2/3', id:'r2'}], columns: ['2/4', '4/6', '1/3'] }; },
            // 4. Comparing (Same Denom)
            () => { return { type: 'mc', text: `Compare: 3/8 ? 5/8`, options: ['<', '>', '='] }; },
            // 5. Comparing (Same Num)
            () => { return { type: 'mc', text: `Compare: 2/3 ? 2/6`, options: ['>', '<', '='] }; },
            // 6. Number Line
            () => { return { type: 'hot_text', text: `Select fractions equal to **1 whole**.`, content: ['3/3', '4/4', '5/4', '2/1'] }; }
        ];

        // --- AR DOMAIN (Algebraic Reasoning) ---
        const AR_GENS = [
            // 1. Patterns (Level 3)
            () => { return { type: 'mc', text: `Identify pattern: 4, 8, 12, 16...`, options: ['Add 4', 'Multiply by 2', 'Add 2'] }; },
            // 2. Distributive Property (Level 4)
            () => { return { type: 'mc', text: `Which shows 7 x 12?`, options: ['(7x10) + (7x2)', '(7+10) x (7+2)', '7 x 1 x 2'] }; },
            // 3. Missing Factor (Level 3)
            () => { return { type: 'equation', text: `Find ?: 4 x ? = 32`, num: 8 }; },
            // 4. True/False Equations (Level 4)
            () => { return { type: 'table_match', text: `True or False?`, rows: [{label:'4x5=20', id:'r1'},{label:'10/2=4', id:'r2'}], columns: ['True', 'False'] }; },
            // 5. Even/Odd (Level 3)
            () => { const n=Math.floor(Math.random()*90)+10; return { type: 'mc', text: `Is ${n} Even or Odd?`, options: [n%2==0?'Even':'Odd', n%2==0?'Odd':'Even'] }; },
            // 6. Multiples (Level 3)
            () => { return { type: 'multi_select', text: `Select multiples of 5.`, options: ['25', '30', '12', '7'] }; }
        ];

        // --- GR DOMAIN (Geometry & Measurement) ---
        const GR_GENS = [
            // 1. Identify Quadrilaterals (Level 3)
            () => { return { type: 'graphic_response', text: `Select the **Trapezoid**.`, options: [{label:'Trap', shape:'Trapezoid'}, {label:'Rect', shape:'Rectangle'}, {label:'Circ', shape:'Circle'}] }; },
            // 2. Lines of Symmetry (Level 3/4)
            () => { return { type: 'mc', text: `Which has NO lines of symmetry?`, options: ['Scalene Triangle', 'Square', 'Circle'] }; },
            // 3. Rays/Lines/Segments (Level 4)
            () => { return { type: 'graphic_response', text: `Select the **Ray**.`, options: [{label:'Ray', shape:'Ray'}, {label:'Line', shape:'Line'}, {label:'Seg', shape:'Segment'}] }; },
            // 4. Area by Counting (Level 3)
            () => { return { type: 'mc', text: `Find the area (count squares).`, visual: svgGridShape(4,3), options: ['12 sq units', '7 sq units', '14 sq units'] }; },
            // 5. Area Formula (Level 4)
            () => { return { type: 'equation', text: `Rectangle is 6ft by 4ft. Area = ?`, num: 24 }; },
            // 6. Liquid Volume (Level 3)
            () => { return { type: 'mc', text: `Estimate the volume.`, visual: svgBeaker(2), options: ['1/2 Cup', '1 Cup', '1/4 Cup'] }; },
            // 7. Length (Level 3)
            () => { return { type: 'mc', text: `Measure the orange bar.`, visual: svgRuler(3.5), options: ['3 1/2 in', '3 in', '4 in'] }; },
            // 8. Time (Level 3)
            () => { return { type: 'mc', text: `What time is shown?`, visual: svgClock(4,30), options: ['4:30', '5:30', '6:00'] }; }
        ];

        // --- 3. TEST CONTROL ---

        function startTest(mode) {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('simulator-view').style.display = 'block';
            currentQuestions = [];
            currentIndex = 0;
            
            // Build the question pool
            let pool = [];
            if (mode === 'NSO') pool = NSO_GENS;
            else if (mode === 'FR') pool = FR_GENS;
            else if (mode === 'AR') pool = AR_GENS;
            else if (mode === 'GR') pool = GR_GENS;
            else if (mode === 'mock') pool = [...NSO_GENS, ...FR_GENS, ...AR_GENS, ...GR_GENS];

            // Generate 25 (or 30 for mock) unique questions by cycling the pool
            const count = (mode === 'mock') ? 30 : 25;
            for(let i=0; i<count; i++) {
                const generator = pool[i % pool.length];
                currentQuestions.push(generator());
            }

            document.getElementById('q-total').innerText = currentQuestions.length;
            renderQuestion(0);
        }

        // --- 4. RENDERERS ---

        function renderQuestion(index) {
            const q = currentQuestions[index];
            const container = document.getElementById('question-card');
            document.getElementById('q-num').innerText = index + 1;
            
            let html = `<div class="question-stem">${q.text}</div>`;
            if (q.visual) html += `<div class="visual-container">${q.visual}</div>`;

            if (q.type === 'mc') html += renderMC(q);
            else if (q.type === 'multi_select') html += renderMultiSelect(q);
            else if (q.type === 'table_match') html += renderTableMatch(q);
            else if (q.type === 'hot_text') html += renderHotText(q);
            else if (q.type === 'graphic_response') html += renderGraphic(q);
            else if (q.type === 'equation') html += renderEquation(q);

            container.innerHTML = html;
        }

        function renderMC(q) {
            return `<div>${shuffle(q.options).map(o => `<div class="option-row" onclick="selectRow(this)"><input type="radio" name="opt" style="margin-right:15px;"> ${o}</div>`).join('')}</div>`;
        }

        function renderMultiSelect(q) {
            return `<div>${shuffle(q.options).map(o => `<div class="option-row" onclick="selectRow(this)"><input type="checkbox" style="margin-right:15px;"> ${o}</div>`).join('')}</div>`;
        }

        function renderTableMatch(q) {
            return `<table class="fast-table"><thead><tr><th></th>${q.columns.map(c=>`<th>${c}</th>`).join('')}</tr></thead><tbody>${q.rows.map((r,i)=>`<tr><td style="text-align:left;">${r.label}</td>${q.columns.map(c=>`<td><input type="radio" name="r${i}" class="fast-radio"></td>`).join('')}</tr>`).join('')}</tbody></table>`;
        }

        function renderHotText(q) {
            return `<div class="hot-text-container">${q.content.map(c => `<span class="hot-spot" onclick="toggleHot(this)">${c}</span>`).join('')}</div>`;
        }

        function renderGraphic(q) {
            return `<div class="graphic-grid">${q.options.map(o => `<div class="graphic-option" onclick="selectGraphic(this)">${svgShape(o.shape)}<br><b>${o.label}</b></div>`).join('')}</div>`;
        }

        function renderEquation(q) {
            return `<div style="text-align:center;"><div class="eq-display" id="eq-screen"></div><div class="keypad" style="margin:0 auto;">${[1,2,3,4,5,6,7,8,9,0,'/','‚å´'].map(k => `<button class="key-btn" onclick="pressKey('${k}')">${k}</button>`).join('')}</div></div>`;
        }

        // --- 5. INTERACTION HANDLERS ---
        
        function selectRow(el) {
            const input = el.querySelector('input');
            if(input.type === 'radio') {
                document.querySelectorAll('.option-row').forEach(d => {d.style.background='white'; d.style.borderColor='#ccc';});
                input.checked = true;
            } else {
                input.checked = !input.checked;
            }
            if(input.checked) { el.style.background='var(--fast-hover)'; el.style.borderColor='var(--fast-blue)'; }
            else { el.style.background='white'; el.style.borderColor='#ccc'; }
        }

        function toggleHot(el) {
            el.classList.toggle('selected');
        }

        function selectGraphic(el) {
            document.querySelectorAll('.graphic-option').forEach(s => s.classList.remove('selected'));
            el.classList.add('selected');
        }

        let eqVal = "";
        function pressKey(k) {
            if (k === '‚å´') eqVal = eqVal.slice(0,-1);
            else eqVal += k;
            document.getElementById('eq-screen').innerText = eqVal;
        }

        function nextQuestion() {
            if (currentIndex < currentQuestions.length - 1) {
                renderQuestion(++currentIndex);
                eqVal = ""; 
            } else {
                finishTest();
            }
        }

        function finishTest() {
            document.getElementById('question-card').innerHTML = `<h2 style="text-align:center; color:var(--fast-blue);">Test Complete!</h2><p style="text-align:center;">Great job practicing your B.E.S.T. Standards.</p><div style="text-align:center; margin-top:40px;"><button class="nav-btn btn-next" onclick="location.reload()">Return to Dashboard</button></div>`;
            document.getElementById('nav-controls').style.display = 'none';
        }

        function exitTest() {
            document.getElementById('simulator-view').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        // Init
        window.onload = function() { document.getElementById('dashboard').style.display = 'block'; };

    </script>
</body>
</html>
