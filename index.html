<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida FAST Math Simulator (Word Form & Decomp)</title>
    <style>
        /* --- GLOBAL STYLES --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f4f7f6; color: #333; }
        
        #dashboard { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 50px; }
        .header h1 { color: #005ea2; font-size: 36px; margin-bottom: 10px; }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; border-top: 5px solid #ccc; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .card.nso { border-top-color: #005ea2; }
        
        /* SIMULATOR STYLES */
        #simulator-view { display: none; min-height: 100vh; background-color: #f2f2f2; }
        :root { --fast-blue: #005ea2; --fast-hover: #e1f3f8; --fast-grey-row: #f0f0f0; }

        #question-card {
            max-width: 900px; margin: 0 auto; padding: 50px; background: white;
            border-left: 1px solid #ccc; border-right: 1px solid #ccc; min-height: 600px;
            padding-bottom: 100px;
        }

        .question-stem { font-size: 22px; margin-bottom: 30px; line-height: 1.6; }
        .level-badge { display: inline-block; background: #333; color: white; padding: 2px 8px; font-size: 12px; border-radius: 4px; margin-bottom: 10px; }

        .option-row { padding: 15px; border: 1px solid #ccc; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; border-radius: 4px; font-size: 18px; }
        .option-row:hover { background-color: var(--fast-hover); border-color: var(--fast-blue); }

        .fast-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
            background-color: #e6e6e6; border-top: 1px solid #b3b3b3;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; z-index: 100;
        }
        .nav-btn { font-size: 18px; padding: 12px 24px; border-radius: 4px; cursor: pointer; border: 1px solid #aaa; }
        .btn-next { background-color: var(--fast-blue); color: white; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <div id="dashboard">
        <div class="header">
            <h1>Florida FAST Math Simulator</h1>
            <p><strong>New Features:</strong> Word Form & Flexible Decomposition</p>
        </div>

        <div class="grid-container">
            <div class="card nso" onclick="startTest('mock')">
                <h3>Start Mock Assessment</h3>
                <p>30 Questions â€¢ All Standards</p>
            </div>
            <div class="card nso" onclick="startTest('NSO')">
                <h3>Number Sense (NSO)</h3>
                <p>10 Questions</p>
                <p>Word Form, Decomposing ("14 hundreds")</p>
            </div>
        </div>
    </div>

    <div id="simulator-view">
        <div id="question-card"></div>
        <div class="fast-footer" id="nav-controls">
            <button class="nav-btn" onclick="exitTest()" style="background: #ddd;">Exit</button>
            <div style="font-weight: bold; font-size: 18px;">Item <span id="q-num">1</span> of <span id="q-total">10</span></div>
            <button class="nav-btn btn-next" onclick="nextQuestion()">Next</button>
        </div>
    </div>

    <script>
        // --- HELPERS ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Simple Number to Words Converter (0 - 9999)
        function numToWords(n) {
            const ones = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
            const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            
            if (n === 0) return "zero";
            
            let str = '';
            if (Math.floor(n / 1000) > 0) {
                str += ones[Math.floor(n / 1000)] + ' thousand ';
                n %= 1000;
            }
            if (Math.floor(n / 100) > 0) {
                str += ones[Math.floor(n / 100)] + ' hundred ';
                n %= 100;
            }
            if (n > 0) {
                if (n < 10) str += ones[n];
                else if (n < 20) str += teens[n - 10];
                else {
                    str += tens[Math.floor(n / 10)];
                    if (n % 10 > 0) str += '-' + ones[n % 10];
                }
            }
            return str.trim();
        }

        // --- GENERATORS ---

        function startTest(mode) {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('simulator-view').style.display = 'block';
            currentQuestions = [];
            currentIndex = 0;
            
            const count = mode === 'mock' ? 30 : 10;
            for(let i=0; i<count; i++) {
                // If NSO, rotate through the 3 specific NSO skills
                if (mode === 'NSO') {
                    const r = Math.random();
                    if(r < 0.33) currentQuestions.push(generateWordFormProblem());
                    else if(r < 0.66) currentQuestions.push(generateFlexibleDecomposition());
                    else currentQuestions.push(generateTableMatchNSO());
                } else {
                    currentQuestions.push(generateWordFormProblem()); // Fallback for demo
                }
            }
            
            document.getElementById('q-total').innerText = currentQuestions.length;
            renderQuestion(0);
        }

        // 1. STANDARD FORM vs WORD FORM GENERATOR
        function generateWordFormProblem() {
            const num = Math.floor(Math.random() * 9000) + 1000;
            const correctText = numToWords(num);
            
            // Generate tricky distractors
            // Distractor 1: Swap tens/ones (e.g. 1234 -> 1243)
            const d1_num = num + 9; 
            // Distractor 2: Just wrong digits
            const d2_num = num + 100;
            
            return {
                type: 'multiple_choice',
                level: 'Level 4 (Read & Write)',
                text: `Select the word form for the number <strong>${num.toLocaleString()}</strong>.`,
                options: shuffle([
                    correctText,
                    numToWords(d1_num),
                    numToWords(d2_num),
                    numToWords(num + 1000)
                ])
            };
        }

        // 2. FLEXIBLE DECOMPOSITION GENERATOR ("Multiple Ways")
        function generateFlexibleDecomposition() {
            // Target: e.g., 2,400
            const thousands = Math.floor(Math.random() * 5) + 2; 
            const hundreds = [2, 3, 4, 5][Math.floor(Math.random() * 4)];
            const total = (thousands * 1000) + (hundreds * 100); 
            
            // Valid options
            const opt1 = `${thousands} thousands, ${hundreds} hundreds`; // Standard
            const opt2 = `${thousands}${hundreds} hundreds`; // Flexible (e.g., 24 hundreds)
            const opt3 = `${thousands} thousands, ${hundreds}0 tens`; // Flexible (e.g., 2 thousands 40 tens)
            
            // Invalid options
            const dist1 = `${thousands}${hundreds} tens`; // Too small
            const dist2 = `${thousands} thousands, ${hundreds} ones`; // Too small
            
            return {
                type: 'multi_select',
                level: 'Level 4 (Flexible Composition)',
                text: `Select **all** the ways to represent the number <strong>${total.toLocaleString()}</strong>.`,
                options: shuffle([opt1, opt2, opt3, dist1, dist2])
            };
        }

        // 3. TABLE MATCH (Existing)
        function generateTableMatchNSO() {
            const val = Math.floor(Math.random() * 9000) + 1000;
            return {
                type: 'table_match',
                level: 'Level 3',
                text: `The number is **${val.toLocaleString()}**. Match the value of the digits.`,
                contextNumber: val,
                rows: [{label: "Value of hundreds", id:'r1'}, {label: "Value of tens", id:'r2'}],
                columns: ["Thousands", "Hundreds", "Tens", "Ones"]
            };
        }

        // --- RENDERERS ---

        function renderQuestion(index) {
            currentIndex = index;
            const q = currentQuestions[index];
            const container = document.getElementById('question-card');
            document.getElementById('q-num').innerText = index + 1;
            
            let badge = q.level ? `<span class="level-badge">${q.level}</span>` : '';
            let html = `${badge}<div class="question-stem">${q.text}</div>`;

            if (q.type === 'multiple_choice') {
                html += `<div>${q.options.map(opt => 
                    `<div class="option-row"><input type="radio" name="mc" style="margin-right:15px;"> ${opt}</div>`
                ).join('')}</div>`;
            } 
            else if (q.type === 'multi_select') {
                html += `<div>${q.options.map(opt => 
                    `<div class="option-row"><input type="checkbox" style="margin-right:15px;"> ${opt}</div>`
                ).join('')}</div>`;
            }
            else if (q.type === 'table_match') {
                html += `<div style="background:#f9f9f9; padding:10px; margin-bottom:10px;">Number: <strong>${q.contextNumber}</strong></div>
                <table style="width:100%; border-collapse:collapse; margin-top:20px; font-size:18px;">
                    <thead><tr><th></th>${q.columns.map(c=>`<th style="border-bottom:2px solid black; padding:15px;">${c}</th>`).join('')}</tr></thead>
                    <tbody>${q.rows.map((r, i)=>`<tr><td style="text-align:left; padding:15px; border-bottom:1px solid #ccc;">${r.label}</td>
                    ${q.columns.map(c=>`<td style="padding:15px; border-bottom:1px solid #ccc; text-align:center;"><input type="radio" name="r${i}" style="width:20px; height:20px;"></td>`).join('')}</tr>`).join('')}</tbody>
                </table>`;
            }

            container.innerHTML = html;
        }

        function nextQuestion() {
            if (currentIndex < currentQuestions.length - 1) renderQuestion(currentIndex + 1);
            else {
                document.getElementById('question-card').innerHTML = `<h2>Test Complete</h2><button class="nav-btn btn-next" onclick="location.reload()">Return Home</button>`;
                document.getElementById('nav-controls').style.display = 'none';
            }
        }
        
        function exitTest() {
            document.getElementById('simulator-view').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }
        
        window.onload = function() {
            document.getElementById('dashboard').style.display = 'block';
        };
    </script>
</body>
</html>
