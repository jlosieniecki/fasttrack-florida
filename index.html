<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAST Grade 3 - Official Item Types</title>
    <style>
        :root { 
            --header: #333; 
            --bg: #fff; 
            --active: #003057; /* Florida Blue */
            --highlight: #e6f3ff;
            --border: #888;
        }
        
        body { 
            font-family: 'Verdana', 'Arial', sans-serif; 
            background: #f4f4f4; margin: 0; height: 100vh; 
            display: flex; flex-direction: column; overflow: hidden; 
        }

        /* --- LAYOUT --- */
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        .top-bar { 
            background: #000; color: white; padding: 0 20px; height: 50px; 
            display: flex; justify-content: space-between; align-items: center; 
            font-size: 0.9em; font-weight: bold;
        }

        .tools-bar {
            background: #eee; border-bottom: 1px solid #ccc; padding: 5px 20px;
            display: flex; gap: 10px;
        }
        .tool-btn {
            background: white; border: 1px solid #999; padding: 4px 10px; cursor: pointer; font-size: 0.8em; border-radius: 3px;
        }

        .main-stage { 
            flex: 1; padding: 30px; overflow-y: auto; background: white; 
            display: flex; justify-content: center; 
        }
        .question-card { max-width: 850px; width: 100%; padding-bottom: 80px; }

        .nav-bar { 
            background: #ddd; border-top: 1px solid #999; height: 65px; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 30px; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; 
        }
        
        .nav-btn { 
            background: #fff; border: 1px solid #333; padding: 10px 25px; 
            font-weight: bold; cursor: pointer; border-radius: 4px; 
        }
        .nav-btn.primary { background: #008000; color: white; border-color: #006400; }

        /* --- TYPOGRAPHY --- */
        h2 { font-size: 1.1em; color: #444; margin-top: 0; text-transform: uppercase; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .prompt { font-size: 1.25em; margin-bottom: 25px; line-height: 1.5; color: #000; }

        /* --- ITEM TYPE: MULTIPLE CHOICE --- */
        .mc-row { display: flex; align-items: center; padding: 12px; cursor: pointer; margin-bottom: 5px; border: 1px solid transparent; }
        .mc-row:hover { background: #f0f0f0; }
        .mc-row.selected { background: #e0f0ff; border: 1px solid var(--active); font-weight: bold; }
        .bubble { width: 20px; height: 20px; border: 2px solid #333; border-radius: 50%; margin-right: 15px; background: white; }
        .mc-row.selected .bubble { background: #000; }

        /* --- ITEM TYPE: MULTI-SELECT --- */
        .bubble.square { border-radius: 3px; }

        /* --- ITEM TYPE: EDITING TASK (DROPDOWN) --- */
        .edit-select { font-size: 1.1em; font-weight: bold; border: 2px solid #333; padding: 4px; background: #eef; cursor: pointer; }

        /* --- ITEM TYPE: HOT TEXT --- */
        .hot-box { font-size: 1.4em; line-height: 2; padding: 20px; border: 1px solid #ccc; background: #fafafa; border-radius: 4px; }
        .hot-span { padding: 5px 8px; margin: 0 2px; cursor: pointer; border: 2px solid transparent; border-radius: 3px; transition: 0.2s; }
        .hot-span:hover { background: #ddd; }
        .hot-span.selected { background: #cce5ff; border-color: var(--active); color: #000; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* --- ITEM TYPE: MATCHING TABLE --- */
        .match-table { width: 100%; border-collapse: collapse; font-size: 1.1em; margin-top: 20px; }
        .match-table th, .match-table td { border: 1px solid #888; padding: 15px; text-align: center; }
        .match-table th { background: #eee; }
        .match-table td:first-child { text-align: left; font-weight: bold; background: #f9f9f9; }
        .check-big { transform: scale(1.5); cursor: pointer; accent-color: #003057; }

        /* --- ITEM TYPE: FRACTION MODEL --- */
        .model-container { display: flex; gap: 30px; justify-content: center; margin: 30px 0; }
        .pie-slice { fill: white; stroke: #333; stroke-width: 2; cursor: pointer; transition: 0.2s; }
        .pie-slice:hover { opacity: 0.8; fill: #eee; }
        .pie-slice.active { fill: var(--active); }

        /* --- ITEM TYPE: GRAPHING --- */
        .graph-area { height: 350px; width: 100%; border-left: 2px solid #333; border-bottom: 2px solid #333; display: flex; align-items: flex-end; padding: 0 20px; gap: 20px; position: relative; margin-top: 40px; }
        .grid-line { position: absolute; width: 100%; border-top: 1px dashed #ccc; left: 0; z-index: 0; }
        .bar-col { flex: 1; background: transparent; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; position: relative; z-index: 1; cursor: pointer; }
        .bar-fill { background: var(--active); opacity: 0.8; border: 1px solid #333; border-bottom: none; transition: height 0.3s; width: 100%; }
        .bar-col:hover .bar-fill { opacity: 1; }
        .bar-label { text-align: center; position: absolute; bottom: -30px; width: 100%; font-weight: bold; }

        /* --- ITEM TYPE: EQUATION EDITOR --- */
        .eq-input { font-size: 1.5em; padding: 10px; width: 200px; border: 2px solid #333; border-radius: 4px; text-align: center; }

        /* MENU STYLES */
        .menu-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: white; padding: 20px; }
        .menu-btn { background: white; color: #333; border: none; padding: 15px 30px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin: 10px; width: 100%; max-width: 500px; text-align: left; border-radius: 5px; transition: 0.2s; }
        .menu-btn:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .menu-btn strong { color: #003057; display: block; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="menu-wrapper">
            <h1 style="margin-bottom:40px;">FAST & B.E.S.T. Assessment Simulator</h1>
            
            <button class="menu-btn" onclick="startTest('ALL', 40)">
                <strong>üöÄ Full Mock Exam (40 Items)</strong>
                <small>Mix of all Tech-Enhanced Item Types</small>
            </button>
            
            <h3 style="margin-top:30px; border-bottom:1px solid #666; width:100%; max-width:500px; padding-bottom:10px;">Practice by Item Type</h3>
            
            <button class="menu-btn" onclick="startTest('HOT_TEXT', 5)">
                <strong>üìù Hot Text & Editing Tasks</strong>
                <small>Select words, Dropdown menus</small>
            </button>
            
            <button class="menu-btn" onclick="startTest('INTERACTIVE', 5)">
                <strong>üìä Interactive Items</strong>
                <small>Graphing, Fraction Models, Matching Tables</small>
            </button>
            
            <button class="menu-btn" onclick="startTest('MULTI', 5)">
                <strong>‚òëÔ∏è Multiselect</strong>
                <small>Select all that apply</small>
            </button>
        </div>
    </div>

    <div id="screen-test" class="screen">
        <div class="top-bar">
            <div>FAST Mathematics G3</div>
            <div>Student: <strong>Guest Session</strong></div>
            <div>
                <button style="background:transparent; border:1px solid #fff; color:#fff; padding:5px 10px; cursor:pointer;" onclick="location.reload()">Exit</button>
            </div>
        </div>
        
        <div class="tools-bar">
            <button class="tool-btn">Back</button>
            <button class="tool-btn">Next</button>
            <button class="tool-btn">Save</button>
            <span style="border-left:1px solid #ccc; margin:0 5px;"></span>
            <button class="tool-btn">‚öë Flag</button>
            <button class="tool-btn">Line Reader</button>
            <button class="tool-btn">Zoom In</button>
            <button class="tool-btn">Zoom Out</button>
        </div>

        <div class="main-stage">
            <div id="question-card" class="question-card">
                </div>
        </div>

        <div class="nav-bar">
            <button class="nav-btn" onclick="prevQ()">Back</button>
            <div style="font-weight:bold; color:#444;">Question <span id="q-idx">1</span> of <span id="q-total">40</span></div>
            <button class="nav-btn primary" onclick="nextQ()">Next</button>
        </div>
    </div>

    <script>
        // --- DATA STATE ---
        let queue = [];
        let currentIndex = 0;
        let userAnswers = {}; // Stores answers by Question ID

        // --- HELPER: SHUFFLE & ID ---
        const uuid = () => Math.random().toString(36).substr(2, 9);
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

        // --- ITEM GENERATORS (THE ENGINE) ---
        const GENERATORS = {
            
            // 1. EDITING TASK CHOICE (Dropdowns)
            "EDITING": () => {
                let a = Math.floor(Math.random()*20)+1;
                let b = Math.floor(Math.random()*20)+1;
                let sum = a + b;
                return {
                    id: uuid(),
                    type: "editing",
                    standard: "MA.3.AR.1.2",
                    text: `Complete the sentence to describe the equation.<br><br>
                           <b>${a} + ${b} = ${sum}</b>`,
                    template: `The number ${sum} represents the [DROP1] of ${a} and ${b}.`,
                    dropdowns: {
                        "DROP1": { opts: ["sum", "difference", "product"], ans: "sum" }
                    }
                };
            },

            // 2. SELECTABLE HOT TEXT
            "HOT_TEXT": () => {
                let n = Math.floor(Math.random()*8000)+1000; 
                // Convert number to string to split digits
                let digits = n.toString().split('');
                return {
                    id: uuid(),
                    type: "hot-text",
                    standard: "MA.3.NSO.1.1",
                    text: `Select the digit that is in the <b>hundreds</b> place.`,
                    sentence: digits, // e.g., ["4", "2", "1", "5"]
                    correctIndices: [1], // 1 is hundreds place in a 4-digit number
                    selectable: true
                };
            },

            // 3. MULTISELECT
            "MULTISELECT": () => {
                let n = 24;
                return {
                    id: uuid(),
                    type: "multiselect",
                    standard: "MA.3.AR.2.2",
                    text: `Select <b>all</b> the expressions that equal <b>24</b>.`,
                    options: [
                        { txt: "6 √ó 4", correct: true },
                        { txt: "12 + 12", correct: true },
                        { txt: "3 √ó 8", correct: true },
                        { txt: "10 + 10", correct: false },
                        { txt: "20 + 2", correct: false }
                    ]
                };
            },

            // 4. GRAPHING ITEM (Bar Graph)
            "GRAPHING": () => {
                let cats = ["Red", "Blue", "Green"];
                let vals = [Math.floor(Math.random()*8)+2, Math.floor(Math.random()*8)+2, Math.floor(Math.random()*8)+2];
                return {
                    id: uuid(),
                    type: "graphing",
                    standard: "MA.3.DP.1.1",
                    text: `Create a bar graph to show the data:<br>
                           Red: ${vals[0]}, Blue: ${vals[1]}, Green: ${vals[2]}`,
                    labels: cats,
                    max: 12,
                    correct: vals
                };
            },

            // 5. FRACTION MODEL ITEM
            "FRACTION": () => {
                let den = [4,6,8][Math.floor(Math.random()*3)];
                let num = Math.floor(Math.random()*(den-1))+1;
                return {
                    id: uuid(),
                    type: "fraction",
                    standard: "MA.3.FR.1.1",
                    text: `Click on the circle to shade <b>${num}/${den}</b>.`,
                    total: den,
                    correctCount: num
                };
            },

            // 6. MATCHING ITEM (Table)
            "MATCHING": () => {
                let rows = ["Square", "Triangle"];
                let cols = ["4 Sides", "3 Sides", "5 Sides"];
                return {
                    id: uuid(),
                    type: "matching",
                    standard: "MA.3.GR.1.2",
                    text: "Match the shape to its attribute.",
                    rows: rows,
                    cols: cols,
                    // Hardcoded logic for demo
                    validate: (r, c) => (r===0 && c===0) || (r===1 && c===1)
                };
            },

            // 7. EQUATION EDITOR
            "EQUATION": () => {
                let a = Math.floor(Math.random()*9)+2;
                let b = Math.floor(Math.random()*9)+2;
                return {
                    id: uuid(),
                    type: "equation",
                    standard: "MA.3.NSO.2.2",
                    text: `What is the product of ${a} and ${b}?`,
                    ans: (a*b).toString()
                };
            },
            
             // 8. MULTIPLE CHOICE (Standard)
            "MC": () => {
                let a = Math.floor(Math.random()*500);
                let b = Math.floor(Math.random()*500);
                let sum = a+b;
                // Generate Distractors
                let opts = new Set([sum]);
                while(opts.size < 4) opts.add(sum + Math.floor(Math.random()*20)-10);
                let finalOpts = Array.from(opts).sort(()=>Math.random()-0.5).map(v => ({txt: v.toString(), correct: v===sum}));
                
                return {
                    id: uuid(),
                    type: "mc",
                    standard: "MA.3.NSO.2.1",
                    text: `What is ${a} + ${b}?`,
                    options: finalOpts
                };
            }
        };

        // --- RENDER LOGIC ---

        function renderQ() {
            let q = queue[currentIndex];
            let ans = userAnswers[q.id] || null;
            let html = `<h2>${q.standard}</h2><div class="prompt">${q.text}</div>`;
            let container = document.getElementById('question-card');

            // 1. EDITING
            if(q.type === 'editing') {
                let t = q.template;
                for(let k in q.dropdowns) {
                    let saved = ans ? ans[k] : "";
                    let sel = `<select class="edit-select" onchange="saveEdit('${k}', this.value)">
                        <option value="" disabled ${saved===""?'selected':''}>Select...</option>`;
                    q.dropdowns[k].opts.forEach(o => {
                        sel += `<option value="${o}" ${saved===o?'selected':''}>${o}</option>`;
                    });
                    sel += `</select>`;
                    t = t.replace(`[${k}]`, sel);
                }
                html += `<div style="font-size:1.3em; line-height:2;">${t}</div>`;
            }

            // 2. HOT TEXT
            else if(q.type === 'hot-text') {
                let saved = ans || [];
                html += `<div class="hot-box">`;
                q.sentence.forEach((word, idx) => {
                    let active = saved.includes(idx);
                    html += `<span class="hot-span ${active?'selected':''}" onclick="toggleHot(${idx})">${word}</span>`;
                });
                html += `</div>`;
            }

            // 3. MULTISELECT
            else if(q.type === 'multiselect') {
                let saved = ans || [];
                q.options.forEach((opt, idx) => {
                    let active = saved.includes(idx);
                    html += `<div class="mc-row ${active?'selected':''}" onclick="toggleMulti(${idx})">
                        <div class="bubble square"></div> ${opt.txt}
                    </div>`;
                });
            }

            // 4. GRAPHING
            else if(q.type === 'graphing') {
                let saved = ans || [0, 0, 0];
                html += `<div class="graph-area">`;
                // Grid
                for(let i=1; i<=q.max; i++) {
                    let pct = (i/q.max)*100;
                    html += `<div class="grid-line" style="bottom:${pct}%"></div>`;
                }
                q.labels.forEach((lbl, idx) => {
                    let h = (saved[idx] / q.max) * 100;
                    html += `<div class="bar-col" onclick="setGraph(event, ${idx}, ${q.max})">
                        <div class="bar-fill" style="height:${h}%"></div>
                        <div class="bar-label">${lbl} (${saved[idx]})</div>
                    </div>`;
                });
                html += `</div><p style="text-align:center; color:#666;">Click columns to set height.</p>`;
            }

            // 5. FRACTION
            else if(q.type === 'fraction') {
                let saved = ans || [];
                html += `<div class="model-container"><svg viewBox="0 0 100 100" width="250" height="250">`;
                for(let i=0; i<q.total; i++) {
                    let start = (i * 360 / q.total) * Math.PI/180;
                    let end = ((i+1) * 360 / q.total) * Math.PI/180;
                    let x1=50+45*Math.sin(start), y1=50-45*Math.cos(start);
                    let x2=50+45*Math.sin(end), y2=50-45*Math.cos(end);
                    let active = saved.includes(i);
                    html += `<path d="M50,50 L${x1},${y1} A45,45 0 0,1 ${x2},${y2} Z" 
                             class="pie-slice ${active?'active':''}" onclick="toggleSlice(${i})"/>`;
                }
                html += `</svg></div>`;
            }

            // 6. MATCHING
            else if(q.type === 'matching') {
                let saved = ans || {};
                html += `<table class="match-table"><thead><tr><th></th>`;
                q.cols.forEach(c => html += `<th>${c}</th>`);
                html += `</tr></thead><tbody>`;
                q.rows.forEach((r, rIdx) => {
                    html += `<tr><td>${r}</td>`;
                    q.cols.forEach((c, cIdx) => {
                        let checked = saved[`r${rIdx}`] === cIdx;
                        html += `<td><input type="checkbox" class="check-big" ${checked?'checked':''} onclick="setMatch(${rIdx}, ${cIdx})"></td>`;
                    });
                    html += `</tr>`;
                });
                html += `</tbody></table>`;
            }

            // 7. EQUATION
            else if(q.type === 'equation') {
                html += `<div style="display:flex; justify-content:center; margin-top:30px;">
                    <input class="eq-input" type="text" value="${ans||''}" oninput="saveEq(this.value)" placeholder="?">
                </div>`;
            }
            
            // 8. MULTIPLE CHOICE
            else if(q.type === 'mc') {
                q.options.forEach((opt, idx) => {
                    let active = ans === idx;
                    html += `<div class="mc-row ${active?'selected':''}" onclick="saveMC(${idx})">
                        <div class="bubble"></div> ${opt.txt}
                    </div>`;
                });
            }

            container.innerHTML = html;
            document.getElementById('q-idx').innerText = currentIndex + 1;
            document.getElementById('q-total').innerText = queue.length;
        }

        // --- INTERACTION HANDLERS ---
        
        window.saveEdit = (k, v) => {
            let q = queue[currentIndex];
            let obj = userAnswers[q.id] || {};
            obj[k] = v;
            userAnswers[q.id] = obj;
        };

        window.toggleHot = (idx) => {
            let q = queue[currentIndex];
            let arr = userAnswers[q.id] || [];
            if(arr.includes(idx)) arr = arr.filter(i=>i!==idx);
            else arr.push(idx);
            userAnswers[q.id] = arr;
            renderQ();
        };

        window.toggleMulti = (idx) => {
            let q = queue[currentIndex];
            let arr = userAnswers[q.id] || [];
            if(arr.includes(idx)) arr = arr.filter(i=>i!==idx);
            else arr.push(idx);
            userAnswers[q.id] = arr;
            renderQ();
        };

        window.setGraph = (e, idx, max) => {
            let rect = e.currentTarget.getBoundingClientRect();
            let clickY = e.clientY - rect.top;
            let h = rect.height;
            let val = Math.round((1 - (clickY/h)) * max);
            let q = queue[currentIndex];
            let arr = userAnswers[q.id] || [0,0,0];
            arr[idx] = val;
            userAnswers[q.id] = arr;
            renderQ();
        };

        window.toggleSlice = (idx) => {
            let q = queue[currentIndex];
            let arr = userAnswers[q.id] || [];
            if(arr.includes(idx)) arr = arr.filter(i=>i!==idx);
            else arr.push(idx);
            userAnswers[q.id] = arr;
            renderQ();
        };

        window.setMatch = (r, c) => {
            let q = queue[currentIndex];
            let obj = userAnswers[q.id] || {};
            if(obj[`r${r}`] === c) delete obj[`r${r}`]; // toggle off
            else obj[`r${r}`] = c;
            userAnswers[q.id] = obj;
            renderQ();
        };

        window.saveEq = (v) => {
            userAnswers[queue[currentIndex].id] = v;
        };
        
        window.saveMC = (idx) => {
            userAnswers[queue[currentIndex].id] = idx;
            renderQ();
        }

        // --- SESSION CONTROL ---
        window.startTest = (mode, count) => {
            queue = [];
            userAnswers = {};
            currentIndex = 0;
            
            let types = [];
            if(mode === 'ALL') types = Object.keys(GENERATORS);
            if(mode === 'HOT_TEXT') types = ['HOT_TEXT', 'EDITING'];
            if(mode === 'INTERACTIVE') types = ['GRAPHING', 'FRACTION', 'MATCHING', 'EQUATION'];
            if(mode === 'MULTI') types = ['MULTISELECT'];
            
            for(let i=0; i<count; i++) {
                let t = types[Math.floor(Math.random()*types.length)];
                queue.push(GENERATORS[t]());
            }
            
            document.getElementById('screen-menu').classList.remove('active');
            document.getElementById('screen-test').classList.add('active');
            renderQ();
        };

        window.nextQ = () => {
            if(currentIndex < queue.length-1) {
                currentIndex++;
                renderQ();
            } else {
                alert("Test Complete!");
                location.reload();
            }
        };

        window.prevQ = () => {
            if(currentIndex > 0) {
                currentIndex--;
                renderQ();
            }
        };

    </script>
</body>
</html>
