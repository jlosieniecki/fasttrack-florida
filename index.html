<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAST G3 - Zero-Repetition Engine</title>
    <style>
        :root { --header: #003057; --bg: #F5F7FA; --active: #003057; --text: #333; }
        body { font-family: 'Segoe UI', 'Verdana', sans-serif; background: var(--bg); margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }
        .top-bar { background: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; font-weight: bold; }
        .menu-container { overflow-y: auto; padding: 30px; text-align: center; background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; height: 100%; }
        .menu-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
        .std-btn { background: white; border: none; padding: 12px; margin: 5px 0; width: 100%; text-align: left; cursor: pointer; border-radius: 4px; font-size: 0.95em; transition: 0.2s; display: flex; justify-content: space-between; }
        .std-btn:hover { background: #eef6fc; transform: translateX(5px); color: var(--active); font-weight: bold; }
        .stage { flex: 1; padding: 20px; overflow-y: auto; display: flex; justify-content: center; background: white; }
        .q-card { width: 100%; max-width: 850px; padding-bottom: 100px; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 10px; color: #444; font-size: 1.1em; text-transform: uppercase; }
        .prompt { font-size: 1.3em; margin-bottom: 20px; line-height: 1.6; color: #111; }
        .mc-opt { padding: 15px; border: 1px solid #ddd; margin: 10px 0; cursor: pointer; display: flex; align-items: center; border-radius: 5px; background: #fff; }
        .mc-opt.selected { background: #e3f2fd; border: 2px solid var(--active); font-weight: bold; }
        .bubble { width: 22px; height: 22px; border: 2px solid #555; border-radius: 50%; margin-right: 15px; background: white; flex-shrink: 0; }
        .mc-opt.selected .bubble { background: #003057; border-color: #003057; }
        .edit-select { font-size: 1.1em; font-weight: bold; padding: 6px 12px; border: 2px solid #333; background: #eef; cursor: pointer; margin: 0 5px; border-radius: 4px; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #f4f4f4; border-top: 1px solid #bbb; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; box-sizing: border-box; }
        .nav-btn { padding: 12px 30px; font-weight: bold; cursor: pointer; border: 1px solid #999; background: white; border-radius: 4px; }
        .nav-btn.primary { background: var(--active); color: white; border-color: var(--active); }
        .visual-container { display: flex; justify-content: center; margin: 25px 0; background: #fff; border: 1px solid #eee; padding: 10px; }
        svg { max-height: 250px; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="menu-container">
            <h1>FAST Math Simulator</h1>
            <p>100% Dynamic Variation Engine (Levels 3-5)</p>
            <button class="std-btn" onclick="startTest('ALL', 40)" style="text-align:center; display:block; padding:15px; background:#fff; color:#003057;">
                <strong>ðŸš€ Start Full Mock Exam (40 Items)</strong>
            </button>
            <div id="menu-links"></div>
        </div>
    </div>

    <div id="screen-test" class="screen">
        <div class="top-bar"><div>G3 Math Mastery</div><button onclick="location.reload()">Exit</button></div>
        <div class="stage"><div id="q-container" class="q-card"></div></div>
        <div class="nav-bar">
            <button class="nav-btn" onclick="prevQ()">Back</button>
            <div style="font-weight:bold;">Item <span id="q-idx">1</span> of <span id="q-total">0</span></div>
            <button class="nav-btn primary" onclick="nextQ()">Next</button>
        </div>
    </div>

    <script>
        // --- RANDOMIZATION LIBRARIES ---
        const NAMES = ["Maya", "James", "Sofia", "Liam", "Zara", "Noah", "Elena", "Lucas", "Aria", "Mateo"];
        const ITEMS = ["marbles", "stickers", "trading cards", "shells", "beads", "pencils", "stamps"];
        const VERBS = ["collected", "bought", "organized", "found", "received"];

        const getRand = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        // --- DRAWING ENGINE ---
        const drawClock = (h, m) => {
            let mAng = m * 6, hAng = (h % 12) * 30 + (m * 0.5);
            let mRad = (mAng - 90) * Math.PI / 180, hRad = (hAng - 90) * Math.PI / 180;
            let hx = 50 + 25 * Math.cos(hRad), hy = 50 + 25 * Math.sin(hRad);
            let mx = 50 + 35 * Math.cos(mRad), my = 50 + 35 * Math.sin(mRad);
            return `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="white" stroke="#333" stroke-width="2"/><line x1="50" y1="50" x2="${hx}" y2="${hy}" stroke="black" stroke-width="4"/><line x1="50" y1="50" x2="${mx}" y2="${my}" stroke="#003057" stroke-width="2"/><circle cx="50" cy="50" r="2" fill="black"/></svg>`;
        };

        const drawModel = (den, num) => {
            let paths = "";
            for(let i=0; i<den; i++) {
                let s = (i * 360 / den - 90) * Math.PI/180, e = ((i+1) * 360 / den - 90) * Math.PI/180;
                let x1=50+45*Math.cos(s), y1=50+45*Math.sin(s), x2=50+45*Math.cos(e), y2=50+45*Math.sin(e);
                paths += `<path d="M50,50 L${x1},${y1} A45,45 0 0,1 ${x2},${y2} Z" fill="${i < num ? '#003057' : 'white'}" stroke="#333"/>`;
            }
            return `<svg viewBox="0 0 100 100">${paths}</svg>`;
        };

        // --- THE DYNAMIC GENERATOR ---
        const STANDARDS = {
            "MA.3.NSO.1.1": [
                () => {
                    let n = randInt(1000, 9999);
                    return { type:'mc', std:'NSO.1.1', text:`Which of the following has the same value as <b>${n.toLocaleString()}</b>?`, 
                        opts: [
                            {txt: `${Math.floor(n/1000)} thousands, ${Math.floor((n%1000)/100)} hundreds, ${Math.floor((n%100)/10)} tens, and ${n%10} ones`, corr:true},
                            {txt: `${Math.floor(n/1000)} thousands, ${n%100} tens`, corr:false},
                            {txt: `${Math.floor(n/100)} hundreds`, corr:false}
                        ] };
                },
                () => {
                    let n = randInt(1000, 9000);
                    return { type:'multi', std:'NSO.1.1', text:`Select <b>ALL</b> correct ways to write <b>${n.toLocaleString()}</b>.`, 
                        opts: [{txt:`${n} ones`, corr:true}, {txt:`${Math.floor(n/1000)} thousands + ${n%1000} ones`, corr:true}, {txt:`${n/10} tens`, corr:false}] };
                }
            ],
            "MA.3.NSO.2.1": [
                () => {
                    let p = getRand(NAMES), i = getRand(ITEMS), a = randInt(1000, 4000), b = randInt(500, 900);
                    return { type:'eq', std:'NSO.2.1', text:`${p} ${getRand(VERBS)} ${a} ${i} on Monday and ${b} ${i} on Tuesday. How many ${i} did ${p} find in total?`, ans:(a+b).toString() };
                }
            ],
            "MA.3.FR.1.1": [
                () => {
                    let d = [4, 6, 8][randInt(0, 2)], n = randInt(1, d-1);
                    return { type:'mc', std:'FR.1.1', text:`Which fraction represents the shaded part of the model?`, visual: drawModel(d, n), opts:[{txt:`${n}/${d}`, corr:true}, {txt:`${d}/${n}`, corr:false}, {txt:`1/${d}`, corr:false}] };
                }
            ],
            "MA.3.M.2.1": [
                () => {
                    let h = randInt(1, 12), m = randInt(1, 59);
                    let mStr = m < 10 ? "0"+m : m;
                    return { type:'mc', std:'M.2.1', text:`What time is shown on the clock?`, visual: drawClock(h, m), opts:[{txt:`${h}:${mStr}`, corr:true}, {txt:`${h+1}:${mStr}`, corr:false}, {txt:`${h}:${m+5}`, corr:false}] };
                }
            ]
        };

        // --- SESSION LOGIC ---
        let queue = [], curr = 0, answers = {};

        function startTest(mode, count) {
            queue = []; answers = {}; curr = 0;
            let keys = Object.keys(STANDARDS);
            if(mode !== 'ALL') keys = keys.filter(k => k === mode);
            
            for(let i=0; i<count; i++) {
                let k = getRand(keys);
                let variations = STANDARDS[k];
                queue.push(variations[randInt(0, variations.length - 1)]());
            }

            document.getElementById('screen-menu').classList.remove('active');
            document.getElementById('screen-test').classList.add('active');
            document.getElementById('q-total').innerText = queue.length;
            render();
        }

        function render() {
            let q = queue[curr], ans = answers[curr], html = `<h2>${q.std}</h2><div class="prompt">${q.text}</div>`;
            if(q.visual) html += `<div class="visual-container">${q.visual}</div>`;
            
            if(q.type === 'mc') {
                q.opts.forEach((o, i) => html += `<div class="mc-opt ${ans===i?'selected':''}" onclick="save(${i})"><div class="bubble"></div>${o.txt}</div>`);
            } else if(q.type === 'eq') {
                html += `<input type="text" class="edit-select" style="width:200px" oninput="save(this.value)" value="${ans||''}" placeholder="Type answer...">`;
            } else if(q.type === 'multi') {
                ans = ans || [];
                q.opts.forEach((o, i) => html += `<div class="mc-opt ${ans.includes(i)?'selected':''}" onclick="saveMulti(${i})"><div class="bubble square"></div>${o.txt}</div>`);
            }

            document.getElementById('q-container').innerHTML = html;
            document.getElementById('q-idx').innerText = curr + 1;
        }

        window.save = (v) => { answers[curr] = v; render(); };
        window.saveMulti = (i) => {
            let a = answers[curr] || [];
            if(a.includes(i)) a = a.filter(x => x !== i); else a.push(i);
            answers[curr] = a; render();
        };

        window.nextQ = () => { if(curr < queue.length-1) { curr++; render(); } else alert("Test finished!"); };
        window.prevQ = () => { if(curr > 0) { curr--; render(); } };

        // Build Menu
        const menu = document.getElementById('menu-links');
        Object.keys(STANDARDS).forEach(k => {
            let card = document.createElement('div'); card.className = "menu-card";
            card.innerHTML = `<h3>${k}</h3><button class="std-btn" onclick="startTest('${k}', 5)">Practice 5 Items</button>`;
            menu.appendChild(card);
        });
    </script>
</body>
</html>
