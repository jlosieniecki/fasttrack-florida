<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAST Grade 3 Math Portal</title>
    <style>
        :root { --header: #2C3E50; --bg: #F5F7FA; --active: #3498DB; --text: #333; }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* --- SCREENS --- */
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* --- MENU --- */
        .menu-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #2C3E50, #2980b9); color: white; padding: 20px; }
        .menu-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; color: #333; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .menu-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 1.05em; cursor: pointer; transition: 0.2s; background: #f9f9f9; text-align: left; }
        .menu-btn:hover { background: #e3f2fd; border-color: var(--active); transform: translateX(5px); }
        .menu-btn strong { display: block; color: var(--header); }

        /* --- TEST INTERFACE --- */
        .top-bar { background: var(--header); color: white; padding: 0 15px; height: 50px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .tool-btn { background: rgba(255,255,255,0.1); border: 1px solid #7F8C8D; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-left:5px;}

        .main-stage { flex: 1; padding: 10px; overflow: hidden; display: flex; gap: 10px; height: 100%; position: relative; }
        .pane { background: white; border-radius: 6px; padding: 20px; overflow-y: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.05); height: 100%; box-sizing: border-box; }
        
        /* RESPONSIVE LAYOUT */
        .left-pane { width: 40%; background: #FAFAFA; border-right: 1px solid #ddd; display: flex; align-items: center; justify-content: center; }
        .right-pane { width: 60%; }
        @media (max-width: 768px) {
            .main-stage { flex-direction: column; }
            .left-pane { width: 100%; height: 35%; border-right: none; border-bottom: 2px solid #ddd; }
            .right-pane { width: 100%; height: 65%; }
        }

        /* CONTENT */
        .q-header { color: #555; font-weight: bold; margin-bottom: 10px; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }
        .q-text { font-size: 1.25em; line-height: 1.5; color: #222; margin-bottom: 20px; }
        svg { width: 100%; height: auto; max-height: 250px; }

        /* INTERACTION */
        .opt-row { display: flex; padding: 12px; margin-bottom: 8px; cursor: pointer; border: 1px solid #eee; border-radius: 6px; align-items: center; background: #fff; transition:0.1s; }
        .opt-row:hover { background: #f5f5f5; border-color: #ccc; }
        .opt-row.selected { background: #EBF5FB; border-color: var(--active); font-weight: bold; border-left: 5px solid var(--active); }
        .bubble { width: 20px; height: 20px; border: 2px solid #999; border-radius: 50%; margin-right: 12px; flex-shrink: 0; background: white; }
        .opt-row.selected .bubble { background: var(--active); border-color: var(--active); }
        .input-box { font-size: 1.4em; padding: 8px; width: 120px; text-align: center; border: 2px solid #ccc; border-radius: 6px; }

        /* FOOTER */
        .nav-bar { background: white; border-top: 1px solid #ddd; height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; flex-shrink: 0; }
        .nav-btn { background: var(--active); color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 1em; font-weight: bold; cursor: pointer; min-width: 80px; }

        /* REPORT CARD */
        .report-header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .level-badge { display: inline-block; padding: 5px 15px; border-radius: 15px; color: white; font-weight: bold; font-size: 1.2em; margin-top: 10px; }
        .lvl-1 { background: #F44336; } .lvl-2 { background: #FF9800; } .lvl-3 { background: #FFC107; color: #333; } .lvl-4 { background: #4CAF50; } .lvl-5 { background: #009688; }
        .strength-grid { display: grid; grid-template-columns: 1fr; gap: 10px; text-align: left; }
        .stat-row { display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 6px; border-left: 4px solid #ccc; }
        .stat-good { border-left-color: #4CAF50; } .stat-bad { border-left-color: #F44336; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="menu-container">
            <div class="menu-card">
                <img src="Gemini_Generated_Image_t8043ht8043ht804.png" style="width:70px; border-radius:10px; margin-bottom:15px;" alt="Logo">
                <h2 style="margin:0;">FAST Math Portal</h2>
                <p style="color:#666; margin-bottom:20px;">Unlimited Practice Generator</p>
                
                <button class="menu-btn" onclick="initSession('ALL', 35)">
                    <strong>üöÄ Full FAST Mock Exam</strong>
                    <small>35 Questions ‚Ä¢ All Domains ‚Ä¢ Official Scoring</small>
                </button>
                <button class="menu-btn" onclick="initSession('FR', 15)">
                    <strong>üçï Fractions Mastery</strong>
                    <small>15 Questions ‚Ä¢ Partitioning & Comparing</small>
                </button>
                <button class="menu-btn" onclick="initSession('NSO', 20)">
                    <strong>üî¢ Number Sense & Ops</strong>
                    <small>20 Questions ‚Ä¢ Place Value & Multi-Digit</small>
                </button>
                <button class="menu-btn" onclick="initSession('AR', 15)">
                    <strong>üß† Algebraic Reasoning</strong>
                    <small>15 Questions ‚Ä¢ Logic & Word Problems</small>
                </button>
                <button class="menu-btn" onclick="initSession('GR', 15)">
                    <strong>üìê Geometry & Data</strong>
                    <small>15 Questions ‚Ä¢ Perimeter, Area, Graphs</small>
                </button>
            </div>
        </div>
    </div>

    <div id="screen-test" class="screen">
        <div class="top-bar">
            <div><strong>Student: Guest</strong> | <span id="session-label">Test</span></div>
            <div>
                <button class="tool-btn" onclick="toggleZoom()">üîç Zoom</button>
                <button class="tool-btn" onclick="alert('Reference Sheet Loaded')">üìÑ Formulas</button>
                <button class="tool-btn" style="background:#C0392B" onclick="location.reload()">Exit</button>
            </div>
        </div>

        <div id="stage" class="main-stage"></div>

        <div class="nav-bar">
            <button class="nav-btn" style="background:white; color:#333; border:2px solid #ccc;" onclick="prevQ()">Back</button>
            <div style="font-weight:bold; color:#555;">Item <span id="q-idx">1</span> of <span id="q-total">35</span></div>
            <button id="btn-next" class="nav-btn" onclick="nextQ()">Next</button>
        </div>
    </div>

    <div id="screen-report" class="screen">
        <div class="menu-container" style="background: #f4f4f4; color: #333;">
            <div class="menu-card" style="width: 100%; max-width: 600px;">
                <div class="report-header">
                    <h1 style="margin:0;">Performance Report</h1>
                    <div id="final-badge" class="level-badge lvl-3">Level 3</div>
                    <p id="final-msg" style="margin-top:5px; color:#666;">On Grade Level</p>
                </div>
                <div id="report-grid" class="strength-grid"></div>
                <button class="menu-btn" style="margin-top:20px; text-align:center; background:var(--active); color:white;" onclick="location.reload()">Return to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // --- INFINITE QUESTION GENERATORS ---
        // These functions create NEW questions every time they are called.
        
        const GENERATORS = {
            // --- NUMBER SENSE (NSO) ---
            NSO: [
                () => { // Place Value
                    let n = 1000 + Math.floor(Math.random() * 8999);
                    let th = Math.floor(n/1000)*1000, h = Math.floor((n%1000)/100)*100, t = Math.floor((n%100)/10)*10, o = n%10;
                    return {
                        cat: "NSO", type: "choice", layout: "full",
                        text: `What is the expanded form of <b>${n.toLocaleString()}</b>?`,
                        opts: [
                            `${th} + ${h} + ${t} + ${o}`,
                            `${th} + ${h/10} + ${t} + ${o}`,
                            `${th} + ${h} + ${t}0 + ${o}`,
                            `${Math.floor(n/1000)} + ${Math.floor((n%1000)/100)} + ${Math.floor((n%100)/10)} + ${o}`
                        ].sort(() => Math.random()-0.5),
                        ans: `${th} + ${h} + ${t} + ${o}`
                    };
                },
                () => { // Multiplication
                    let a = Math.floor(Math.random()*8)+2, b = Math.floor(Math.random()*9)+2;
                    return { cat: "NSO", type: "input", layout: "full", text: `Solve: ${a} √ó ${b} = ?`, ans: (a*b).toString() };
                },
                () => { // Rounding
                    let n = Math.floor(Math.random()*800)+100;
                    let rounded = Math.round(n/100)*100;
                    return { 
                        cat: "NSO", type: "choice", layout: "full",
                        text: `Round <b>${n}</b> to the nearest hundred.`,
                        opts: [(Math.floor(n/100)*100).toString(), (Math.ceil(n/100)*100).toString(), (n+10).toString()].sort(()=>Math.random()-0.5),
                        ans: rounded.toString()
                    };
                }
            ],

            // --- FRACTIONS (FR) ---
            FR: [
                () => { // Unit Fractions
                    let d = [3,4,6,8][Math.floor(Math.random()*4)];
                    return {
                        cat: "FR", type: "choice", layout: "split",
                        visual: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="#333" stroke-width="2"/><path d="M50,50 L50,5 A45,45 0 0,1 ${50 + 45 * Math.sin(2*Math.PI/d)},${50 - 45 * Math.cos(2*Math.PI/d)} Z" fill="#3498DB" stroke="#333"/></svg>`,
                        text: `The circle is divided into ${d} equal parts. What fraction represents the shaded part?`,
                        opts: [`1/${d}`, `1/${d-1}`, `${d}/1`, `2/${d}`],
                        ans: `1/${d}`
                    };
                },
                () => { // Comparison
                    let n1 = 1, d1 = [3,4,6,8][Math.floor(Math.random()*4)];
                    let n2 = 1, d2 = [3,4,6,8].filter(x=>x!=d1)[Math.floor(Math.random()*3)];
                    let correct = (1/d1 > 1/d2) ? ">" : "<";
                    return {
                        cat: "FR", type: "choice", layout: "full",
                        text: `Select the correct symbol: <b>1/${d1} ___ 1/${d2}</b>`,
                        opts: [">", "<", "="],
                        ans: correct
                    };
                }
            ],

            // --- ALGEBRAIC REASONING (AR) ---
            AR: [
                () => { // Unknown Factor
                    let a = Math.floor(Math.random()*8)+2, b = Math.floor(Math.random()*8)+2;
                    let prod = a*b;
                    return {
                        cat: "AR", type: "input", layout: "full",
                        text: `Find the missing number: ? √ó ${a} = ${prod}`,
                        ans: b.toString()
                    };
                },
                () => { // Word Problem
                    let items = ["apples","stickers","cards","books"];
                    let item = items[Math.floor(Math.random()*items.length)];
                    let start = Math.floor(Math.random()*20)+10;
                    let add = Math.floor(Math.random()*10)+5;
                    return {
                        cat: "AR", type: "input", layout: "full",
                        text: `Leo has ${start} ${item}. He buys ${add} more. How many ${item} does he have now?`,
                        ans: (start+add).toString()
                    };
                }
            ],

            // --- GEOMETRY & DATA (GR) ---
            GR: [
                () => { // Perimeter
                    let l = Math.floor(Math.random()*10)+5;
                    let w = Math.floor(Math.random()*8)+2;
                    return {
                        cat: "GR", type: "choice", layout: "split",
                        visual: `<svg viewBox="0 0 200 150"><rect x="50" y="40" width="100" height="70" fill="#ddd" stroke="black" stroke-width="2"/><text x="100" y="30" text-anchor="middle">${l}</text><text x="160" y="80">${w}</text></svg>`,
                        text: `What is the perimeter of this rectangle?`,
                        opts: [(2*l+2*w).toString(), (l*w).toString(), (l+w).toString(), (2*l+w).toString()].sort(()=>Math.random()-0.5),
                        ans: (2*l+2*w).toString()
                    };
                },
                () => { // Time
                    let h = Math.floor(Math.random()*11)+1;
                    let m = [0,15,30,45][Math.floor(Math.random()*4)];
                    let add = 15;
                    let endM = m + add;
                    let displayM = endM === 60 ? "00" : endM;
                    let displayH = endM === 60 ? h+1 : h;
                    return {
                        cat: "GR", type: "choice", layout: "full",
                        text: `A movie starts at ${h}:${m==0?'00':m}. It is 15 minutes long. What time does it end?`,
                        opts: [`${displayH}:${displayM}`, `${h}:${m+5}`, `${h+1}:${m}`].sort(()=>Math.random()-0.5),
                        ans: `${displayH}:${displayM}`
                    };
                }
            ]
        };

        // --- SESSION STATE ---
        let sessionQ = [];
        let curIdx = 0;
        let userAnswers = [];

        function initSession(mode, count) {
            sessionQ = [];
            userAnswers = [];
            
            // Build the Queue
            for(let i=0; i<count; i++) {
                let cat = mode;
                if(mode === 'ALL') {
                    // Weighted random selection for full test
                    let r = Math.random();
                    if(r < 0.30) cat = 'NSO';
                    else if(r < 0.50) cat = 'FR';
                    else if(r < 0.65) cat = 'AR';
                    else cat = 'GR';
                }
                // Pick a random generator from that category
                let gens = GENERATORS[cat];
                let gen = gens[Math.floor(Math.random() * gens.length)];
                sessionQ.push(gen());
            }

            // Start
            curIdx = 0;
            document.getElementById('session-label').innerText = mode === 'ALL' ? "Full FAST Mock" : mode + " Practice";
            document.getElementById('q-total').innerText = count;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-test').classList.add('active');
            renderQ();
        }

        function renderQ() {
            const q = sessionQ[curIdx];
            const stage = document.getElementById('stage');
            const ans = userAnswers[curIdx];

            let left = q.layout === "split" ? `<div class="left-pane">${q.visual}</div>` : "";
            let rClass = q.layout === "split" ? "right-pane" : "right-pane" // Simplified css logic
            if(q.layout === 'full') {
                 // Hack for full width in existing css
                 document.documentElement.style.setProperty('--right-width', '100%'); 
                 left = "";
            }

            let inputHtml = "";
            if(q.type === 'choice') {
                q.opts.forEach(o => {
                    let sel = ans === o ? 'selected' : '';
                    inputHtml += `<div class="opt-row ${sel}" onclick="save('${o}')"><div class="bubble"></div>${o}</div>`;
                });
            } else {
                inputHtml = `<input class="input-box" value="${ans||''}" onchange="save(this.value)" placeholder="?">`;
            }

            stage.innerHTML = `
                ${left}
                <div class="pane ${q.layout==='full'?'':'right-pane'}" style="width:${q.layout==='full'?'100%':'60%'}">
                    <div class="q-header">${q.cat} Domain ‚Ä¢ Item ${curIdx+1}</div>
                    <div class="q-text">${q.text}</div>
                    ${inputHtml}
                </div>
            `;
            
            // Update button text
            document.getElementById('btn-next').innerText = (curIdx === sessionQ.length-1) ? "Finish" : "Next";
            document.getElementById('q-idx').innerText = curIdx + 1;
        }

        window.save = (val) => { userAnswers[curIdx] = val; renderQ(); };
        window.nextQ = () => {
            if(curIdx < sessionQ.length-1) { curIdx++; renderQ(); }
            else { finishSession(); }
        };
        window.prevQ = () => { if(curIdx > 0) { curIdx--; renderQ(); } };
        window.toggleZoom = () => { document.body.style.zoom = document.body.style.zoom === "1.2" ? "1" : "1.2"; }

        function finishSession() {
            let score = 0;
            let stats = { NSO:{c:0,t:0}, FR:{c:0,t:0}, AR:{c:0,t:0}, GR:{c:0,t:0} };

            sessionQ.forEach((q, i) => {
                let correct = (userAnswers[i] == q.ans); // Loose equality for string/num
                if(!stats[q.cat]) stats[q.cat] = {c:0,t:0};
                stats[q.cat].t++;
                if(correct) { score++; stats[q.cat].c++; }
            });

            // Report Logic
            let pct = Math.round((score / sessionQ.length) * 100);
            let lvl = 1, txt = "Level 1", cls = "lvl-1", msg = "Intervention Needed";
            
            if(pct >= 40) { lvl=2; txt="Level 2"; cls="lvl-2"; msg="Below Satisfactory"; }
            if(pct >= 60) { lvl=3; txt="Level 3"; cls="lvl-3"; msg="On Grade Level"; }
            if(pct >= 80) { lvl=4; txt="Level 4"; cls="lvl-4"; msg="Proficient"; }
            if(pct >= 90) { lvl=5; txt="Level 5"; cls="lvl-5"; msg="Mastery!"; }

            document.getElementById('final-badge').className = "level-badge " + cls;
            document.getElementById('final-badge').innerText = txt;
            document.getElementById('final-msg').innerText = `${msg} (${pct}%)`;

            let html = "";
            for(let k in stats) {
                if(stats[k].t === 0) continue;
                let sPct = Math.round((stats[k].c / stats[k].t) * 100);
                let status = sPct >= 60 ? "stat-good" : "stat-bad";
                let label = sPct >= 60 ? "‚úÖ Strength" : "‚ö†Ô∏è Needs Practice";
                html += `
                <div class="stat-row ${status}">
                    <div><strong>${k}</strong></div>
                    <div>${stats[k].c}/${stats[k].t} (${sPct}%)</div>
                    <div>${label}</div>
                </div>`;
            }
            document.getElementById('report-grid').innerHTML = html;

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-report').classList.add('active');
        }
    </script>
</body>
</html>
