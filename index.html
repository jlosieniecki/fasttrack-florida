<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida FAST Math Simulator (Grade 3)</title>
    <style>
        /* --- 1. CAMBIUM AUTHENTIC THEME --- */
        :root {
            --fast-bg: #f2f2f2;           
            --fast-card-bg: #ffffff;      
            --fast-text: #000000;
            --fast-blue: #005ea2;         
            --fast-hover: #e1f3f8;        
            --fast-border: #000000;       
            --fast-grey-row: #f0f0f0;     
        }

        body {
            font-family: 'Verdana', 'Arial', sans-serif;
            background-color: var(--fast-bg);
            margin: 0;
            padding-bottom: 100px; /* Space for footer */
            color: var(--fast-text);
        }

        /* The "Paper" Area */
        #question-card {
            max-width: 900px;
            margin: 40px auto;
            background: var(--fast-card-bg);
            padding: 50px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .question-stem {
            font-size: 22px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* --- 2. DYNAMIC IMAGES (FRACTIONS) --- */
        .fraction-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 2px solid #000;
            margin: 0 auto 20px auto;
            /* This is handled by JS dynamically */
            background: conic-gradient(var(--fast-blue) 0% 0%, white 0% 100%); 
        }

        /* --- 3. HOT TEXT STYLES --- */
        .hot-text-container {
            font-size: 24px;
            line-height: 2.5;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hot-spot {
            padding: 6px 12px;
            margin: 0 4px;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .hot-spot:hover {
            background-color: var(--fast-hover);
            border-color: #bcd6ed;
        }

        .hot-spot.selected {
            background-color: var(--fast-blue);
            color: white;
            border-color: var(--fast-blue);
        }

        /* --- 4. TABLE MATCH STYLES --- */
        .fast-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 18px;
        }

        .fast-table th {
            background-color: #fff;
            border-bottom: 2px solid #000;
            padding: 15px;
            text-align: center;
        }

        .fast-table td {
            padding: 15px;
            border-bottom: 1px solid #ccc;
            text-align: center;
        }

        .fast-table tr:nth-child(even) { background-color: var(--fast-grey-row); }
        .fast-table tr:nth-child(odd) { background-color: #fff; }

        input[type="radio"].fast-radio {
            width: 24px;
            height: 24px;
            accent-color: var(--fast-blue);
            cursor: pointer;
        }

        /* --- 5. EQUATION EDITOR (KEYPAD) --- */
        .equation-display {
            width: 100%;
            max-width: 400px;
            height: 60px;
            border: 2px solid #333;
            font-size: 32px;
            padding: 10px;
            margin-bottom: 20px;
            background: #fff;
            display: flex;
            align-items: center;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 300px;
        }

        .keypad-btn {
            padding: 15px;
            font-size: 20px;
            background: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .keypad-btn:active { background: #e2e6ea; }
        .keypad-btn.action { background: #e1f3f8; border-color: #005ea2; color: #005ea2; }

        /* --- 6. FOOTER BAR --- */
        .fast-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background-color: #e6e6e6;
            border-top: 1px solid #b3b3b3;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            box-sizing: border-box;
            z-index: 100;
        }

        .nav-btn {
            font-size: 18px;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #aaa;
        }

        .btn-next { background-color: var(--fast-blue); color: white; border: none; font-weight: bold; }
        .btn-back { background-color: white; color: #333; }

        /* --- 7. REVIEW SCREEN --- */
        .review-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .review-item {
            border: 1px solid #ccc;
            padding: 15px;
            background: #fff;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }

        .review-item:hover { border-color: var(--fast-blue); background: #f0f8ff; }
        .status-answered { color: var(--fast-blue); font-weight: bold; }
        .status-unanswered { color: #d9534f; font-weight: bold; }

    </style>
</head>
<body>

    <div id="question-card">
        </div>

    <div class="fast-footer" id="nav-controls">
        <button class="nav-btn btn-back" onclick="prevQuestion()">Back</button>
        <div style="font-weight: bold; font-size: 18px;">
            Item <span id="q-num">1</span> of <span id="q-total">3</span>
        </div>
        <button class="nav-btn btn-next" onclick="nextQuestion()">Next</button>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let currentQuestionIndex = 0;
        let questions = [];
        let userAnswers = []; // Stores answers

        // --- 1. GENERATE QUESTIONS ---

        // MA.3.NSO.1.1 - Table Match
        function generateTableMatch() {
            const thousands = Math.floor(Math.random() * 9) + 1;
            const ones = Math.floor(Math.random() * 9) + 1;
            const fullNumber = (thousands * 1000) + ones; 

            return {
                type: 'table_match',
                standard: 'MA.3.NSO.1.1',
                text: `The number is **${fullNumber.toLocaleString()}**. Match the value of the digits below.`,
                contextNumber: fullNumber,
                rows: [
                    { label: `The value of the digit ${thousands}`, id: 'r1' },
                    { label: `The value of the digit ${ones}`, id: 'r2' }
                ],
                columns: ["Thousands", "Hundreds", "Ones"]
            };
        }

        // MA.3.NSO.1.2 - Hot Text
        function generateHotText() {
            const target = Math.floor(Math.random() * 800) + 100;
            return {
                type: 'hot_text',
                standard: 'MA.3.NSO.1.2',
                text: `Select the digit in the **tens** place.`,
                content: target.toString()
            };
        }

        // MA.3.FR.1.1 - Equation (Dynamic Image)
        function generateEquation() {
            const denominator = [2, 3, 4, 6, 8][Math.floor(Math.random() * 5)];
            const numerator = 1; // Simplest unit fraction for demo
            
            return {
                type: 'equation',
                standard: 'MA.3.FR.1.1',
                text: "What fraction represents the shaded part? Use the keypad.",
                num: numerator,
                den: denominator
            };
        }

        // Initialize Test
        questions.push(generateTableMatch());
        questions.push(generateHotText());
        questions.push(generateEquation());
        
        userAnswers = new Array(questions.length).fill(null);
        document.getElementById('q-total').innerText = questions.length;

        // --- 2. RENDERERS ---

        function renderQuestion(index) {
            currentQuestionIndex = index;
            const q = questions[index];
            const container = document.getElementById('question-card');
            
            // Show Footer
            document.getElementById('nav-controls').style.display = 'flex';
            document.getElementById('q-num').innerText = index + 1;
            
            let html = `<div class="question-stem">${q.text}</div>`;

            if (q.type === 'table_match') {
                html += renderTableMatchHTML(q, index);
            } else if (q.type === 'hot_text') {
                html += renderHotTextHTML(q, index);
            } else if (q.type === 'equation') {
                html += renderEquationHTML(q, index);
            }

            container.innerHTML = html;
            
            // Restore keypad value if previously answered
            if(q.type === 'equation') {
                currentEqValue = userAnswers[index] || "";
                document.getElementById('eq-display').innerText = currentEqValue;
            }
        }

        function renderTableMatchHTML(q, index) {
            return `
                <div style="margin-bottom:20px; font-size:20px; background:#f9f9f9; padding:15px; border-left:4px solid var(--fast-blue);">
                    Reference Number: <strong>${q.contextNumber}</strong>
                </div>
                <table class="fast-table">
                    <thead>
                        <tr><th></th>${q.columns.map(col => `<th>${col}</th>`).join('')}</tr>
                    </thead>
                    <tbody>
                        ${q.rows.map((row, rIdx) => `
                            <tr>
                                <td class="row-label">${row.label}</td>
                                ${q.columns.map(col => `
                                    <td>
                                        <input type="radio" 
                                               name="row_${rIdx}" 
                                               class="fast-radio" 
                                               value="${col}"
                                               ${userAnswers[index] && userAnswers[index][`row_${rIdx}`] === col ? 'checked' : ''}
                                               onchange="saveTableAnswer(${index}, 'row_${rIdx}', '${col}')">
                                    </td>
                                `).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;
        }

        function renderHotTextHTML(q, index) {
            const digits = q.content.split('');
            return `
                <div class="hot-text-container">
                    ${digits.map((digit, i) => `
                        <span class="hot-spot ${userAnswers[index] === i ? 'selected' : ''}" 
                              onclick="saveHotTextAnswer(${index}, this, ${i})">${digit}</span>
                    `).join('')}
                </div>`;
        }

        function renderEquationHTML(q, index) {
            // Dynamic Circle Generator using CSS Conic Gradient
            const percentage = (q.num / q.den) * 100;
            
            return `
                <div style="text-align:center;">
                    <div class="fraction-circle" 
                         style="background: conic-gradient(var(--fast-blue) 0% ${percentage}%, white ${percentage}% 100%);">
                    </div>
                    <p style="color:#666; font-size:14px;">(Shaded part: ${q.num} out of ${q.den})</p>
                </div>

                <div class="equation-display" id="eq-display"></div>
                <div class="keypad">
                    <button class="keypad-btn" onclick="typeKey('1')">1</button>
                    <button class="keypad-btn" onclick="typeKey('2')">2</button>
                    <button class="keypad-btn" onclick="typeKey('3')">3</button>
                    <button class="keypad-btn" onclick="typeKey('4')">4</button>
                    <button class="keypad-btn" onclick="typeKey('5')">5</button>
                    <button class="keypad-btn" onclick="typeKey('6')">6</button>
                    <button class="keypad-btn" onclick="typeKey('7')">7</button>
                    <button class="keypad-btn" onclick="typeKey('8')">8</button>
                    <button class="keypad-btn" onclick="typeKey('9')">9</button>
                    <button class="keypad-btn action" onclick="typeKey('/')">/</button>
                    <button class="keypad-btn" onclick="typeKey('0')">0</button>
                    <button class="keypad-btn action" onclick="backspace()">âŒ«</button>
                </div>`;
        }

        // --- 3. REVIEW SCREEN LOGIC ---
        function renderReviewScreen() {
            const container = document.getElementById('question-card');
            
            // Hide normal footer
            document.getElementById('nav-controls').style.display = 'none';

            let html = `
                <div style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px;">
                    <h2>Review Your Answers</h2>
                    <p>Click any question to return to it.</p>
                </div>
                <div class="review-grid">
                    ${questions.map((q, i) => `
                        <div class="review-item" onclick="renderQuestion(${i})">
                            <span>Question ${i+1}</span>
                            <span class="${userAnswers[i] ? 'status-answered' : 'status-unanswered'}">
                                ${userAnswers[i] ? 'Answered' : 'Unanswered'}
                            </span>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 40px; text-align: right;">
                    <button class="nav-btn btn-next" style="font-size: 20px; padding: 15px 30px;" onclick="finishTest()">Submit Test</button>
                </div>
            `;
            container.innerHTML = html;
        }

        function finishTest() {
            document.getElementById('question-card').innerHTML = `
                <div style="text-align:center; padding: 60px;">
                    <h1 style="color: var(--fast-blue); font-size: 48px;">Test Submitted</h1>
                    <p style="font-size: 20px;">Your answers have been recorded.</p>
                    <button class="nav-btn btn-next" onclick="location.reload()" style="margin-top:20px;">Start New Test</button>
                </div>
            `;
        }

        // --- 4. INTERACTION ---

        function saveTableAnswer(qIndex, rowId, value) {
            if (!userAnswers[qIndex]) userAnswers[qIndex] = {};
            userAnswers[qIndex][rowId] = value;
        }

        function saveHotTextAnswer(qIndex, el, digitIndex) {
            document.querySelectorAll('.hot-spot').forEach(s => s.classList.remove('selected'));
            el.classList.add('selected');
            userAnswers[qIndex] = digitIndex;
        }

        let currentEqValue = "";
        function typeKey(val) {
            currentEqValue += val;
            updateDisplay();
            userAnswers[currentQuestionIndex] = currentEqValue;
        }
        function backspace() {
            currentEqValue = currentEqValue.slice(0, -1);
            updateDisplay();
            userAnswers[currentQuestionIndex] = currentEqValue;
        }
        function updateDisplay() {
            document.getElementById('eq-display').innerText = currentEqValue;
        }

        // --- 5. NAVIGATION ---
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            } else {
                renderReviewScreen();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        }

        // Start
        renderQuestion(0);

    </script>
</body>
</html>
