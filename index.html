<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST Gr3 Acc | Master Simulator</title>
    <style>
        :root {
            --primary: #004d40; --accent: #e65100; --bg: #f5f7fa; --panel: #ffffff;
            --text: #263238; --border: #cfd8dc; --sel: #e0f2f1;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* LAYOUT */
        .sidebar { width: 340px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; height: 100vh; }
        .logo { padding: 25px; background: var(--primary); color: white; flex-shrink: 0; }
        .logo h1 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
        .logo p { margin: 5px 0 0; font-size: 0.8rem; opacity: 0.9; }
        
        .sim-btn {
            margin: 20px; padding: 15px; background: var(--accent); color: white; text-align: center;
            border-radius: 8px; font-weight: bold; cursor: pointer; border: 2px solid #ef6c00;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex-shrink: 0; transition: transform 0.1s;
        }
        .sim-btn:hover { transform: translateY(-2px); }

        .menu { flex: 1; overflow-y: auto; padding: 0 15px 30px; }
        .cat { font-size: 0.75rem; text-transform: uppercase; color: #78909c; font-weight: 800; margin: 25px 0 8px; border-bottom: 2px solid #eceff1; padding-bottom: 5px; }
        .std { 
            display: block; width: 100%; text-align: left; padding: 12px; margin-bottom: 5px; 
            background: #fff; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; 
            font-size: 0.9rem; transition: 0.1s;
        }
        .std:hover { background: #e0f2f1; border-color: var(--primary); }
        .std small { display: block; font-size: 0.75rem; color: #78909c; margin-top: 3px; }

        .main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 40px; }
        .card { 
            background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); 
            max-width: 900px; margin: 0 auto; width: 100%; border-top: 6px solid var(--primary); 
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f5f5f5; padding-bottom: 15px; }
        .badge { background: #eceff1; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; color: #546e7a; }
        .score { font-weight: bold; color: var(--primary); }

        .prompt { font-size: 1.4rem; line-height: 1.5; margin-bottom: 30px; }
        .visual { background: #fafafa; border: 2px dashed #cfd8dc; border-radius: 8px; padding: 30px; margin-bottom: 30px; display: flex; justify-content: center; }

        .options { display: grid; gap: 12px; }
        .opt { 
            display: flex; align-items: center; padding: 18px; border: 2px solid #e0e0e0; border-radius: 8px; 
            background: white; cursor: pointer; font-size: 1.1rem; transition: 0.2s; 
        }
        .opt:hover { background: #f5f5f5; border-color: #b0bec5; }
        .opt.sel { background: var(--sel); border-color: var(--primary); box-shadow: inset 0 0 0 1px var(--primary); }
        .icon { width: 20px; height: 20px; border: 2px solid #607d8b; margin-right: 15px; display: flex; justify-content: center; align-items: center; }
        .radio .icon { border-radius: 50%; }
        .check .icon { border-radius: 4px; }
        .sel .radio .icon { background: var(--primary); border-color: var(--primary); }
        .sel .check .icon { background: var(--primary); border-color: var(--primary); }
        .sel .radio .icon::after { content:''; width: 8px; height: 8px; background: white; border-radius: 50%; }
        .sel .check .icon::after { content:'âœ”'; color: white; font-size: 14px; }

        .input-box { width: 100%; padding: 15px; font-size: 1.4rem; border: 2px solid #455a64; border-radius: 6px; }
        .tbl { border-collapse: collapse; margin: 0 auto; }
        .tbl td, .tbl th { border: 1px solid #999; padding: 10px 20px; text-align: center; font-size: 1.1rem; }
        .tbl input { width: 80px; padding: 5px; font-size: 1.1rem; text-align: center; border: 2px solid black; }

        .fb { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; }
        .fb.corr { background: #e8f5e9; color: #1b5e20; border: 1px solid #c8e6c9; }
        .fb.incorr { background: #ffebee; color: #b71c1c; border: 1px solid #ffcdd2; }

        .action-btn { margin-top: 25px; padding: 12px 30px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: bold; cursor: pointer; float: right; }
        .action-btn:disabled { background: #cfd8dc; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">
        <h1>FAST Gr3 Acc.</h1>
        <p>Complete Production Build</p>
    </div>
    <div class="sim-btn" onclick="App.startSim()">ðŸš€ Start Full Test Sim</div>
    <div class="menu" id="menu"></div>
</div>

<div class="main">
    <div class="card">
        <div class="header">
            <span class="badge" id="badge">Select Standard</span>
            <span class="score" id="score">Score: 0</span>
        </div>
        <div class="prompt" id="prompt">
            <strong>Ready.</strong><br>Select a standard or start the simulation.<br>
            Includes 33 Standards with Multi-Mode TEI Logic.
        </div>
        <div class="visual" id="visual" style="display:none;"></div>
        <div class="options" id="options"></div>
        <div class="fb" id="fb"></div>
        <button class="action-btn" id="btn" onclick="App.check()" disabled>Check Answer</button>
    </div>
</div>

<script>
// --- 1. ENGINE UTILITIES ---
const Utils = {
    rInt: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
    pick: (arr) => arr[Math.floor(Math.random() * arr.length)],
    shuffle: (arr) => arr.sort(() => Math.random() - 0.5),
    
    // Guaranteed 4 Unique Options
    genOpts: (corr, genFn) => {
        const s = new Set([corr]);
        let safe = 0;
        while(s.size < 4 && safe < 50) { s.add(genFn()); safe++; }
        return Array.from(s).sort(() => Math.random() - 0.5).map(x => ({t:x, c:x===corr}));
    },

    numToWords: (n) => {
        const ones = ['','one','two','three','four','five','six','seven','eight','nine'];
        const teens = ['ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'];
        const tens = ['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];
        if(n===0) return 'zero';
        let s = '';
        if(n>=1000){s+=ones[Math.floor(n/1000)]+' thousand '; n%=1000;}
        if(n>=100){s+=ones[Math.floor(n/100)]+' hundred '; n%=100;}
        if(n>=20){s+=tens[Math.floor(n/10)]+(n%10!==0?' ':'')+ones[n%10];}
        else if(n>=10){s+=teens[n-10];}
        else if(n>0){s+=ones[n];}
        return s.trim();
    },

    // --- VISUAL GENERATOR (B.E.S.T. Compliant) ---
    svg: {
        // Tiled Grid for Area/Perimeter
        tiled: (w, h) => {
            let s=''; for(let i=0;i<w;i++) for(let j=0;j<h;j++) s+=`<rect x="${20+i*20}" y="${20+j*20}" width="20" height="20" fill="#e0f2f1" stroke="#004d40" stroke-width="1"/>`;
            return `<svg width="${w*20+40}" height="${h*20+40}">${s}<text x="${20+w*10}" y="15" text-anchor="middle" font-size="10">${w}</text><text x="10" y="${20+h*10}" text-anchor="middle" font-size="10">${h}</text></svg>`;
        },
        // Fraction Models (Circle & Bar)
        fracCirc: (n,d) => `<svg width="120" height="120" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" stroke="#333" fill="#fff"/><path d="M50 50 L50 5 A45 45 0 ${d==2||(d==4&&n>2)?1:0} 1 ${50+45*Math.sin(2*Math.PI*n/d)} ${50-45*Math.cos(2*Math.PI*n/d)} Z" fill="#ff6f00" stroke="#333" opacity="${n>0?1:0}"/></svg>`,
        fracBar: (n,d) => {
            let s=''; for(let i=0;i<d;i++) s+=`<rect x="${10+i*(180/d)}" y="10" width="${180/d}" height="40" fill="${i<n?'#ff6f00':'#fff'}" stroke="#333"/>`;
            return `<svg width="200" height="60">${s}</svg>`;
        },
        fracLine: (n,d) => `<svg width="250" height="50"><line x1="20" y1="25" x2="230" y2="25" stroke="#333" stroke-width="2"/><text x="20" y="45">0</text><text x="230" y="45">1</text><circle cx="${20+(n/d)*210}" cy="25" r="5" fill="#ff6f00"/></svg>`,
        
        // Geometry
        lShape: (w1,h1,w2,h2) => `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M20 20 H${20+w1*10} V${20+h1*10} H${20+(w1+w2)*10} V${20+(h1+h2)*10} H20 Z" fill="#e0f2f1" stroke="#004d40" stroke-width="2"/><text x="${20+w1*5}" y="15" text-anchor="middle">${w1}</text><text x="10" y="${20+h1*5}" text-anchor="middle">${h1}</text><text x="${20+(w1+w2/2)*10}" y="${20+h1*10-5}" text-anchor="middle">${w2}</text><text x="${20+(w1+w2)*10+10}" y="${20+h1*10+h2*5}" text-anchor="middle">${h2}</text></svg>`,
        geo: (t) => {
            if(t==='trap') return `<svg width="100" height="80"><path d="M20 60 L80 60 L70 20 L30 20 Z" fill="#e0f2f1" stroke="black" stroke-width="2"/></svg>`;
            if(t==='paral') return `<svg width="100" height="80"><path d="M20 60 L70 60 L90 20 L40 20 Z" fill="#e0f2f1" stroke="black" stroke-width="2"/></svg>`;
            return `<svg width="100" height="80"><rect x="20" y="20" width="60" height="40" fill="#e0f2f1" stroke="black" stroke-width="2"/></svg>`;
        },
        
        // Tools
        clock: (h,m) => {
            let t=''; for(let i=0;i<60;i++) t+=`<line x1="50" y1="6" x2="50" y2="${i%5?7:10}" transform="rotate(${i*6} 50 50)" stroke="#333" stroke-width="${i%5?1:2}"/>`;
            return `<svg width="150" height="150" viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" stroke="#333" fill="#fff"/>${t}<line x1="50" y1="50" x2="50" y2="28" stroke="black" stroke-width="3" transform="rotate(${(h%12)*30+m*0.5} 50 50)"/><line x1="50" y1="50" x2="50" y2="15" stroke="red" stroke-width="2" transform="rotate(${m*6} 50 50)"/><circle cx="50" cy="50" r="3"/></svg>`;
        },
        picto: (k) => `<svg width="250" height="80"><text x="10" y="30">A</text><circle cx="40" cy="25" r="8" fill="orange"/><circle cx="60" cy="25" r="8" fill="orange"/><text x="10" y="60">B</text><circle cx="40" cy="55" r="8" fill="orange"/><text x="150" y="70" font-size="10">Key: O = ${k}</text></svg>`
    }
};

// --- 2. THE MULTI-SCENARIO BANK (33 Standards) ---
const Bank = {
    "Number Sense (NSO)": [
        { id: "MA.3.NSO.1.1", desc: "Read/Write Numbers", gen: () => {
            const n = Utils.rInt(1001, 9999);
            const mode = Utils.pick(['word', 'expanded', 'value']);
            if(mode==='word') return { text: `Select <strong>Word Form</strong> for ${n}.`, type: 'radio', options: Utils.genOpts(Utils.numToWords(n), ()=>Utils.numToWords(Utils.rInt(1000,9999))), fb: "Read place values carefully." };
            if(mode==='expanded') return { text: `Select <strong>Expanded Form</strong> for ${n}.`, type: 'radio', options: Utils.shuffle([{t:`${Math.floor(n/1000)*1000} + ${Math.floor((n%1000)/100)*100} + ${Math.floor((n%100)/10)*10} + ${n%10}`,c:true},{t:`${Math.floor(n/1000)*1000} + 100 + 10 + 1`,c:false},{t:`${Math.floor(n/1000)} + ${Math.floor((n%1000)/100)} + ...`,c:false},{t:`${Math.floor(n/1000)*1000} + ${Math.floor((n%1000)/100)*10} + ${n%10}`,c:false}]), fb: "Value of each digit." };
            return { text: `In <strong>${n}</strong>, what is the value of the hundreds digit?`, type: 'equation', ans: (Math.floor((n%1000)/100)*100).toString(), fb: "Digit x 100." };
        }},
        { id: "MA.3.NSO.1.2", desc: "Compose Numbers", gen: () => ({ text: "Which equals <strong>2,400</strong>?", type: 'radio', options: Utils.shuffle([{t:"24 hundreds",c:true},{t:"2 thousands 4 ones",c:false},{t:"24 tens",c:false},{t:"200 tens",c:false}]), fb: "24 x 100." })},
        { id: "MA.3.NSO.1.3", desc: "Compare Numbers", gen: () => ({ text: "Select the <strong>TRUE</strong> statement.", type: 'radio', options: Utils.shuffle([{t:"4,050 > 4,005",c:true},{t:"1,200 < 1,099",c:false},{t:"3,400 = 3,040",c:false},{t:"5,000 < 4,999",c:false}]), fb: "Compare left to right." })},
        { id: "MA.3.NSO.1.4", desc: "Rounding", gen: () => {
            const m = Math.random()>0.5; const n=Utils.rInt(120,880);
            if(m) return { text: `Round <strong>${n}</strong> to nearest 100.`, type: 'equation', ans: (Math.round(n/100)*100).toString(), fb: "5 or more rounds up." };
            return { text: "Select ALL numbers that round to 400 (nearest 100).", type: 'multi', options: Utils.shuffle([{t:"350",c:true},{t:"449",c:true},{t:"451",c:false},{t:"301",c:false}]), fb: "350-449 range." };
        }},
        { id: "MA.3.NSO.2.1", desc: "Add/Sub", gen: () => ({ text: "Solve: <strong>5,000 - 2,450</strong>", type: 'equation', ans: "2550", fb: "Regroup across zeros." })},
        { id: "MA.3.NSO.2.2", desc: "Mult 0-12", gen: () => ({ text: "Solve: <strong>12 Ã— 9</strong>", type: 'equation', ans: "108", fb: "Fact check." })},
        { id: "MA.3.NSO.2.3", desc: "Mult by 10s", gen: () => ({ text: "Solve: <strong>50 Ã— 6</strong>", type: 'equation', ans: "300", fb: "5x6=30, add 0." })},
        { id: "MA.3.NSO.2.4", desc: "Mult 1d x 2d", gen: () => ({ text: "Solve: <strong>14 Ã— 6</strong>", type: 'equation', ans: "84", fb: "Standard algorithm." })}
    ],
    "Algebra (AR)": [
        { id: "MA.3.AR.1.1", desc: "Distributive", gen: () => ({ text: "Expression for <strong>8 Ã— 14</strong>?", type: 'radio', options: Utils.shuffle([{t:"(8Ã—10) + (8Ã—4)",c:true},{t:"(8Ã—10) Ã— (8Ã—4)",c:false},{t:"8 + 10 + 4",c:false},{t:"(8+10) Ã— (8+4)",c:false}]), fb: "Break 14 to 10+4." })},
        { id: "MA.3.AR.1.2", desc: "Word Problems", gen: () => ({ text: "7 bags of 9 marbles. Total?", type: 'equation', ans: "63", fb: "7 x 9." })},
        { id: "MA.3.AR.2.1", desc: "Inverse Ops", gen: () => ({ text: "Which solves <strong>42 Ã· 6 = ?</strong>", type: 'radio', options: Utils.shuffle([{t:"6 Ã— ? = 42",c:true},{t:"42 Ã— 6 = ?",c:false},{t:"6 + ? = 42",c:false},{t:"42 - 6 = ?",c:false}]), fb: "Inverse." })},
        { id: "MA.3.AR.2.2", desc: "True/False", gen: () => ({ text: "True or False: <strong>4 Ã— 5 = 10 + 10</strong>", type: 'radio', options: [{t:"True",c:true},{t:"False",c:false}], fb: "20 = 20." })},
        { id: "MA.3.AR.2.3", desc: "Missing Factor", gen: () => ({ text: "<strong>? Ã— 7 = 56</strong>", type: 'equation', ans: "8", fb: "56 / 7." })},
        { id: "MA.3.AR.3.1", desc: "Even/Odd", gen: () => ({ text: "Select ALL Even numbers.", type: 'multi', options: Utils.shuffle([{t:"14",c:true},{t:"32",c:true},{t:"21",c:false},{t:"9",c:false}]), fb: "Ends in 0,2,4,6,8." })},
        { id: "MA.3.AR.3.2", desc: "Multiples", gen: () => ({ text: "Multiple of 3?", type: 'radio', options: Utils.shuffle([{t:"15",c:true},{t:"14",c:false},{t:"13",c:false},{t:"16",c:false}]), fb: "3,6,9,12,15..." })},
        { id: "MA.3.AR.3.3", desc: "Patterns", gen: () => ({ text: "Rule: x5. Input: 4. Output?", type: 'table', inputs:[3,4,5], outputs:[15,"?",25], missing:1, ans:"20", fb: "4x5." })}
    ],
    "Fractions (FR)": [
        { id: "MA.3.FR.1.1", desc: "Visual Fractions", gen: () => {
            const m = Math.random()>0.5; const n=Utils.rInt(1,3);
            if(m) return { text: "Fraction shaded?", visual: Utils.svg.fracCirc(n,4), type: 'radio', options: Utils.shuffle([{t:`${n}/4`,c:true},{t:`${4}/n`,c:false},{t:`1/5`,c:false},{t:"0",c:false}]), fb: "Count slices." };
            return { text: "Fraction shaded?", visual: Utils.svg.fracBar(n,4), type: 'radio', options: Utils.shuffle([{t:`${n}/4`,c:true},{t:`${4}/n`,c:false},{t:`1/2`,c:false},{t:`3/8`,c:false}]), fb: "Count parts." };
        }},
        { id: "MA.3.FR.1.2", desc: "Unit/Whole", gen: () => ({ text: "Which equals 1?", type: 'radio', options: Utils.shuffle([{t:"4/4",c:true},{t:"4/1",c:false},{t:"1/4",c:false},{t:"0/4",c:false}]), fb: "Num = Denom." })},
        { id: "MA.3.FR.1.3", desc: "Word Form", gen: () => ({ text: "Select <strong>Three-Fourths</strong>.", type: 'radio', options: Utils.shuffle([{t:"3/4",c:true},{t:"4/3",c:false},{t:"3/3",c:false},{t:"4/4",c:false}]), fb: "3 over 4." })},
        { id: "MA.3.FR.2.1", desc: "Compare", gen: () => {
             const m=Math.random()>0.5;
             if(m) return { text: "Compare:", type: 'radio', options: Utils.shuffle([{t:"1/3 > 1/5",c:true},{t:"1/3 < 1/5",c:false},{t:"1/3 = 1/5",c:false},{t:"1/5 > 1/3",c:false}]), fb: "Smaller denom = larger part." };
             return { text: "Identify 1/2.", visual: Utils.svg.fracLine(2,4), type: 'radio', options: Utils.shuffle([{t:"2/4",c:true},{t:"1/4",c:false},{t:"3/4",c:false},{t:"4/4",c:false}]), fb: "Halfway." };
        }},
        { id: "MA.3.FR.2.2", desc: "Equivalence", gen: () => ({ text: "Select ALL equal to 1/2.", type: 'multi', options: Utils.shuffle([{t:"2/4",c:true},{t:"3/6",c:true},{t:"1/3",c:false},{t:"3/4",c:false}]), fb: "Double the numerator." })}
    ],
    "Geometry (GR)": [
        { id: "MA.3.GR.1.1", desc: "Points/Lines", gen: () => ({ text: "Identify:", visual: Utils.svg.geo('ray')?Utils.svg.geo('ray'):"<svg width=100 height=30><line x1=10 y1=15 x2=90 y2=15 stroke=black stroke-width=2 marker-end='url(#ah)'/><circle cx=10 cy=15 r=3/></svg>", type: 'radio', options: Utils.shuffle([{t:"Ray",c:true},{t:"Line",c:false},{t:"Segment",c:false},{t:"Point",c:false}]), fb: "Start point, one arrow." })},
        { id: "MA.3.GR.1.2", desc: "Attributes", gen: () => {
             const m = Utils.pick(['visual', 'multi', 'tf']);
             if(m==='visual') return { text: "Which is a Trapezoid?", visual: Utils.svg.geo('trap'), type: 'radio', options: Utils.shuffle([{t:"Shape A",c:true},{t:"Shape B",c:false},{t:"Shape C",c:false},{t:"Shape D",c:false}]), fb: "1 pair parallel sides." };
             if(m==='multi') return { text: "Select ALL with 4 right angles.", type: 'multi', options: Utils.shuffle([{t:"Square",c:true},{t:"Rectangle",c:true},{t:"Rhombus",c:false},{t:"Trapezoid",c:false}]), fb: "Rect/Square." };
             return { text: "T/F: Squares are Rectangles.", type: 'radio', options: [{t:"True",c:true},{t:"False",c:false}], fb: "True." };
        }},
        { id: "MA.3.GR.1.3", desc: "Symmetry", gen: () => ({ text: "Line of symmetry?", visual: `<svg width=100 height=100><path d="M50 10 L90 90 L10 90 Z" fill="#e0f2f1" stroke="black"/><line x1="50" y1="10" x2="50" y2="90" stroke="red" stroke-dasharray="4"/></svg>`, type: 'radio', options: [{t:"Yes",c:true},{t:"No",c:false}], fb: "Mirror." })},
        { id: "MA.3.GR.2.1", desc: "Area", gen: () => ({ text: "Area of 7x6?", type: 'equation', ans: "42", fb: "L x W." })},
        { id: "MA.3.GR.2.2", desc: "Area Distributive", gen: () => ({ text: "Split 7x12:", type: 'radio', options: Utils.shuffle([{t:"(7x10)+(7x2)",c:true},{t:"(7x7)+(7x5)",c:false},{t:"7+10+2",c:false},{t:"(7x2)+(7x2)",c:false}]), fb: "Split 12." })},
        { id: "MA.3.GR.2.3", desc: "Perimeter", gen: () => {
             const m = Utils.pick(['tiled','missing','calc']);
             const w=4, h=3;
             if(m==='tiled') return { text: "Perimeter?", visual: Utils.svg.tiled(4,3), type: 'radio', options: Utils.genOpts('14',()=>Utils.rInt(10,20).toString()), fb: "Count edges." };
             if(m==='missing') return { text: "Perimeter=14, Width=3. Length?", type: 'equation', ans: "4", fb: "(14-6)/2." };
             return { text: "Perimeter of 5x4 rect?", type: 'equation', ans: "18", fb: "Add sides." };
        }},
        { id: "MA.3.GR.2.4", desc: "Composite Area", gen: () => ({ text: "Total Area?", visual: Utils.svg.lShape(4,4,2,2), type: 'equation', ans: "20", fb: "16 + 4." })}
    ],
    "Measurement (M)": [
        { id: "MA.3.M.1.1", desc: "Tools", gen: () => ({ text: "Measure juice?", type: 'radio', options: Utils.shuffle([{t:"Cups",c:true},{t:"Inches",c:false},{t:"Pounds",c:false},{t:"Meters",c:false}]), fb: "Volume." })},
        { id: "MA.3.M.1.2", desc: "Word Prob", gen: () => ({ text: "Box is 8kg. 3 boxes?", type: 'equation', ans: "24", fb: "8x3." })},
        { id: "MA.3.M.2.1", desc: "Time", gen: () => { 
             const h=Utils.rInt(1,12), m=Utils.rInt(10,55);
             return { text: "Time shown?", visual: Utils.svg.clock(h,m), type: 'radio', options: Utils.genOpts(`${h}:${m}`, ()=>`${Utils.rInt(1,12)}:${Utils.rInt(10,55)}`), fb: "Check min hand." };
        }},
        { id: "MA.3.M.2.2", desc: "Elapsed Time", gen: () => ({ text: "2:00 to 2:45?", type: 'radio', options: Utils.shuffle([{t:"45 min",c:true},{t:"30 min",c:false},{t:"15 min",c:false},{t:"1 hr",c:false}]), fb: "Count." })}
    ],
    "Data (DP)": [
        { id: "MA.3.DP.1.1", desc: "Read Graphs", gen: () => ({ text: "How many A?", visual: Utils.svg.picto(2), type: 'equation', ans: "4", fb: "2 circles x 2." })},
        { id: "MA.3.DP.1.2", desc: "Interpret", gen: () => ({ text: "Total A+B?", visual: Utils.svg.picto(2), type: 'equation', ans: "6", fb: "4+2." })}
    ]
};

// --- 3. APP ENGINE ---
const App = {
    mode: 'practice', currQ: null, score: 0,
    init: function() {
        const m = document.getElementById('menu');
        for(const cat in Bank) {
            const h = document.createElement('div'); h.className='cat'; h.innerText=cat; m.appendChild(h);
            Bank[cat].forEach(s => {
                const b = document.createElement('div'); b.className='std';
                b.innerHTML = `<strong>${s.id}</strong><small>${s.desc}</small>`;
                b.onclick = () => App.load(s); m.appendChild(b);
            });
        }
    },
    startSim: function() { this.mode='sim'; this.score=0; document.getElementById('badge').innerText="Test Simulation"; this.nextSim(); },
    nextSim: function() { const all=[]; for(const c in Bank) Bank[c].forEach(s=>all.push(s)); App.load(Utils.pick(all)); },
    load: function(s) {
        this.currStd=s; const q=s.gen(); this.currQ=q;
        document.getElementById('prompt').innerHTML=q.text;
        document.getElementById('badge').innerText=this.mode==='sim'?"Sim Mode":s.id;
        const v = document.getElementById('visual'); v.innerHTML=q.visual||''; v.style.display=q.visual?'flex':'none';
        const opts = document.getElementById('options'); opts.innerHTML='';
        const btn = document.getElementById('btn'); btn.innerText="Check"; btn.disabled=true;
        document.getElementById('fb').style.display='none';

        if(q.type==='radio'||q.type==='multi') {
            q.options.forEach((o,i)=>{
                const d=document.createElement('div'); d.className=`opt ${q.type}`;
                d.innerHTML=`<div class="icon"></div> ${o.t}`;
                d.onclick=()=>{
                    if(q.type==='radio'){document.querySelectorAll('.opt').forEach(x=>x.classList.remove('sel')); d.classList.add('sel'); App.sel=i;}
                    else d.classList.toggle('sel');
                    btn.disabled=false;
                };
                opts.appendChild(d);
            });
        } else if(q.type==='equation') {
            opts.innerHTML=`<input id="inp" class="input-box" placeholder="Type answer...">`;
            setTimeout(()=>document.getElementById('inp').oninput=e=>btn.disabled=e.target.value==='',0);
        } else if(q.type==='table') {
            let h=`<table class="tbl"><tr><th>In</th><th>Out</th></tr>`;
            q.inputs.forEach((v,i)=>h+=`<tr><td>${v}</td><td>${i===q.missing?`<input id="tbl-in">`:q.outputs[i]}</td></tr>`);
            opts.innerHTML=h+`</table>`;
            setTimeout(()=>document.getElementById('tbl-in').oninput=()=>btn.disabled=false,0);
        }
    },
    check: function() {
        const q=this.currQ; let ok=false;
        if(q.type==='radio') ok=q.options[App.sel].c;
        if(q.type==='multi') {
            const s=[], c=q.options.map((o,i)=>o.c?i:null).filter(x=>x!==null);
            document.querySelectorAll('.opt').forEach((b,i)=>{if(b.classList.contains('sel'))s.push(i)});
            if(s.length===c.length && s.every(v=>c.includes(v))) ok=true;
        }
        if(q.type==='equation') ok=document.getElementById('inp').value.trim()===q.ans;
        if(q.type==='table') ok=document.getElementById('tbl-in').value.trim()===q.ans;
        
        const fb=document.getElementById('fb'); fb.style.display='block'; fb.className=`fb ${ok?'corr':'incorr'}`;
        fb.innerHTML=`<strong>${ok?'Correct!':'Incorrect'}</strong><br>${q.fb}`;
        if(ok) document.getElementById('score').innerText=`Score: ${++this.score}`;
        const btn=document.getElementById('btn'); btn.innerText="Next";
        btn.onclick=()=>this.mode==='sim'?this.nextSim():this.load(this.currStd);
    }
};
App.init();
</script>
</body>
</html>
