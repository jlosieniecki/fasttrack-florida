<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST Grade 3 Accelerated Math Simulator | Level 4/5 Edition</title>
    <style>
        :root {
            --primary: #005ea2;
            --secondary: #f0f0f0;
            --text: #1b1b1b;
            --highlight: #e7f1ff;
            --correct: #2e8540;
            --incorrect: #cd2026;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f8;
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- Header mimicking FAST Interface --- */
        header {
            background-color: #fff;
            border-bottom: 2px solid #000;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-info h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .tools {
            display: flex;
            gap: 15px;
        }

        .tool-btn {
            background: #fff;
            border: 1px solid #333;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .tool-btn:hover { background: var(--secondary); }

        /* --- Main Test Area --- */
        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .question-panel {
            flex: 2;
            padding: 40px;
            overflow-y: auto;
            background: white;
            border-right: 1px solid #ddd;
        }

        .question-header {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .mastery-badge {
            background: #202020;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* --- CSS Visual Models for Fractions/Geometry --- */
        .fraction-model {
            display: flex;
            margin: 20px 0;
            border: 2px solid #333;
            width: 300px;
            height: 50px;
        }
        .fraction-part {
            flex: 1;
            border-right: 1px solid #333;
        }
        .fraction-part:last-child { border-right: none; }
        .shaded { background-color: #89c4f4; }

        .number-line {
            position: relative;
            height: 60px;
            border-bottom: 2px solid #333;
            margin: 40px 0;
            width: 80%;
        }
        .tick {
            position: absolute;
            bottom: -5px;
            width: 2px;
            height: 15px;
            background: #333;
        }
        .point {
            position: absolute;
            bottom: -8px;
            width: 12px;
            height: 12px;
            background: red;
            border-radius: 50%;
        }
        .nl-label {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            font-size: 0.9rem;
        }

        /* --- Options Area --- */
        .options-grid {
            display: grid;
            gap: 15px;
        }

        .option-card {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-card:hover {
            border-color: var(--primary);
            background-color: var(--highlight);
        }

        .option-card.selected {
            border-color: var(--primary);
            background-color: #d0e7ff;
            border-width: 3px;
        }

        .radio-circle {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            border: 2px solid #555;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .selected .radio-circle::after {
            content: '';
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
        }

        /* --- Footer/Nav --- */
        footer {
            background: #e1e1e1;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
        }
        .nav-btn:disabled {
            background: #aaa;
            cursor: not-allowed;
        }

        /* --- Feedback Modal (Simulated) --- */
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 5px solid #333;
            display: none;
        }
        .feedback-box.show { display: block; }
        .feedback-box.correct { border-left-color: var(--correct); background: #e6f4ea; }
        .feedback-box.incorrect { border-left-color: var(--incorrect); background: #fce8e6; }
        
        .ald-tag {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

    </style>
</head>
<body>

    <header>
        <div class="test-info">
            <h1>FAST Grade 3 Accelerated Math Simulator (Level 4/5 Edition)</h1>
            <span id="student-name">Student: Jon</span>
        </div>
        <div class="tools">
            <button class="tool-btn">Line Reader</button>
            <button class="tool-btn">Zoom</button>
            <button class="tool-btn" onclick="app.toggleReviewFlag()">ðŸš© Flag for Review</button>
        </div>
    </header>

    <main>
        <div class="question-panel">
            <div class="question-header">
                <span id="question-number">Question 1 of 10</span>
                <span id="difficulty-badge" class="mastery-badge">Level 4: Proficient</span>
            </div>
            
            <div id="question-container" class="question-text">
                </div>

            <div id="visual-container">
                </div>

            <div class="options-grid" id="options-container">
                </div>

            <div id="feedback-display" class="feedback-box">
                <h3 id="feedback-title"></h3>
                <p id="feedback-text"></p>
                <div id="ald-descriptor" class="ald-tag"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="timer">Time Remaining: <span id="timer">60:00</span></div>
        <button id="next-btn" class="nav-btn" onclick="app.checkAnswer()">Submit Answer</button>
        <button id="next-q-btn" class="nav-btn" style="display:none;" onclick="app.nextQuestion()">Next Question âž¡</button>
    </footer>

    <script>
        // --- 1. CORE LOGIC & DATA GENERATION --- //

        const ALD_DESCRIPTORS = {
            3: "Level 3: Solves one-step problems and identifies straightforward patterns.",
            4: "Level 4: Solves multi-step real-world problems, compares fractions with reasoning, and analyzes data in scaled graphs.",
            5: "Level 5: Analyzes errors in reasoning, justifies equivalent fractions using models, and solves complex missing-value problems."
        };

        class QuestionGenerator {
            constructor() {
                this.standards = ['NSO', 'FR', 'AR', 'GR', 'DP'];
            }

            // Helper: Random Integer
            rInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
            
            // Helper: Choice Shuffler
            shuffle(array) { return array.sort(() => Math.random() - 0.5); }

            // --- GENERATORS BY STANDARD --- //

            /* STANDARD: Number Sense & Operations (NSO)
               Accelerated Focus: Multi-digit multiplication, large place value (up to 1,000,000 for Grade 4 Acc).
            */
            generateNSO() {
                const isLevel5 = Math.random() > 0.5; // 50% chance of Level 5 Mastery Question
                
                if (isLevel5) {
                    // Level 5: Error Analysis or "Select All" for Place Value
                    const base = this.rInt(2000, 9000);
                    const wrongExpansion = `${Math.floor(base/1000)} thousands + ${Math.floor((base%1000)/100)} hundreds + ${this.rInt(10,99)} tens + ${base%10}`; // Error in tens
                    
                    return {
                        level: 5,
                        text: `A student wrote the number <strong>${base.toLocaleString()}</strong> in expanded form as:<br><br>
                               <em>${wrongExpansion}</em><br><br>
                               Which statement best describes the student's error?`,
                        options: [
                            { text: "The student represented the tens place incorrectly.", correct: true },
                            { text: "The student represented the thousands place incorrectly.", correct: false },
                            { text: "The student represented the hundreds place incorrectly.", correct: false },
                            { text: "There is no error; the expansion is correct.", correct: false }
                        ],
                        ald: "Level 5: Analyzes mathematical errors in place value decomposition."
                    };
                } else {
                    // Level 4: Multi-Step Real World Multiplication (Grade 4 Acc Standard)
                    const packs = this.rInt(15, 30);
                    const perPack = this.rInt(12, 25); // 2-digit x 2-digit
                    const extra = this.rInt(5, 10);
                    const total = (packs * perPack) + extra;

                    return {
                        level: 4,
                        text: `Jon's landscaping business ordered ${packs} palettes of sod. Each palette contains ${perPack} pieces of sod. 
                               After the job, they had ${extra} pieces left over.<br><br>
                               How many pieces of sod did they use in total? (Note: This requires calculating the total bought first).`,
                        options: [
                            { text: `${(packs * perPack).toLocaleString()} pieces`, correct: false },
                            { text: `${total.toLocaleString()} pieces`, correct: false }, // Wait, used = total - extra? No, implies they HAD extra. 
                            // Correction: Bought - Remaining = Used.
                            { text: `${(packs * perPack - extra).toLocaleString()} pieces`, correct: true },
                            { text: `${(packs * perPack + extra).toLocaleString()} pieces`, correct: false }
                        ],
                        ald: "Level 4: Solves multi-step real-world problems involving multiplication and subtraction."
                    };
                }
            }

            /* STANDARD: Fractions (FR)
               Accelerated Focus: Equivalent fractions, adding like denominators, mixed numbers.
            */
            generateFR() {
                const type = Math.random();
                
                if (type > 0.5) {
                    // Level 5: Equivalence Justification (Visual)
                    const num = 2, den = 3;
                    const mult = this.rInt(2, 4);
                    const eqNum = num * mult;
                    const eqDen = den * mult;

                    return {
                        level: 5,
                        text: `Which statement best explains why <strong>${num}/${den}</strong> is equivalent to <strong>${eqNum}/${eqDen}</strong>?`,
                        visual: 'fraction', // Trigger CSS render
                        visualData: { num: num, den: den },
                        options: [
                            { text: `Because multiplying the numerator and denominator by ${mult} breaks the whole into more pieces, but the shaded amount stays the same.`, correct: true },
                            { text: `Because ${eqNum} is larger than ${num}, so the fraction is larger.`, correct: false },
                            { text: `Because adding ${mult} to the numerator and denominator makes them equal.`, correct: false },
                            { text: `They are not equivalent.`, correct: false }
                        ],
                        ald: "Level 5: Explains fraction equivalence using reasoning about the size of parts."
                    };
                } else {
                    // Level 4: Adding Mixed Numbers (Grade 4 Acc)
                    const whole1 = this.rInt(1, 3);
                    const whole2 = this.rInt(1, 2);
                    const den = [4, 5, 8, 10, 12][this.rInt(0, 4)];
                    const num1 = this.rInt(1, den - 1);
                    const num2 = this.rInt(1, den - 1);
                    
                    // Calc result
                    let totalNum = num1 + num2;
                    let totalWhole = whole1 + whole2;
                    if (totalNum >= den) {
                        totalWhole += 1;
                        totalNum -= den;
                    }
                    
                    const correctStr = totalNum === 0 ? `${totalWhole}` : `${totalWhole} ${totalNum}/${den}`;

                    return {
                        level: 4,
                        text: `Solve: <br> <strong>${whole1} ${num1}/${den} + ${whole2} ${num2}/${den} = ?</strong>`,
                        options: [
                            { text: `${correctStr}`, correct: true },
                            { text: `${whole1+whole2} ${(num1+num2)}/${den*2}`, correct: false }, // Common error: add denominators
                            { text: `${whole1+whole2} ${Math.abs(num1-num2)}/${den}`, correct: false },
                            { text: `${whole1+whole2} ${num1+num2}/${den}`, correct: false } // Only works if no regrouping, but generator might regroup
                        ],
                        ald: "Level 4: Adds fractions and mixed numbers with like denominators involving regrouping."
                    };
                }
            }

            /* STANDARD: Geometry (GR)
               Accelerated Focus: Area/Perimeter relationships, classifying quadrilaterals.
            */
            generateGR() {
                // Level 5: Missing Dimension Multi-Step
                const width = this.rInt(4, 9);
                const area = width * this.rInt(5, 12);
                const length = area / width;
                const perimeter = 2 * (length + width);

                return {
                    level: 5,
                    text: `A rectangular garden has an area of <strong>${area} square feet</strong> and a width of <strong>${width} feet</strong>.<br><br>
                           Bob wants to put a fence around the entire garden. How many feet of fencing does he need?`,
                    options: [
                        { text: `${perimeter} feet`, correct: true },
                        { text: `${length} feet`, correct: false }, // Just the length
                        { text: `${area + width} feet`, correct: false },
                        { text: `${2 * width + area} feet`, correct: false }
                    ],
                    ald: "Level 5: Determines missing dimensions using area/perimeter formulas in multi-step problems."
                };
            }

             /* STANDARD: Algebraic Reasoning (AR)
               Accelerated Focus: Numerical Patterns, True/False Equations.
            */
            generateAR() {
                // Level 5: True/False Logic
                const factor = this.rInt(3, 9);
                const target = factor * this.rInt(4, 10);
                const falseOption = target + this.rInt(1, 5);

                return {
                    level: 5,
                    text: `Select <strong>ALL</strong> equations that are TRUE.`,
                    type: "checkbox", // Logic for multiple select
                    options: [
                        { text: `${target} Ã· ${factor} = ${target/factor}`, correct: true },
                        { text: `${factor} Ã— ${target/factor} = ${target}`, correct: true },
                        { text: `${target} Ã· ${target/factor} = ${factor + 1}`, correct: false },
                        { text: `${factor + 1} Ã— ${factor} = ${target}`, correct: false }
                    ],
                    ald: "Level 5: Determines the validity of multiple equations involving multiplication and division."
                };
            }

            getQuestion() {
                // Randomly pick a domain
                const domain = this.standards[Math.floor(Math.random() * this.standards.length)];
                
                // For now, mapping simplified domains
                if (domain === 'NSO') return this.generateNSO();
                if (domain === 'FR') return this.generateFR();
                if (domain === 'GR') return this.generateGR();
                return this.generateAR(); // Fallback/AR
            }
        }

        // --- 2. APP STATE MANAGEMENT --- //

        const app = {
            generator: new QuestionGenerator(),
            currentQ: null,
            score: 0,
            questionCount: 0,
            totalQuestions: 10,
            timeLeft: 3600, // 60 mins
            timerInterval: null,

            init: function() {
                this.startTimer();
                this.nextQuestion();
            },

            startTimer: function() {
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    const m = Math.floor(this.timeLeft / 60);
                    const s = this.timeLeft % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                }, 1000);
            },

            nextQuestion: function() {
                this.questionCount++;
                if (this.questionCount > this.totalQuestions) {
                    this.endTest();
                    return;
                }

                // Reset UI
                document.getElementById('feedback-display').classList.remove('show', 'correct', 'incorrect');
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('next-q-btn').style.display = 'none';
                document.getElementById('visual-container').innerHTML = '';
                document.getElementById('question-number').innerText = `Question ${this.questionCount} of ${this.totalQuestions}`;

                // Get Data
                this.currentQ = this.generator.getQuestion();
                
                // Render Badge
                const badge = document.getElementById('difficulty-badge');
                badge.innerText = this.currentQ.level === 5 ? "Level 5: Mastery" : "Level 4: Proficient";
                badge.style.background = this.currentQ.level === 5 ? "#4a148c" : "#005ea2";

                // Render Text
                document.getElementById('question-container').innerHTML = this.currentQ.text;

                // Render Visuals
                if (this.currentQ.visual === 'fraction') {
                    this.renderFraction(this.currentQ.visualData.num, this.currentQ.visualData.den);
                }

                // Render Options
                const optsContainer = document.getElementById('options-container');
                optsContainer.innerHTML = '';
                
                // Shuffle options
                const shuffledOpts = this.generator.shuffle([...this.currentQ.options]);
                this.currentQ.shuffledOpts = shuffledOpts; // Store for checking

                shuffledOpts.forEach((opt, index) => {
                    const card = document.createElement('div');
                    card.className = 'option-card';
                    card.onclick = () => this.selectOption(index, card);
                    card.innerHTML = `<div class="radio-circle"></div><span>${opt.text}</span>`;
                    optsContainer.appendChild(card);
                });
            },

            renderFraction: function(num, den) {
                const container = document.getElementById('visual-container');
                let html = `<div class="fraction-model">`;
                for(let i=0; i<den; i++) {
                    html += `<div class="fraction-part ${i<num ? 'shaded' : ''}"></div>`;
                }
                html += `</div>`;
                container.innerHTML = html;
            },

            selectOption: function(index, cardElem) {
                // Clear previous selection
                document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                cardElem.classList.add('selected');
                this.currentSelection = index;
            },

            checkAnswer: function() {
                if (this.currentSelection === undefined) return;

                const isCorrect = this.currentQ.shuffledOpts[this.currentSelection].correct;
                const feedbackBox = document.getElementById('feedback-display');
                
                feedbackBox.className = `feedback-box ${isCorrect ? 'correct' : 'incorrect'} show`;
                document.getElementById('feedback-title').innerText = isCorrect ? "Correct!" : "Incorrect";
                
                // Custom explanation based on Level 4/5 logic
                let explanation = "";
                if (isCorrect) {
                    this.score++;
                    explanation = "You demonstrated strong understanding of the standard.";
                } else {
                    // Find correct answer text
                    const correctAns = this.currentQ.shuffledOpts.find(o => o.correct).text;
                    explanation = `The correct answer was: ${correctAns}. Review the breakdown below.`;
                }

                document.getElementById('feedback-text').innerHTML = explanation;
                document.getElementById('ald-descriptor').innerText = this.currentQ.ald;

                // Button State
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('next-q-btn').style.display = 'block';
                this.currentSelection = undefined; // Reset
            },

            endTest: function() {
                clearInterval(this.timerInterval);
                document.querySelector('main').innerHTML = `
                    <div style="padding:40px; text-align:center;">
                        <h1>Test Complete</h1>
                        <h2>Score: ${this.score} / ${this.totalQuestions}</h2>
                        <p>Simulated Performance Level: <strong>${this.score > 8 ? 'Level 5 (Mastery)' : this.score > 6 ? 'Level 4 (Proficient)' : 'Level 3'}</strong></p>
                        <button class="nav-btn" onclick="location.reload()">Restart Simulator</button>
                    </div>
                `;
            },
            
            toggleReviewFlag: function() {
                alert("Question flagged for later review. (This feature mimics the actual test but is visual only in this demo).");
            }
        };

        // Start App
        app.init();

    </script>
</body>
</html>
