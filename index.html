<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST Accelerated Math Simulator | Gold Edition</title>
    <style>
        :root {
            --primary: #0f4c81; /* Classic Test Blue */
            --bg: #f4f7f6;
            --white: #ffffff;
            --text: #333;
            --border: #ccc;
            --highlight: #e3f2fd;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; }

        /* --- HEADER --- */
        header { background: var(--white); border-bottom: 3px solid #000; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .title { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
        .status-bar { display: flex; gap: 20px; font-weight: 600; color: #555; }

        /* --- LAYOUT --- */
        .container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 260px; background: #fff; border-right: 1px solid #ddd; overflow-y: auto; padding: 10px; }
        .main-stage { flex: 1; padding: 40px; overflow-y: auto; display: flex; justify-content: center; }

        /* --- MENU --- */
        .menu-cat { font-size: 0.75rem; text-transform: uppercase; color: #888; font-weight: bold; margin: 15px 0 5px 10px; }
        .std-btn { 
            display: block; width: 100%; text-align: left; padding: 12px; margin-bottom: 5px; 
            background: #fdfdfd; border: 1px solid #eee; border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .std-btn:hover { background: #f0f0f0; border-color: #bbb; }
        .std-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- QUESTION CARD --- */
        .card { background: white; width: 100%; max-width: 850px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); padding: 40px; }
        
        .q-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .badge { background: #eee; padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 0.9rem; }

        .prompt { font-size: 1.3rem; margin-bottom: 25px; line-height: 1.5; }
        
        /* --- VISUALS --- */
        .visual-box { background: #fafafa; border: 1px dashed #ccc; padding: 20px; margin-bottom: 25px; display: flex; justify-content: center; align-items: center; border-radius: 8px; }

        /* --- INPUT AREAS --- */
        .input-area { display: grid; gap: 15px; }

        /* Radio/Checkbox Styles */
        .choice-row { 
            display: flex; align-items: center; padding: 15px; border: 2px solid #e0e0e0; 
            border-radius: 8px; cursor: pointer; font-size: 1.1rem; transition: 0.1s; 
        }
        .choice-row:hover { background: #f9f9f9; border-color: #bbb; }
        .choice-row.selected { background: var(--highlight); border-color: var(--primary); border-width: 2px; }
        
        .icon { width: 20px; height: 20px; border: 2px solid #555; margin-right: 15px; display: flex; justify-content: center; align-items: center; }
        .radio .icon { border-radius: 50%; } 
        .check .icon { border-radius: 4px; }
        .selected .icon { background: var(--primary); border-color: var(--primary); }
        .selected .radio .icon::after { content:''; width:8px; height:8px; background:white; border-radius:50%; }
        .selected .check .icon::after { content:'✔'; color:white; font-size:14px; }

        /* Equation Editor */
        .eq-input { width: 100%; padding: 15px; font-size: 1.5rem; border: 2px solid #333; border-radius: 6px; font-family: monospace; }

        /* Table Input (TEI) */
        .table-tei { border-collapse: collapse; margin: 0 auto; }
        .table-tei td, .table-tei th { border: 1px solid #333; padding: 10px 20px; text-align: center; font-size: 1.1rem; }
        .table-tei input { width: 60px; padding: 5px; font-size: 1.1rem; text-align: center; }

        /* --- FEEDBACK --- */
        .feedback-panel { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; }
        .feedback-panel.correct { background: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .feedback-panel.incorrect { background: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }

        .btn-check { float: right; margin-top: 20px; padding: 12px 30px; background: var(--primary); color: white; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; }
        .btn-check:disabled { background: #ccc; cursor: not-allowed; }

    </style>
</head>
<body>

    <header>
        <div class="title">FAST Accelerated Simulator (Gold Ed.)</div>
        <div class="status-bar">
            <span>Score: <span id="score">0</span></span>
        </div>
    </header>

    <div class="container">
        <div class="sidebar" id="nav-menu">
            <div style="padding:10px; font-size:0.9rem; color:#666;">Select a Standard:</div>
        </div>

        <div class="main-stage">
            <div class="card">
                <div class="q-header">
                    <span class="badge" id="q-std">Select Standard</span>
                    <span style="font-size:0.85rem; color:#555;">Tech-Enhanced Item</span>
                </div>

                <div class="prompt" id="q-text">
                    Choose a domain from the left to generate a unique, non-repeating question.
                </div>

                <div class="visual-box" id="q-visual" style="display:none;"></div>

                <div class="input-area" id="q-input"></div>

                <div class="feedback-panel" id="q-feedback"></div>

                <button class="btn-check" id="btn-action" onclick="App.check()" disabled>Check Answer</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * FAST GOLD EDITION ENGINE
         * Features: Anti-Collision Answer Logic, Table Inputs, Advanced Generators
         */

        const Utils = {
            rInt: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
            
            // ⭐️ CORE FEATURE: Generate Unique Options
            // Ensures answer choices A, B, C, D are never the same
            generateOptions: (correctVal, generatorFunction, count = 3) => {
                const options = new Set();
                options.add(correctVal); // Add correct answer first
                
                let attempts = 0;
                while(options.size < count + 1 && attempts < 50) {
                    const distractor = generatorFunction();
                    // Basic filter: Don't add if it's the correct answer or already exists
                    if(distractor !== correctVal) {
                        options.add(distractor);
                    }
                    attempts++;
                }
                // Convert to array and shuffle
                return Array.from(options).sort(() => Math.random() - 0.5);
            },

            // SVG: Area Model for Multiplication
            drawAreaModel: (h, w) => {
                return `<svg width="200" height="150" viewBox="0 0 200 150">
                    <rect x="10" y="10" width="${w*10}" height="${h*10}" fill="#e3f2fd" stroke="#0f4c81" stroke-width="2"/>
                    <text x="${10 + (w*5)}" y="140" text-anchor="middle">${w}</text>
                    <text x="190" y="${10 + (h*5)}" text-anchor="middle">${h}</text>
                    <text x="${10 + (w*5)}" y="${15 + (h*5)}" text-anchor="middle" font-size="20" fill="#0f4c81">?</text>
                </svg>`;
            }
        };

        const QuestionBank = {
            // --- NUMBER SENSE (NSO) ---
            "NSO": [
                {
                    id: "MA.3.NSO.2.2",
                    desc: "Multiplication Facts",
                    gen: () => {
                        const a = Utils.rInt(6, 9);
                        const b = Utils.rInt(7, 9);
                        const ans = a * b;
                        
                        // Generator for distractors (nearby multiples)
                        const getDistractor = () => (a * Utils.rInt(4, 10));

                        const opts = Utils.generateOptions(ans, getDistractor, 3).map(val => ({
                            text: val.toString(), 
                            correct: val === ans
                        }));

                        return {
                            text: `Solve: <strong>${a} × ${b} = ?</strong>`,
                            type: 'radio',
                            options: opts,
                            feedback: `Level 3: Explore multiplication of two whole numbers with products from 0 to 144.`
                        };
                    }
                },
                {
                    id: "MA.3.NSO.2.4",
                    desc: "Multiply 1-digit x 2-digit",
                    gen: () => {
                        const a = Utils.rInt(2, 5);
                        const b = Utils.rInt(12, 25);
                        const ans = a * b;
                        
                        // Smart Distractors: Common errors (forgetting to regroup)
                        const getDistractor = () => {
                            const errType = Utils.rInt(1,3);
                            if(errType===1) return ans + 10;
                            if(errType===2) return ans - a;
                            return ans + Utils.rInt(1,5);
                        };

                        const opts = Utils.generateOptions(ans, getDistractor, 3).map(val => ({
                            text: val.toString(), correct: val === ans
                        }));

                        return {
                            text: `Find the product: <strong>${b} × ${a}</strong>`,
                            type: 'radio',
                            options: opts,
                            feedback: "Level 3: Multiply a one-digit whole number by a two-digit whole number."
                        };
                    }
                }
            ],

            // --- ALGEBRAIC REASONING (AR) ---
            "AR": [
                {
                    id: "MA.3.AR.1.1",
                    desc: "Distributive Property",
                    gen: () => {
                        const a = Utils.rInt(3, 9);
                        const b = Utils.rInt(11, 19);
                        const tens = 10;
                        const ones = b - 10;
                        
                        return {
                            text: `Select the equation that uses the Distributive Property to solve <strong>${a} × ${b}</strong>.`,
                            type: 'radio',
                            options: [
                                { text: `(${a} × 10) + (${a} × ${ones})`, correct: true },
                                { text: `(${a} × 10) × (${a} × ${ones})`, correct: false },
                                { text: `${a} + 10 + ${ones}`, correct: false },
                                { text: `(${a} + 10) × (${a} + ${ones})`, correct: false }
                            ].sort(()=>Math.random()-0.5),
                            feedback: "Level 3: Apply the distributive property to multiply."
                        };
                    }
                },
                {
                    id: "MA.3.AR.3.3",
                    desc: "Number Patterns (Table TEI)",
                    gen: () => {
                        const rule = Utils.rInt(2, 5);
                        const inputs = [3, 5, 8];
                        const outputs = inputs.map(i => i * rule);
                        
                        return {
                            text: `The table shows a multiplicative pattern. Use the rule <strong>"Multiply by ${rule}"</strong> to fill in the missing Output.`,
                            type: 'table',
                            data: { inputs: inputs, outputs: outputs, missingIdx: 2 }, // 3rd item missing
                            answer: outputs[2],
                            feedback: "Level 3: Identify and extend numerical patterns in a table."
                        };
                    }
                }
            ],

            // --- FRACTIONS & DATA ---
            "FR/DP": [
                {
                    id: "MA.3.FR.2.2",
                    desc: "Equivalent Fractions",
                    gen: () => {
                        return {
                            text: "Select <strong>ALL</strong> fractions that are equivalent to 1/2.",
                            type: 'multi',
                            options: [
                                { text: "2/4", correct: true },
                                { text: "3/6", correct: true },
                                { text: "4/8", correct: true },
                                { text: "2/3", correct: false },
                                { text: "1/3", correct: false }
                            ].sort(()=>Math.random()-0.5), // Simple shuffle here
                            feedback: "Level 4: Identify equivalent fractions using area models or number lines."
                        };
                    }
                },
                {
                    id: "MA.3.DP.1.1",
                    desc: "Circle Graphs (Acc)",
                    gen: () => {
                        const total = 20;
                        const v = 10; // Vanilla
                        const c = 5;  // Choc
                        const s = 5;  // Strawberry
                        
                        // Pie Chart CSS
                        const css = `background: conic-gradient(
                            #0f4c81 0% 50%, 
                            #e3f2fd 50% 75%, 
                            #ff6f00 75% 100%
                        ); width:150px; height:150px; border-radius:50%;`;

                        return {
                            text: "The circle graph shows favorite ice cream flavors of 20 students.<br>Blue = Vanilla (10)<br>Light = Choc (5)<br>Orange = Straw (5)<br><br>How many students chose Vanilla?",
                            type: 'equation',
                            visual: `<div style="${css}"></div>`,
                            answer: "10",
                            feedback: "Level 4: Interpret data in circle graphs."
                        };
                    }
                }
            ]
        };

        // --- APP ENGINE ---
        const App = {
            currentQ: null,
            score: 0,

            init: function() {
                const nav = document.getElementById('nav-menu');
                for(const cat in QuestionBank) {
                    nav.innerHTML += `<div class="menu-cat">${cat}</div>`;
                    QuestionBank[cat].forEach(std => {
                        const btn = document.createElement('div');
                        btn.className = 'std-btn';
                        btn.innerHTML = `${std.id} <br><small>${std.desc}</small>`;
                        btn.onclick = () => {
                            document.querySelectorAll('.std-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            this.loadQ(std);
                        };
                        nav.appendChild(btn);
                    });
                }
            },

            loadQ: function(stdObj) {
                this.currentQ = stdObj.gen();
                const q = this.currentQ;

                // UI Reset
                document.getElementById('q-std').innerText = stdObj.id;
                document.getElementById('q-text').innerHTML = q.text;
                document.getElementById('q-visual').style.display = q.visual ? 'flex' : 'none';
                if(q.visual) document.getElementById('q-visual').innerHTML = q.visual;
                
                const inputArea = document.getElementById('q-input');
                inputArea.innerHTML = '';
                document.getElementById('q-feedback').style.display = 'none';
                document.getElementById('btn-action').disabled = true;
                document.getElementById('btn-action').innerText = "Check Answer";
                document.getElementById('btn-action').onclick = () => App.check();

                // RENDER INPUTS BASED ON TYPE
                if(q.type === 'radio' || q.type === 'multi') {
                    q.options.forEach((opt, idx) => {
                        const el = document.createElement('div');
                        el.className = `choice-row ${q.type === 'radio' ? 'radio' : 'check'}`;
                        el.innerHTML = `<div class="icon"></div> ${opt.text}`;
                        el.onclick = () => {
                            if(q.type === 'radio') {
                                document.querySelectorAll('.choice-row').forEach(r => r.classList.remove('selected'));
                                el.classList.add('selected');
                                App.selection = idx;
                            } else {
                                el.classList.toggle('selected');
                                // Multi logic handled in check
                            }
                            document.getElementById('btn-action').disabled = false;
                        };
                        inputArea.appendChild(el);
                    });
                } 
                else if (q.type === 'equation') {
                    inputArea.innerHTML = `<input type="text" class="eq-input" id="user-eq" placeholder="Type answer...">`;
                    document.getElementById('user-eq').addEventListener('input', (e) => {
                        document.getElementById('btn-action').disabled = e.target.value === '';
                    });
                }
                else if (q.type === 'table') {
                    let html = `<table class="table-tei"><tr><th>Input</th><th>Output</th></tr>`;
                    q.data.inputs.forEach((val, i) => {
                        const out = i === q.data.missingIdx ? `<input type="number" id="tbl-input">` : q.data.outputs[i];
                        html += `<tr><td>${val}</td><td>${out}</td></tr>`;
                    });
                    html += `</table>`;
                    inputArea.innerHTML = html;
                    setTimeout(() => {
                        document.getElementById('tbl-input').addEventListener('input', () => {
                             document.getElementById('btn-action').disabled = false;
                        });
                    }, 100);
                }
            },

            check: function() {
                const q = this.currentQ;
                let isCorrect = false;

                if(q.type === 'radio') isCorrect = q.options[this.selection].correct;
                
                if(q.type === 'multi') {
                    // Get all selected indices
                    const rows = document.querySelectorAll('.choice-row');
                    const selectedIdxs = [];
                    rows.forEach((r, i) => { if(r.classList.contains('selected')) selectedIdxs.push(i); });
                    
                    const correctIdxs = q.options.map((o,i) => o.correct ? i : null).filter(i=>i!==null);
                    // Check exact match arrays
                    if(selectedIdxs.length === correctIdxs.length && selectedIdxs.every(v => correctIdxs.includes(v))) {
                        isCorrect = true;
                    }
                }

                if(q.type === 'equation') {
                    const val = document.getElementById('user-eq').value.trim();
                    isCorrect = val === q.answer;
                }

                if(q.type === 'table') {
                    const val = document.getElementById('tbl-input').value;
                    isCorrect = parseInt(val) === q.answer;
                }

                // Show Feedback
                const fb = document.getElementById('q-feedback');
                fb.style.display = 'block';
                fb.className = `feedback-panel ${isCorrect ? 'correct' : 'incorrect'}`;
                fb.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Incorrect.'}</strong><br>${q.feedback}`;

                if(isCorrect) {
                    this.score += 10;
                    document.getElementById('score').innerText = this.score;
                }

                // Change Button to Next
                const btn = document.getElementById('btn-action');
                btn.innerText = "Next Question";
                // find current standard object to reload
                // For sim, we just reload the same generator type
                btn.onclick = () => {
                     // Hacky reload of same question type for demo
                     const activeBtn = document.querySelector('.std-btn.active');
                     if(activeBtn) activeBtn.click();
                };
            }
        };

        App.init();

    </script>
</body>
</html>
