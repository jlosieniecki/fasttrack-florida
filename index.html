<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAST Grade 3 Math - Cambium Edition</title>
    <style>
        /* CAMBIUM THEME VARIABLES */
        :root { 
            --header: #2C3E50; 
            --bg: #EAEAEA; 
            --active: #00609C; 
            --panel-border: #b5b5b5;
            --text-color: #000;
        }
        
        body { 
            font-family: 'Verdana', 'Segoe UI', sans-serif; /* Verbal font match */
            background: var(--bg); 
            margin: 0; 
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* SCREEN MANAGEMENT */
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* MAIN MENU */
        .menu-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 20px; }
        .menu-card { background: white; padding: 30px; border-radius: 4px; box-shadow: 0 15px 40px rgba(0,0,0,0.4); text-align: center; color: #333; width: 100%; max-width: 650px; max-height: 90vh; overflow-y: auto; }
        
        .std-btn { 
            display: block; width: 100%; padding: 12px 15px; margin: 8px 0; 
            border: 1px solid #ccc; background: #fff; text-align: left; 
            cursor: pointer; font-size: 0.95em; border-left: 5px solid #ccc;
        }
        .std-btn:hover { background: #f0f8ff; border-left-color: var(--active); }
        .std-btn strong { color: #003057; display: block; margin-bottom: 2px; }
        .std-btn small { color: #555; font-size: 0.85em; }

        /* TEST INTERFACE (True Cambium Layout) */
        .top-bar { background: #fff; border-bottom: 2px solid #000; padding: 0 20px; height: 55px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .tool-btn { background: transparent; border: 1px solid #666; color: #333; padding: 5px 12px; border-radius: 2px; cursor: pointer; font-weight: bold; font-size: 0.9em; margin-left: 8px; }
        .tool-btn:hover { background: #eee; }

        .main-stage { flex: 1; padding: 10px; overflow: hidden; display: flex; gap: 10px; height: 100%; position: relative; }
        
        /* PANES */
        .pane { background: white; border: 1px solid var(--panel-border); overflow-y: auto; height: 100%; box-sizing: border-box; padding: 25px; }
        .left-pane { width: 45%; background: #FAFAFA; display: flex; align-items: center; justify-content: center; }
        .right-pane { width: 55%; }
        
        @media (max-width: 768px) {
            .main-stage { flex-direction: column; }
            .left-pane { width: 100%; height: 35%; border-bottom: 2px solid #999; }
            .right-pane { width: 100%; height: 65%; }
        }

        /* ITEM STYLES */
        .q-header { 
            font-weight: bold; color: #444; margin-bottom: 15px; 
            border-bottom: 1px solid #ccc; padding-bottom: 10px; 
            text-transform: uppercase; font-size: 0.85em; letter-spacing: 0.5px;
        }
        .q-text { font-size: 1.2em; line-height: 1.6; color: #000; margin-bottom: 25px; }
        
        /* ITEM 11: TWO-PART */
        .part-header { font-weight: bold; margin-top: 20px; margin-bottom: 10px; color: #000; border-top: 1px dashed #ccc; padding-top: 10px; }
        
        /* ITEM 10: INLINE CHOICE */
        .inline-select { 
            display: inline-block; font-size: 1em; padding: 4px 10px; margin: 0 4px; 
            border: 2px solid #333; background: #fff; color: #000; 
            font-weight: bold; cursor: pointer; box-shadow: 2px 2px 0 rgba(0,0,0,0.1); 
        }

        /* ITEM 9: MULTI-INPUT (Shaded Box) */
        .shaded-box { 
            background: #E8E8E8; padding: 20px; border: 1px solid #999; 
            display: inline-block; min-width: 300px; 
        }
        .input-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .input-row label { font-weight: bold; font-size: 1.1em; }
        .input-box { 
            font-size: 1.2em; padding: 8px; width: 100px; text-align: center; 
            border: 1px solid #555; background: white; 
        }

        /* TABLE MATCH */
        .match-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .match-table th { background: #f0f0f0; border: 1px solid #999; padding: 10px; }
        .match-table td { border: 1px solid #999; padding: 10px; text-align: center; }
        .radio-big { width: 22px; height: 22px; cursor: pointer; accent-color: #000; }

        /* STANDARD CHOICE */
        .opt-row { 
            display: flex; padding: 12px; margin-bottom: 10px; cursor: pointer; 
            align-items: center; border: 1px solid transparent; 
        }
        .opt-row:hover { background: #f5f5f5; }
        .opt-row.selected { background: #e6f3ff; border: 1px solid var(--active); font-weight: bold; }
        .bubble { 
            width: 20px; height: 20px; border: 1px solid #333; border-radius: 50%; 
            margin-right: 15px; flex-shrink: 0; background: white; 
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        .opt-row.selected .bubble { background: #000; border-color: #000; box-shadow: none; }
        .bubble.square { border-radius: 2px; }

        /* NAVIGATION BAR */
        .nav-bar { 
            background: #f0f0f0; border-top: 1px solid #999; height: 65px; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; flex-shrink: 0; 
        }
        .nav-btn { 
            background: #fff; color: #333; border: 1px solid #999; 
            padding: 10px 25px; font-weight: bold; font-size: 1em; 
            cursor: pointer; min-width: 100px; border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .nav-btn.primary { background: var(--active); color: white; border-color: var(--active); }

        /* REPORT */
        .level-badge { padding: 10px 20px; color: white; font-weight: bold; font-size: 1.5em; border-radius: 30px; margin: 15px 0; display: inline-block; }
        .l3 { background: #FBC02D; color: #000; } .l4 { background: #4CAF50; }
        .grid-rep { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; }
        .rep-box { padding: 15px; background: #f9f9f9; border-left: 6px solid #ccc; font-size: 0.9em; }
        .good { border-left-color: #4CAF50; } .bad { border-left-color: #D32F2F; }

        svg { max-height: 250px; display: block; margin: auto; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="menu-container">
            <div class="menu-card">
                <h1 style="margin:0; color:#003057;">FAST Math Simulator</h1>
                <p style="color:#666;">Grade 3 B.E.S.T. Standards ‚Ä¢ Comprehensive Coverage</p>
                
                <button class="std-btn" onclick="startTest('ALL', 40)" style="border-left-color: #003057; background:#eef6fc;">
                    <strong>üöÄ Full Operational Mock (40 Items)</strong>
                    <small>Simulates exact FAST blueprint weighing.</small>
                </button>
                
                <h3 style="text-align:left; margin-top:20px; border-bottom:1px solid #eee;">Domain Practice</h3>
                <button class="std-btn" onclick="startTest('NSO', 15)"><strong>Number Sense (NSO)</strong> <small>Place Value, Add/Sub, Mult/Div</small></button>
                <button class="std-btn" onclick="startTest('FR', 15)"><strong>Fractions (FR)</strong> <small>Models, Number Lines, Equivalence</small></button>
                <button class="std-btn" onclick="startTest('AR', 15)"><strong>Algebraic Reasoning (AR)</strong> <small>Logic, Patterns, 2-Step Problems</small></button>
                <button class="std-btn" onclick="startTest('GR', 15)"><strong>Geometry (GR)</strong> <small>Attributes, Area, Perimeter</small></button>
                <button class="std-btn" onclick="startTest('M', 10)"><strong>Measurement (M)</strong> <small>Time, Length, Mass, Capacity</small></button>
                <button class="std-btn" onclick="startTest('DP', 10)"><strong>Data Analysis (DP)</strong> <small>Scaled Graphs, Data Interpretation</small></button>
            </div>
        </div>
    </div>

    <div id="screen-test" class="screen">
        <div class="top-bar">
            <div><strong>Guest Student</strong> | G3 Math</div>
            <div>
                <button class="tool-btn" onclick="toggleZoom()">üîç Zoom</button>
                <button class="tool-btn" onclick="alert('System Tools: Line Reader, Calculator (Disabled)')">üõ† Tools</button>
                <button class="tool-btn" onclick="toggleRef()">üìÑ Formulas</button>
                <button class="tool-btn" style="color:#D32F2F; border-color:#D32F2F;" onclick="location.reload()">Exit</button>
            </div>
        </div>

        <div id="stage" class="main-stage"></div>

        <div class="nav-bar">
            <button class="nav-btn" onclick="prevQ()">Back</button>
            <div style="font-weight:bold; color:#555;">Item <span id="q-idx">1</span> of <span id="q-total">40</span></div>
            <button class="nav-btn primary" onclick="nextQ()" id="btn-next">Next</button>
        </div>
    </div>

    <div id="screen-report" class="screen">
        <div class="menu-container" style="background: #f4f4f4; color: #333;">
            <div class="menu-card">
                <h2>Performance Report</h2>
                <div id="final-badge" class="level-badge l3">Level 3</div>
                <div id="report-grid" class="grid-rep"></div>
                <button class="nav-btn primary" style="width:100%; margin-top:20px;" onclick="location.reload()">Back to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // --- VISUAL DRAWING FUNCTIONS ---
        function drawPie(d, n) {
            let path = "";
            for(let i=0; i<n; i++) {
                let start = (i * 360 / d) * Math.PI/180;
                let end = ((i+1) * 360 / d) * Math.PI/180;
                let x1=50+45*Math.sin(start), y1=50-45*Math.cos(start);
                let x2=50+45*Math.sin(end), y2=50-45*Math.cos(end);
                path += `M50,50 L${x1},${y1} A45,45 0 0,1 ${x2},${y2} Z `;
            }
            let lines = "";
            for(let i=0; i<d; i++) {
                let ang = (i*360/d) * Math.PI/180;
                lines += `<line x1="50" y1="50" x2="${50+45*Math.sin(ang)}" y2="${50-45*Math.cos(ang)}" stroke="#333" stroke-width="2"/>`;
            }
            return `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="white" stroke="#333" stroke-width="2"/><path d="${path}" fill="#00609C" stroke="#333"/>${lines}</svg>`;
        }

        function drawRect(l, w) {
            return `<svg viewBox="0 0 300 150">
                <rect x="50" y="25" width="200" height="100" fill="#EAEAEA" stroke="#333" stroke-width="2"/>
                <text x="150" y="20" text-anchor="middle" font-weight="bold">${l}</text>
                <text x="150" y="145" text-anchor="middle" font-weight="bold">${l}</text>
                <text x="40" y="80" text-anchor="middle" font-weight="bold" transform="rotate(-90,40,80)">${w}</text>
                <text x="260" y="80" text-anchor="middle" font-weight="bold" transform="rotate(90,260,80)">${w}</text>
            </svg>`;
        }

        // --- THE MASSIVE STANDARD ENGINE (All Grade 3 Standards) ---
        const STANDARDS = {
            // NUMBER SENSE & OPERATIONS (NSO)
            "MA.3.NSO.1.1": () => { // Read/Write Numbers
                let n = 1000 + Math.floor(Math.random()*8999);
                return { cat:"NSO", type:"choice", layout:"full", text:`What is the expanded form of <b>${n.toLocaleString()}</b>?`, opts:[`${Math.floor(n/1000)*1000} + ${Math.floor((n%1000)/100)*100} + ${Math.floor((n%100)/10)*10} + ${n%10}`, `${n} + 100`, `${Math.floor(n/1000)} + ${Math.floor((n%1000)/100)}`], ans:`${Math.floor(n/1000)*1000} + ${Math.floor((n%1000)/100)*100} + ${Math.floor((n%100)/10)*10} + ${n%10}` };
            },
            "MA.3.NSO.1.2": () => { // Compose/Decompose
                let n = 1500; 
                return { cat:"NSO", type:"multi-select", layout:"full", text:`Select <b>ALL</b> ways to represent 1,500.`, opts:["15 hundreds", "1 thousand + 5 hundreds", "15 tens", "1 thousand + 50 ones"], ans:[0,1] };
            },
            "MA.3.NSO.1.3": () => { // Compare Numbers
                let a = 1200 + Math.floor(Math.random()*100);
                let b = a + (Math.random()>0.5 ? 10 : -10);
                return { cat:"NSO", type:"inline", layout:"full", text:"Compare the numbers.", sentence:[{text:`${a} is `},{type:"select",opts:[">","<","="],ans:a>b?">":"<"},{text:` ${b}`}] };
            },
            "MA.3.NSO.1.4": () => { // Rounding
                let n = Math.floor(Math.random()*800)+100;
                return { cat:"NSO", type:"input", layout:"full", text:`Round <b>${n}</b> to the nearest ten.`, ans: (Math.round(n/10)*10).toString() };
            },
            "MA.3.NSO.2.1": () => { // Add/Sub
                let a = Math.floor(Math.random()*4000)+1000;
                let b = Math.floor(Math.random()*4000)+1000;
                return { cat:"NSO", type:"input", layout:"full", text:`${a} + ${b} = ?`, ans: (a+b).toString() };
            },
            "MA.3.NSO.2.2": () => { // Mult Facts
                let a = Math.floor(Math.random()*8)+2, b=Math.floor(Math.random()*9)+2;
                return { cat:"NSO", type:"input", layout:"full", text:`${a} √ó ${b} = ?`, ans:(a*b).toString() };
            },

            // FRACTIONS (FR)
            "MA.3.FR.1.1": () => { // Visual Fractions
                let d = [3,4,6,8][Math.floor(Math.random()*4)];
                return { cat:"FR", type:"choice", layout:"split", visual:drawPie(d,1), text:"What fraction is shaded?", opts:[`1/${d}`, `1/${d-1}`, `${d}/1`], ans:`1/${d}` };
            },
            "MA.3.FR.1.2": () => { // Number Line
                return { cat:"FR", type:"choice", layout:"split", visual:`<svg viewBox="0 0 300 50"><line x1="10" y1="25" x2="290" y2="25" stroke="black"/><circle cx="150" cy="25" r="8" fill="#00609C"/><text x="10" y="45">0</text><text x="290" y="45">1</text></svg>`, text:"Name the point on the number line.", opts:["1/2","1/4","2/1"], ans:"1/2" };
            },
            "MA.3.FR.2.1": () => { // Compare
                let d1=4, d2=8;
                return { cat:"FR", type:"inline", layout:"full", text:"Compare.", sentence:[{text:"1/4 is "},{type:"select",opts:[">","<"],ans:">"},{text:" 1/8"}] };
            },

            // ALGEBRA (AR)
            "MA.3.AR.1.2": () => { // 2-Step Word Problem
                let t = 50, a=10, b=5;
                return { cat:"AR", type:"multi-input", layout:"full", text:`Start with 50. Subtract 10, then subtract 5. What are the steps?`, inputs:[{label:"Step 1 (50-10):",val:"",correct:"40"},{label:"Step 2 (40-5):",val:"",correct:"35"}], ans:"35" };
            },
            "MA.3.AR.2.3": () => { // Array Logic
                return { cat:"AR", type:"table", layout:"full", text:"Does the equation represent the array?", rows:["3 x 4 = 12", "3 + 4 = 7"], cols:["Yes", "No"], ans:["Yes", "No"] };
            },
            "MA.3.AR.3.1": () => { // Patterns
                let r = Math.floor(Math.random()*5)+2;
                return { cat:"AR", type:"choice", layout:"full", text:`Identify the pattern: 5, ${5+r}, ${5+r*2}...`, opts:[`Add ${r}`, `Mult ${r}`], ans:`Add ${r}` };
            },

            // GEOMETRY (GR)
            "MA.3.GR.1.2": () => { // Shapes
                return { cat:"GR", type:"table", layout:"full", text:"Classify the shapes.", rows:["Rectangle", "Rhombus"], cols:["4 Right Angles", "4 Equal Sides"], ans:["4 Right Angles", "4 Equal Sides"] };
            },
            "MA.3.GR.2.1": () => { // Area
                let l=5, w=3;
                return { cat:"GR", type:"input", layout:"split", visual:drawRect(l,w), text:"Find the Area.", ans:(l*w).toString() };
            },
            "MA.3.GR.2.3": () => { // Perimeter
                let l=6, w=2;
                return { cat:"GR", type:"two-part", layout:"split", visual:drawRect(l,w), text:"Solve for Perimeter.", parts:[{label:"Part A: Expression",opts:[`${l}+${l}+${w}+${w}`, `${l}x${w}`],ans:`${l}+${l}+${w}+${w}`},{label:"Part B: Value",opts:[`${2*l+2*w}`,`${l*w}`],ans:`${2*l+2*w}`}] };
            },

            // MEASUREMENT (M) & DATA (DP)
            "MA.3.M.1.1": () => { // Conversions
                let ft = Math.floor(Math.random()*5)+2;
                return { cat:"M", type:"input", layout:"full", text:`${ft} feet = ? inches`, ans:(ft*12).toString() };
            },
            "MA.3.DP.1.1": () => { // Graphs
                return { cat:"DP", type:"input", layout:"split", visual:`<div class="shaded-box">Key: ‚≠ê=2<br>Books: ‚≠ê‚≠ê‚≠ê</div>`, text:"How many books?", ans:"6" };
            }
        };

        // --- SESSION LOGIC ---
        let queue = [], curIdx = 0, answers = [];

        function startTest(mode, count) {
            queue = []; answers = [];
            let keys = Object.keys(STANDARDS);
            if(mode !== 'ALL') keys = keys.filter(k => k.includes(mode));
            
            for(let i=0; i<count; i++) {
                let key = keys[Math.floor(Math.random()*keys.length)];
                queue.push(STANDARDS[key]());
            }

            curIdx = 0;
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.getElementById('screen-test').classList.add('active');
            renderQ();
        }

        function renderQ() {
            const q = queue[curIdx];
            const stage = document.getElementById('stage');
            const ans = answers[curIdx] || {};

            // Left Pane (Visuals)
            let left = q.layout === 'split' ? `<div class="left-pane">${q.visual}</div>` : "";
            let rStyle = q.layout === 'full' ? "width:100%" : "width:55%";

            // Input Generation
            let html = "";
            if(q.type === 'choice') {
                q.opts.forEach(o => {
                    let sel = ans === o ? 'selected' : '';
                    html += `<div class="opt-row ${sel}" onclick="save('${o}')"><div class="bubble"></div>${o}</div>`;
                });
            } 
            else if(q.type === 'multi-select') {
                q.opts.forEach((o, i) => {
                    let arr = answers[curIdx] || [];
                    let sel = arr.includes(i) ? 'selected' : '';
                    html += `<div class="opt-row ${sel}" onclick="saveMulti(${i})"><div class="bubble square"></div>${o}</div>`;
                });
            }
            else if(q.type === 'input') {
                html = `<input class="input-box" value="${ans||''}" onchange="save(this.value)" placeholder="?">`;
            }
            else if(q.type === 'multi-input') {
                html += `<div class="shaded-box">`;
                q.inputs.forEach((inp, i) => {
                    html += `<div class="input-row"><label>${inp.label}</label><input class="input-box" onchange="saveMultiInput(${i}, this.value)"></div>`;
                });
                html += `</div>`;
            }
            else if(q.type === 'inline') {
                html += `<div style="line-height:2.5">`;
                q.sentence.forEach((p, i) => {
                    if(p.type === 'select') {
                        html += `<select class="inline-select" onchange="saveInline(${i}, this.value)"><option disabled selected>Select...</option>`;
                        p.opts.forEach(o => html += `<option>${o}</option>`);
                        html += `</select>`;
                    } else html += `<span>${p.text}</span>`;
                });
                html += `</div>`;
            }
            else if(q.type === 'table') {
                html += `<table class="match-table"><thead><tr><th></th>`;
                q.cols.forEach(c => html += `<th>${c}</th>`);
                html += `</tr></thead><tbody>`;
                q.rows.forEach((r, idx) => {
                    html += `<tr><td><b>${r}</b></td>`;
                    q.cols.forEach(c => html += `<td><input type="radio" class="radio-big" name="r${idx}" onclick="saveTable(${idx}, '${c}')"></td>`);
                    html += `</tr>`;
                });
                html += `</tbody></table>`;
            }
            else if(q.type === 'two-part') {
                q.parts.forEach((p, pIdx) => {
                    html += `<div class="part-header">${p.label}</div>`;
                    p.opts.forEach(o => {
                        let sel = (ans[pIdx] === o) ? 'selected' : '';
                        html += `<div class="opt-row ${sel}" onclick="saveTwoPart(${pIdx}, '${o}')"><div class="bubble"></div>${o}</div>`;
                    });
                });
            }

            stage.innerHTML = `${left}<div class="pane right-pane" style="${rStyle}"><div class="q-header">${q.cat} Domain</div><div class="q-text">${q.text}</div>${html}</div>`;
            document.getElementById('q-idx').innerText = curIdx + 1;
            document.getElementById('btn-next').innerText = (curIdx === queue.length-1) ? "Submit" : "Next";
        }

        // --- SAVING ---
        window.save = v => { answers[curIdx] = v; renderQ(); };
        window.saveMulti = i => { let a=answers[curIdx]||[]; if(a.includes(i)) a=a.filter(x=>x!==i); else a.push(i); answers[curIdx]=a; renderQ(); };
        window.saveMultiInput = (i,v) => { let a=answers[curIdx]||{}; a[i]=v; answers[curIdx]=a; };
        window.saveInline = (i,v) => { let a=answers[curIdx]||{}; a[i]=v; answers[curIdx]=a; };
        window.saveTable = (i,v) => { let a=answers[curIdx]||{}; a[i]=v; answers[curIdx]=a; };
        window.saveTwoPart = (i,v) => { let a=answers[curIdx]||{}; a[i]=v; answers[curIdx]=a; renderQ(); };

        window.nextQ = () => { if(curIdx < queue.length-1) { curIdx++; renderQ(); } else finish(); };
        window.prevQ = () => { if(curIdx>0) { curIdx--; renderQ(); } };
        window.toggleZoom = () => { document.body.style.zoom = document.body.style.zoom==="1.2"?"1":"1.2"; };
        window.toggleRef = () => alert("Reference Sheet Loaded");

        function finish() {
            let score=0, total=queue.length;
            queue.forEach((q, i) => {
                let a = answers[i];
                // Simplified grading for demo (Add specific logic for multi-input/table in prod)
                if(JSON.stringify(a) == JSON.stringify(q.ans) || a == q.ans) score++;
            });
            let pct = Math.round((score/total)*100);
            let lvl = pct>=80 ? "Level 4" : (pct>=60 ? "Level 3" : "Level 1");
            let cls = pct>=80 ? "l4" : (pct>=60 ? "l3" : "l1"); // Color class
            
            document.getElementById('final-badge').className = "level-badge " + cls;
            document.getElementById('final-badge').innerText = lvl;
            document.getElementById('report-grid').innerHTML = `<div class="rep-box ${pct>=60?'good':'bad'}"><strong>Overall Score</strong><br>${score}/${total} (${pct}%)</div>`;
            
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.getElementById('screen-report').classList.add('active');
        }
    </script>
</body>
</html>
