<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST Grade 3 Math - Official Simulator</title>
    <style>
        :root { --header: #2C3E50; --bg: #EAEAEA; --active: #3498DB; --text: #333; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; transition: transform 0.2s; transform-origin: top left; }

        /* HEADER */
        .top-bar { background: var(--header); color: white; padding: 0 20px; height: 60px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .tool-group { display: flex; gap: 10px; }
        .tool-btn { background: transparent; border: 1px solid #7F8C8D; color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.9em; }
        .tool-btn:hover { background: rgba(255,255,255,0.1); }
        .tool-btn.active { background: var(--active); border-color: var(--active); }

        /* MAIN CONTENT */
        .main-stage { display: flex; flex: 1; padding: 10px; gap: 10px; overflow: hidden; position: relative; }
        
        /* SPLIT LAYOUT */
        .split-pane { background: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow-y: auto; padding: 25px; position: relative; }
        .left-pane { width: 45%; border-right: 1px solid #ddd; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #FAFAFA; }
        .right-pane { width: 55%; }
        .full-pane { width: 100%; }

        /* GRAPHICS GENERATOR */
        svg { max-width: 100%; max-height: 300px; }
        .data-key-box { border: 2px solid #333; padding: 15px; background: #fff; display: inline-block; text-align: left; border-radius: 8px; }
        .key-row { font-size: 1.2em; margin: 5px 0; display: flex; align-items: center; gap: 10px; }

        /* QUESTION STYLES */
        .q-header { color: #555; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .q-content { font-size: 1.3em; line-height: 1.5; color: #222; margin-bottom: 20px; }
        
        /* INTERACTION */
        .opt-row { display: flex; padding: 12px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; border-radius: 4px; transition: 0.1s; }
        .opt-row:hover { background: #F4F6F7; border-color: #ddd; }
        .opt-row.selected { background: #EBF5FB; border-color: var(--active); }
        .bubble { width: 22px; height: 22px; border: 2px solid #95A5A6; border-radius: 50%; margin-right: 15px; }
        .opt-row.selected .bubble { background: var(--active); border-color: var(--active); }

        .input-box { font-size: 1.2em; padding: 8px; width: 80px; text-align: center; border: 2px solid #ccc; border-radius: 4px; }
        .input-box:focus { border-color: var(--active); outline: none; }

        /* FOOTER */
        .nav-bar { background: white; border-top: 1px solid #ccc; height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .nav-btn { background: var(--active); color: white; border: none; padding: 12px 30px; border-radius: 4px; font-size: 1.1em; font-weight: bold; cursor: pointer; }
        .nav-btn.secondary { background: white; color: #333; border: 2px solid #ccc; }

        /* TOOLS OVERLAYS */
        #line-reader { position: absolute; width: 100%; height: 60px; background: rgba(255, 255, 0, 0.3); border-top: 2px solid red; border-bottom: 2px solid red; top: 100px; left: 0; cursor: grab; display: none; z-index: 100; pointer-events: auto; }
        
        #ref-sheet-modal { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 600px; height: 70vh; background: white; border: 1px solid #ccc; box-shadow: 0 10px 40px rgba(0,0,0,0.5); display: none; z-index: 200; flex-direction: column; }
        .ref-header { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; }
        .ref-content { padding: 20px; overflow-y: auto; font-family: "Times New Roman", serif; }
        .ref-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .ref-table th, .ref-table td { border: 1px solid #000; padding: 8px; text-align: center; }

        .zoom-125 { transform: scale(1.25); width: 80vw; height: 80vh; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div style="font-weight:bold;">Student: Guest (G3 Math)</div>
        <div class="tool-group">
            <button class="tool-btn" onclick="toggleZoom()">üîç Zoom</button>
            <button class="tool-btn" onclick="toggleLineReader()">üìè Line Reader</button>
            <button class="tool-btn" onclick="toggleRef()">üìÑ Formulas</button>
        </div>
        <button class="tool-btn" style="background:#C0392B; border-color:#C0392B;" onclick="location.reload()">Exit</button>
    </div>

    <div id="stage" class="main-stage">
        </div>

    <div id="line-reader" draggable="true"></div>

    <div id="ref-sheet-modal">
        <div class="ref-header">
            <span>Grade 3 Mathematics Reference Sheet</span>
            <button onclick="toggleRef()" style="background:none; border:none; color:white; cursor:pointer;">‚úï</button>
        </div>
        <div class="ref-content">
            <h3>Customary Conversions</h3>
            <table class="ref-table">
                <tr><td>1 foot = 12 inches</td><td>1 yard = 3 feet</td></tr>
                <tr><td>1 mile = 5,280 feet</td><td>1 mile = 1,760 yards</td></tr>
                <tr><td>1 cup = 8 fluid ounces</td><td>1 pint = 2 cups</td></tr>
                <tr><td>1 quart = 2 pints</td><td>1 gallon = 4 quarts</td></tr>
                <tr><td>1 pound = 16 ounces</td><td>1 ton = 2,000 pounds</td></tr>
            </table>
            <h3>Metric Conversions</h3>
            <table class="ref-table">
                <tr><td>1 meter = 100 centimeters</td><td>1 meter = 1000 millimeters</td></tr>
                <tr><td>1 kilometer = 1000 meters</td><td>1 liter = 1000 milliliters</td></tr>
                <tr><td>1 gram = 1000 milligrams</td><td>1 kilogram = 1000 grams</td></tr>
            </table>
            <h3>Time Conversions</h3>
            <table class="ref-table">
                <tr><td>1 minute = 60 seconds</td><td>1 hour = 60 minutes</td></tr>
                <tr><td>1 day = 24 hours</td><td>1 year = 365 days</td></tr>
            </table>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn secondary" onclick="prevQ()">Back</button>
        <div>Question <span id="q-idx">1</span> of 5</div>
        <button class="nav-btn" onclick="nextQ()">Next</button>
    </div>

    <script>
        // --- REAL GRAPHICS GENERATORS ---
        function getPieChart() {
            // SVG for 1/8 shaded
            return `
            <svg viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="48" fill="white" stroke="#333" stroke-width="2"/>
                <path d="M50,50 L50,2 A48,48 0 0,1 84,16 Z" fill="#3498DB" stroke="#333"/> <line x1="50" y1="2" x2="50" y2="98" stroke="#333"/>
                <line x1="2" y1="50" x2="98" y2="50" stroke="#333"/>
                <line x1="16" y1="16" x2="84" y2="84" stroke="#333"/>
                <line x1="16" y1="84" x2="84" y2="16" stroke="#333"/>
            </svg>`;
        }

        function getDataKey() {
            return `
            <div class="data-key-box">
                <div class="key-row">üìö = 3 Students</div>
                <hr>
                <div class="key-row"><b>Sci-Fi:</b> üìöüìö</div>
                <div class="key-row"><b>Comic:</b> üìö</div>
                <div class="key-row"><b>Fantasy:</b> üìöüìöüìö</div>
            </div>`;
        }

        function getRectangle() {
            return `
            <div style="width:200px; height:100px; border:3px solid #333; background:#ddd; display:flex; align-items:center; justify-content:center; position:relative;">
                <span style="position:absolute; top:-25px;">9 units</span>
                <span style="position:absolute; left:-60px;">4 units</span>
                <span style="font-weight:bold; color:#555;">Rectangle</span>
            </div>`;
        }

        // --- QUESTION CONTENT ---
        const questions = [
            {
                type: "input",
                layout: "split",
                visual: getPieChart(),
                text: "<b>Sample Item 1:</b><br>A circle with one part shaded is shown.<br>Create a fraction that represents the shaded part of the circle.",
                ans: "1/8"
            },
            {
                type: "choice",
                layout: "full",
                text: "<b>Sample Item 2:</b><br>What is the expanded form of 7,403?",
                opts: ["700 + 40 + 3", "7,000 + 40 + 3", "7,000 + 400 + 3", "7,000 + 400 + 30"],
                ans: 2
            },
            {
                type: "input-group",
                layout: "split",
                visual: getDataKey(),
                text: "<b>Sample Item 3:</b><br>The data key shows students' favorite books.<br>If üìö = 3 students, how many symbols would you draw for a category with 12 students?",
                ans: "4"
            },
            {
                type: "multi-select",
                layout: "split",
                visual: getRectangle(),
                text: "<b>Sample Item 11:</b><br>Select <b>ALL</b> expressions that represent the <b>Perimeter</b> of the rectangle.",
                opts: ["9 √ó 4", "9 + 4 + 9 + 4", "9 + 4", "(9 √ó 2) + (4 √ó 2)"],
                ans: [1, 3]
            },
            {
                type: "input",
                layout: "full",
                text: "<b>Sample Item 9:</b><br>Jamael works on homework from 3:57 p.m. to 4:32 p.m.<br>How many total minutes did he work?",
                ans: "35"
            }
        ];

        let curIdx = 0;
        let userAns = [null, null, null, [], null];

        function render() {
            const q = questions[curIdx];
            const stage = document.getElementById('stage');
            
            let leftContent = "";
            let rightClass = "full-pane";
            
            if(q.layout === "split") {
                leftContent = `<div class="left-pane">${q.visual}</div>`;
                rightClass = "right-pane";
            }

            let interaction = "";
            if(q.type === "choice") {
                q.opts.forEach((o, i) => {
                    let sel = userAns[curIdx] === i ? "selected" : "";
                    interaction += `<div class="opt-row ${sel}" onclick="saveChoice(${i})"><div class="bubble"></div>${o}</div>`;
                });
            } else if(q.type === "multi-select") {
                q.opts.forEach((o, i) => {
                    let sel = userAns[curIdx].includes(i) ? "selected" : "";
                    interaction += `<div class="opt-row ${sel}" onclick="saveMulti(${i})"><div class="bubble" style="border-radius:4px"></div>${o}</div>`;
                });
            } else if(q.type === "input" || q.type === "input-group") {
                interaction = `<input class="input-box" value="${userAns[curIdx] || ''}" oninput="userAns[curIdx]=this.value" placeholder="?">`;
            }

            stage.innerHTML = `
                ${leftContent}
                <div class="split-pane ${rightClass}">
                    <div class="q-header">Question ${curIdx+1}</div>
                    <div class="q-content">${q.text}</div>
                    <div>${interaction}</div>
                </div>
            `;
            
            document.getElementById('q-idx').innerText = curIdx + 1;
        }

        // --- SAVING ANSWERS ---
        window.saveChoice = (i) => { userAns[curIdx] = i; render(); };
        window.saveMulti = (i) => {
            let arr = userAns[curIdx];
            if(arr.includes(i)) arr = arr.filter(x => x !== i);
            else arr.push(i);
            userAns[curIdx] = arr;
            render();
        };

        // --- NAVIGATION ---
        window.nextQ = () => { if(curIdx < questions.length-1) { curIdx++; render(); } else { alert("Test Complete! Review answers?"); } };
        window.prevQ = () => { if(curIdx > 0) { curIdx--; render(); } };

        // --- TOOLS ---
        let zoom = 1;
        window.toggleZoom = () => {
            zoom = zoom === 1 ? 1.25 : 1;
            document.body.style.transform = `scale(${zoom})`;
            // Adjust origin to keep centered/top-left based on preference
            document.body.style.width = zoom === 1 ? "100%" : "80%";
        };

        window.toggleRef = () => {
            const m = document.getElementById('ref-sheet-modal');
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        };

        window.toggleLineReader = () => {
            const lr = document.getElementById('line-reader');
            lr.style.display = lr.style.display === 'block' ? 'none' : 'block';
        };

        // --- DRAGGABLE LINE READER ---
        const lr = document.getElementById('line-reader');
        let isDown = false, offset = [0,0];

        lr.addEventListener('mousedown', (e) => { isDown = true; offset = [lr.offsetLeft - e.clientX, lr.offsetTop - e.clientY]; });
        document.addEventListener('mouseup', () => { isDown = false; });
        document.addEventListener('mousemove', (e) => {
            if(isDown) {
                lr.style.left = (e.clientX + offset[0]) + 'px';
                lr.style.top  = (e.clientY + offset[1]) + 'px';
            }
        });

        // INIT
        render();
    </script>
</body>
</html>
