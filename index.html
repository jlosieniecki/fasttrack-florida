<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAST Grade 3 Math Portal</title>
    <style>
        :root { --header: #2C3E50; --bg: #F5F7FA; --active: #00609C; --text: #333; --bubble-border: #999; }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* --- SCREENS --- */
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* --- MENU --- */
        .menu-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #003057, #005085); color: white; padding: 20px; }
        .menu-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; color: #333; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .menu-btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 1.1em; cursor: pointer; transition: 0.2s; background: #fff; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .menu-btn:hover { background: #f0f8ff; border-color: var(--active); transform: translateX(5px); }
        .menu-btn strong { display: block; color: #003057; }

        /* --- TEST INTERFACE --- */
        .top-bar { background: #fff; border-bottom: 1px solid #ccc; color: #333; padding: 0 15px; height: 50px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .tool-btn { background: transparent; border: 1px solid #ccc; color: #555; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-left:5px;}
        .tool-btn:hover { background: #eee; }

        .main-stage { flex: 1; padding: 10px; overflow: hidden; display: flex; gap: 10px; height: 100%; position: relative; }
        .pane { background: white; border-radius: 2px; padding: 20px; overflow-y: auto; border: 1px solid #ccc; height: 100%; box-sizing: border-box; }
        
        .left-pane { width: 45%; background: #FAFAFA; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; padding: 10px; }
        .right-pane { width: 55%; }
        @media (max-width: 768px) {
            .main-stage { flex-direction: column; }
            .left-pane { width: 100%; height: 35%; border-right: none; border-bottom: 2px solid #ccc; }
            .right-pane { width: 100%; height: 65%; }
        }

        /* TYPOGRAPHY */
        .q-header { color: #666; font-weight: bold; margin-bottom: 10px; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px; }
        .q-text { font-size: 1.2em; line-height: 1.5; color: #000; margin-bottom: 20px; font-family: 'Times New Roman', serif; } /* Serif for reading passages */
        svg { width: 100%; height: auto; max-height: 250px; }

        /* --- SPECIAL ITEM STYLES --- */
        
        /* ITEM 11: TWO-PART */
        .part-header { font-weight: bold; margin-top: 15px; margin-bottom: 5px; color: #003057; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        /* ITEM 10: INLINE CHOICE */
        .inline-select {
            display: inline-block;
            font-size: 1em;
            padding: 4px 8px;
            margin: 0 4px;
            border: 1px solid #333;
            border-radius: 4px;
            background: #fff;
            color: #000;
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            cursor: pointer;
        }

        /* ITEM 9: OPEN BOXES */
        .shading-box-container {
            background: #f4f4f4;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .input-row { display: flex; align-items: center; margin-bottom: 10px; }
        .input-row label { width: 80px; font-weight: bold; }
        .input-box { font-size: 1.2em; padding: 8px; width: 100px; text-align: center; border: 1px solid #999; background: white; }

        /* STANDARD CHOICE */
        .opt-row { display: flex; padding: 12px; margin-bottom: 8px; cursor: pointer; align-items: center; transition:0.1s; }
        .opt-row:hover { background: #f9f9f9; }
        .bubble { width: 20px; height: 20px; border: 1px solid #000; border-radius: 50%; margin-right: 12px; flex-shrink: 0; background: white; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
        .opt-row.selected .bubble { background: #000; border-color: #000; box-shadow: none; } /* Standardized Black Bubble fill */

        /* FOOTER */
        .nav-bar { background: #eee; border-top: 1px solid #ccc; height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; flex-shrink: 0; }
        .nav-btn { background: var(--active); color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 1em; font-weight: bold; cursor: pointer; min-width: 80px; }

        /* REPORT CARD */
        .report-header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .level-badge { display: inline-block; padding: 5px 15px; border-radius: 15px; color: white; font-weight: bold; font-size: 1.2em; margin-top: 10px; }
        .lvl-1 { background: #D32F2F; } .lvl-2 { background: #F57C00; } .lvl-3 { background: #FBC02D; color: #000; } .lvl-4 { background: #388E3C; } .lvl-5 { background: #00796B; }
        .strength-grid { display: grid; grid-template-columns: 1fr; gap: 10px; text-align: left; }
        .stat-row { display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 6px; border-left: 4px solid #ccc; }
        .stat-good { border-left-color: #388E3C; } .stat-bad { border-left-color: #D32F2F; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="menu-container">
            <div class="menu-card">
                <img src="Gemini_Generated_Image_t8043ht8043ht804.png" style="width:70px; border-radius:10px; margin-bottom:15px;" alt="Logo">
                <h2 style="margin:0;">FAST Math Portal</h2>
                <p style="color:#666; margin-bottom:20px;">Official Item Style Generator</p>
                
                <button class="menu-btn" onclick="initSession('ALL', 35)">
                    <strong>üöÄ Full FAST Simulation</strong>
                    <small>35 Items ‚Ä¢ Mixed Domains ‚Ä¢ Mock Scoring</small>
                </button>
                <button class="menu-btn" onclick="initSession('FR', 15)">
                    <strong>üçï Fractions Domain</strong>
                    <small>15 Items ‚Ä¢ Models & Comparisons</small>
                </button>
                <button class="menu-btn" onclick="initSession('NSO', 20)">
                    <strong>üî¢ Number Sense & Ops</strong>
                    <small>20 Items ‚Ä¢ Multi-Input & Place Value</small>
                </button>
                <button class="menu-btn" onclick="initSession('GR', 15)">
                    <strong>üìê Geometry & Data</strong>
                    <small>15 Items ‚Ä¢ Two-Part Items & Graphs</small>
                </button>
                <button class="menu-btn" onclick="initSession('AR', 15)">
                    <strong>üß† Algebraic Reasoning</strong>
                    <small>15 Items ‚Ä¢ Inline Choice & Logic</small>
                </button>
            </div>
        </div>
    </div>

    <div id="screen-test" class="screen">
        <div class="top-bar">
            <div><strong>Student: Guest</strong> | <span id="session-label">Test</span></div>
            <div>
                <button class="tool-btn" onclick="toggleZoom()">üîç Zoom</button>
                <button class="tool-btn" onclick="alert('Reference Sheet:\n\n1 ft = 12 in\n1 yd = 3 ft\n1 min = 60 sec')">üìÑ Formulas</button>
                <button class="tool-btn" style="background:#C0392B; color:white; border:none;" onclick="location.reload()">Exit</button>
            </div>
        </div>

        <div id="stage" class="main-stage"></div>

        <div class="nav-bar">
            <button class="nav-btn" style="background:white; color:#333; border:1px solid #ccc;" onclick="prevQ()">Back</button>
            <div style="font-weight:bold; color:#555;">Item <span id="q-idx">1</span> of <span id="q-total">35</span></div>
            <button id="btn-next" class="nav-btn" onclick="nextQ()">Next</button>
        </div>
    </div>

    <div id="screen-report" class="screen">
        <div class="menu-container" style="background: #f4f4f4; color: #333;">
            <div class="menu-card" style="width: 100%; max-width: 600px;">
                <div class="report-header">
                    <h1 style="margin:0;">Performance Report</h1>
                    <div id="final-badge" class="level-badge lvl-3">Level 3</div>
                    <p id="final-msg" style="margin-top:5px; color:#666;">On Grade Level</p>
                </div>
                <div id="report-grid" class="strength-grid"></div>
                <button class="menu-btn" style="margin-top:20px; text-align:center; background:var(--active); color:white;" onclick="location.reload()">Return to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // --- PRO MAX GENERATORS (Aligned to PDF Sample Items) ---
        
        const GENERATORS = {
            NSO: [
                () => { // MULTI-INPUT (Item 9 Style)
                    let total = 30 + Math.floor(Math.random() * 30); // e.g., 45 mins
                    return {
                        cat: "NSO", type: "multi-input", layout: "full",
                        text: `Jamael worked on homework for a total of <b>${total} minutes</b>. He worked on Math and Science.<br><br>How many minutes could Jamael have worked on each subject? (Enter any two numbers that add up to ${total}).`,
                        inputs: [ { label: "Math:", val: "" }, { label: "Science:", val: "" } ],
                        check: (ans) => (parseInt(ans[0]) + parseInt(ans[1]) === total && parseInt(ans[0]) > 0 && parseInt(ans[1]) > 0)
                    };
                },
                () => { // STANDARD CHOICE (Item 2 Style)
                    let n = 1000 + Math.floor(Math.random() * 8999);
                    let th = Math.floor(n/1000)*1000, h = Math.floor((n%1000)/100)*100, t = Math.floor((n%100)/10)*10, o = n%10;
                    return {
                        cat: "NSO", type: "choice", layout: "full",
                        text: `What is the expanded form of <b>${n.toLocaleString()}</b>?`,
                        opts: [
                            `${th} + ${h} + ${t} + ${o}`,
                            `${th} + ${h/10} + ${t} + ${o}`,
                            `${th} + ${h} + ${t}0 + ${o}`,
                            `${Math.floor(n/1000)} + ${Math.floor((n%1000)/100)} + ${Math.floor((n%100)/10)} + ${o}`
                        ].sort(() => Math.random()-0.5),
                        ans: `${th} + ${h} + ${t} + ${o}`
                    };
                }
            ],
            GR: [
                () => { // TWO-PART (Item 11 Style)
                    let l = Math.floor(Math.random()*8)+3;
                    let w = Math.floor(Math.random()*5)+2;
                    let areaExpr = `${l} √ó ${w}`;
                    let perimExpr = `${l} + ${l} + ${w} + ${w}`;
                    let areaVal = l*w;
                    let perimVal = 2*l + 2*w;
                    
                    return {
                        cat: "GR", type: "two-part", layout: "split",
                        visual: `<svg viewBox="0 0 200 150"><rect x="50" y="40" width="100" height="70" fill="#EAEAEA" stroke="black" stroke-width="2"/><text x="100" y="30" text-anchor="middle" font-weight="bold">${l} units</text><text x="160" y="80" font-weight="bold">${w} units</text></svg>`,
                        text: "This question has two parts.",
                        parts: [
                            { 
                                label: "Part A: Select the expression for Perimeter.",
                                opts: [`${l} + ${w}`, perimExpr, `${l} √ó ${w}`],
                                ans: perimExpr
                            },
                            { 
                                label: "Part B: Select the value for Area.",
                                opts: [areaVal.toString(), perimVal.toString(), (areaVal+5).toString()],
                                ans: areaVal.toString()
                            }
                        ]
                    };
                }
            ],
            AR: [
                () => { // INLINE CHOICE (Item 10 Style)
                    let n = Math.floor(Math.random()*40)*2; // Even
                    let isEven = true;
                    if(Math.random()>0.5) { n++; isEven = false; }
                    
                    return {
                        cat: "AR", type: "inline", layout: "full",
                        text: "Complete the statement to describe the number.",
                        visual: `<div style="font-size:2.5em; text-align:center; font-weight:bold; margin:15px; border:2px dashed #ccc; display:inline-block; padding:10px 30px;">${n}</div>`,
                        sentence: [
                            { text: "The number is " },
                            { type: "select", opts: ["even", "odd"], ans: isEven?"even":"odd" },
                            { text: " because it " },
                            { type: "select", opts: ["can", "cannot"], ans: isEven?"can":"cannot" },
                            { text: " be divided into two equal groups." }
                        ]
                    };
                }
            ],
            FR: [
                () => { // VISUAL FRACTION (Item 1 Style)
                    let d = [3,4,6,8][Math.floor(Math.random()*4)];
                    return {
                        cat: "FR", type: "choice", layout: "split",
                        visual: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="#333" stroke-width="2"/><path d="M50,50 L50,5 A45,45 0 0,1 ${50 + 45 * Math.sin(2*Math.PI/d)},${50 - 45 * Math.cos(2*Math.PI/d)} Z" fill="#3498DB" stroke="#333"/></svg>`,
                        text: `The circle is divided into ${d} equal parts. What fraction represents the shaded part?`,
                        opts: [`1/${d}`, `1/${d-1}`, `${d}/1`, `2/${d}`],
                        ans: `1/${d}`
                    };
                }
            ]
        };

        // --- ENGINE ---
        let sessionQ = [], curIdx = 0, userAnswers = [];

        function initSession(mode, count) {
            sessionQ = []; userAnswers = [];
            for(let i=0; i<count; i++) {
                let cat = mode === 'ALL' ? ['NSO','FR','AR','GR'][Math.floor(Math.random()*4)] : mode;
                let gens = GENERATORS[cat];
                if(gens) sessionQ.push(gens[Math.floor(Math.random() * gens.length)]());
            }
            curIdx = 0;
            document.getElementById('session-label').innerText = mode === 'ALL' ? "Full FAST Simulation" : mode + " Domain";
            document.getElementById('q-total').innerText = count;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-test').classList.add('active');
            renderQ();
        }

        function renderQ() {
            const q = sessionQ[curIdx];
            const stage = document.getElementById('stage');
            const ans = userAnswers[curIdx] || {};

            let left = q.layout === "split" ? `<div class="left-pane">${q.visual}</div>` : "";
            let rClass = q.layout === "split" ? "right-pane" : "right-pane";
            if(q.layout === 'full') left = "";

            let html = "";
            
            if(q.type === 'choice') {
                q.opts.forEach(o => {
                    let sel = ans === o ? 'selected' : '';
                    html += `<div class="opt-row ${sel}" onclick="save('${o}')"><div class="bubble"></div>${o}</div>`;
                });
            }
            else if (q.type === 'multi-input') {
                html += `<div class="shading-box-container">`;
                q.inputs.forEach((inp, i) => {
                    let val = (ans[i] !== undefined) ? ans[i] : "";
                    html += `<div class="input-row"><label>${inp.label}</label><input class="input-box" value="${val}" onchange="saveMultiInput(${i}, this.value)"></div>`;
                });
                html += `</div>`;
            }
            else if (q.type === 'two-part') {
                q.parts.forEach((part, pIdx) => {
                    html += `<div class="part-header">${part.label}</div>`;
                    part.opts.forEach(o => {
                        let currentPartAns = ans[pIdx];
                        let sel = currentPartAns === o ? 'selected' : '';
                        html += `<div class="opt-row ${sel}" onclick="saveTwoPart(${pIdx}, '${o}')"><div class="bubble"></div>${o}</div>`;
                    });
                });
            }
            else if (q.type === 'inline') {
                html += `<div style="line-height:2.5;">`;
                if(q.visual) html += q.visual + "<br>";
                q.sentence.forEach((part, idx) => {
                    if(part.type === 'select') {
                        let val = ans[idx] || "Select...";
                        html += `<select class="inline-select" onchange="saveInline(${idx}, this.value)"><option disabled selected>${val}</option>`;
                        part.opts.forEach(o => html += `<option value="${o}">${o}</option>`);
                        html += `</select>`;
                    } else {
                        html += `<span>${part.text}</span>`;
                    }
                });
                html += `</div>`;
            }

            stage.innerHTML = `
                ${left}
                <div class="pane ${q.layout==='full'?'':'right-pane'}" style="width:${q.layout==='full'?'100%':'60%'}">
                    <div class="q-header">${q.cat} ‚Ä¢ Item ${curIdx+1}</div>
                    <div class="q-text">${q.text}</div>
                    ${html}
                </div>
            `;
            document.getElementById('btn-next').innerText = (curIdx === sessionQ.length-1) ? "Finish" : "Next";
            document.getElementById('q-idx').innerText = curIdx + 1;
        }

        // --- SAVING ---
        window.save = (val) => { userAnswers[curIdx] = val; renderQ(); };
        window.saveMultiInput = (idx, val) => {
            let cur = userAnswers[curIdx] || {};
            cur[idx] = val;
            userAnswers[curIdx] = cur;
        };
        window.saveTwoPart = (pIdx, val) => {
            let cur = userAnswers[curIdx] || {};
            cur[pIdx] = val;
            userAnswers[curIdx] = cur;
            renderQ();
        };
        window.saveInline = (idx, val) => {
            let cur = userAnswers[curIdx] || {};
            cur[idx] = val;
            userAnswers[curIdx] = cur;
        };

        window.nextQ = () => { if(curIdx < sessionQ.length-1) { curIdx++; renderQ(); } else { finishSession(); } };
        window.prevQ = () => { if(curIdx > 0) { curIdx--; renderQ(); } };
        window.toggleZoom = () => { document.body.style.zoom = document.body.style.zoom === "1.2" ? "1" : "1.2"; }

        function finishSession() {
            let score = 0;
            let stats = { NSO:{c:0,t:0}, FR:{c:0,t:0}, AR:{c:0,t:0}, GR:{c:0,t:0} };

            sessionQ.forEach((q, i) => {
                let ans = userAnswers[i] || {};
                let isCorrect = false;

                if (q.type === 'choice') isCorrect = (ans === q.ans);
                else if (q.type === 'multi-input') isCorrect = q.check(ans);
                else if (q.type === 'two-part') isCorrect = (ans[0] === q.parts[0].ans && ans[1] === q.parts[1].ans);
                else if (q.type === 'inline') {
                    isCorrect = true;
                    q.sentence.forEach((p, idx) => { if(p.type==='select' && ans[idx]!==p.ans) isCorrect=false; });
                }

                if(!stats[q.cat]) stats[q.cat] = {c:0,t:0};
                stats[q.cat].t++;
                if(isCorrect) { score++; stats[q.cat].c++; }
            });

            // REPORT
            let pct = Math.round((score / sessionQ.length) * 100);
            let lvl = 1, txt = "Level 1", cls = "lvl-1", msg = "Intervention Needed";
            if(pct >= 40) { lvl=2; txt="Level 2"; cls="lvl-2"; msg="Below Satisfactory"; }
            if(pct >= 60) { lvl=3; txt="Level 3"; cls="lvl-3"; msg="On Grade Level"; }
            if(pct >= 80) { lvl=4; txt="Level 4"; cls="lvl-4"; msg="Proficient"; }
            if(pct >= 90) { lvl=5; txt="Level 5"; cls="lvl-5"; msg="Mastery!"; }

            document.getElementById('final-badge').className = "level-badge " + cls;
            document.getElementById('final-badge').innerText = txt;
            document.getElementById('final-msg').innerText = `${msg} (${pct}%)`;

            let html = "";
            for(let k in stats) {
                if(stats[k].t === 0) continue;
                let sPct = Math.round((stats[k].c / stats[k].t) * 100);
                let status = sPct >= 60 ? "stat-good" : "stat-bad";
                let label = sPct >= 60 ? "‚úÖ Strength" : "‚ö†Ô∏è Needs Practice";
                html += `<div class="stat-row ${status}"><div><strong>${k}</strong></div><div>${stats[k].c}/${stats[k].t} (${sPct}%)</div><div>${label}</div></div>`;
            }
            document.getElementById('report-grid').innerHTML = html;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-report').classList.add('active');
        }
    </script>
</body>
</html>
